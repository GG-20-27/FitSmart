{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"openapi.yaml":{"content":"openapi: 3.1.0\ninfo:\n  title: FitScore GPT API\n  version: 1.0.2\n  description: Health data integration API with WHOOP fitness tracking, meal logging, and calendar management\nservers:\n  - url: https://health-data-hub.replit.app\n\ncomponents:\n  securitySchemes:\n    bearerAuth:\n      type: http\n      scheme: bearer\n      bearerFormat: JWT\n\npaths:\n  /api/health:\n    get:\n      operationId: getHealthCheck\n      summary: API health check\n      responses:\n        \"200\":\n          description: API status and configuration\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  status:\n                    type: string\n                  timestamp:\n                    type: string\n                  environment:\n                    type: string\n\n  /api/whoop/today:\n    get:\n      operationId: getWhoopToday\n      summary: Get today's WHOOP data\n      security:\n        - bearerAuth: []\n      responses:\n        \"200\":\n          description: Returns recovery, sleep, strain, and RHR values\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  recovery_score:\n                    type: integer\n                  sleep_score:\n                    type: integer\n                  strain:\n                    type: number\n                  resting_heart_rate:\n                    type: integer\n                  sleep_hours:\n                    type: number\n                  hrv:\n                    type: integer\n                  date:\n                    type: string\n        \"401\":\n          description: Authentication required\n        \"404\":\n          description: No WHOOP data available\n\n  /api/whoop/weekly:\n    get:\n      operationId: getWhoopWeekly\n      summary: Get WHOOP metrics for last 7 days\n      security:\n        - bearerAuth: []\n      parameters:\n        - in: query\n          name: days\n          schema:\n            type: integer\n            default: 7\n          description: Number of days to retrieve (default 7)\n      responses:\n        \"200\":\n          description: Returns array of daily metrics\n          content:\n            application/json:\n              schema:\n                type: array\n                items:\n                  type: object\n                  properties:\n                    date:\n                      type: string\n                    recovery_score:\n                      type: integer\n                    sleep_score:\n                      type: integer\n                    strain:\n                      type: number\n                    resting_heart_rate:\n                      type: integer\n        \"401\":\n          description: Authentication required\n\n  /api/whoop/summary:\n    get:\n      operationId: getWhoopSummary\n      summary: Get WHOOP weekly averages and trends\n      security:\n        - bearerAuth: []\n      responses:\n        \"200\":\n          description: Returns weekly averages and summary data\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  averages:\n                    type: object\n                    properties:\n                      recovery:\n                        type: number\n                      sleep:\n                        type: number\n                      strain:\n                        type: number\n                      hrv:\n                        type: number\n                  period:\n                    type: string\n        \"401\":\n          description: Authentication required\n\n  /api/meals:\n    post:\n      operationId: uploadMeals\n      summary: Upload meal photos\n      security:\n        - bearerAuth: []\n      requestBody:\n        content:\n          multipart/form-data:\n            schema:\n              type: object\n              properties:\n                mealPhotos:\n                  type: array\n                  items:\n                    type: string\n                    format: binary\n      responses:\n        \"200\":\n          description: Meals uploaded successfully\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  message:\n                    type: string\n                  files:\n                    type: array\n                    items:\n                      type: string\n        \"401\":\n          description: Authentication required\n\n  /api/meals/today:\n    get:\n      operationId: getMealsToday\n      summary: Get today's uploaded meals\n      security:\n        - bearerAuth: []\n      responses:\n        \"200\":\n          description: Returns array of today's meal photo URLs\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  meals:\n                    type: array\n                    items:\n                      type: string\n                      format: uri\n                  date:\n                    type: string\n        \"401\":\n          description: Authentication required\n\n  /api/calendar/today:\n    get:\n      operationId: getCalendarToday\n      summary: Get today's calendar events\n      security:\n        - bearerAuth: []\n      responses:\n        \"200\":\n          description: Returns today's events from configured calendars\n          content:\n            application/json:\n              schema:\n                type: object\n                properties:\n                  events:\n                    type: array\n                    items:\n                      type: object\n                      properties:\n                        title:\n                          type: string\n                        start:\n                          type: string\n                        end:\n                          type: string\n                        calendar:\n                          type: string\n                  date:\n                    type: string\n        \"401\":\n          description: Authentication required\n\n  /api/calendar/events:\n    get:\n      operationId: getCalendarEvents\n      summary: Get calendar events for date range\n      security:\n        - bearerAuth: []\n      parameters:\n        - in: query\n          name: start\n          schema:\n            type: string\n            format: date\n          description: Start date (YYYY-MM-DD)\n        - in: query\n          name: end\n          schema:\n            type: string\n            format: date\n          description: End date (YYYY-MM-DD)\n      responses:\n        \"200\":\n          description: Returns events for specified date range\n          content:\n            application/json:\n              schema:\n                type: array\n                items:\n                  type: object\n                  properties:\n                    title:\n                      type: string\n                    start:\n                      type: string\n                    end:\n                      type: string\n                    calendar:\n                      type: string\n        \"401\":\n          description: Authentication required\n\n  /api/calendars:\n    get:\n      operationId: getCalendars\n      summary: Get user's configured calendars\n      security:\n        - bearerAuth: []\n      responses:\n        \"200\":\n          description: Returns list of configured calendars\n          content:\n            application/json:\n              schema:\n                type: array\n                items:\n                  type: object\n                  properties:\n                    id:\n                      type: string\n                    name:\n                      type: string\n                    url:\n                      type: string\n                    isActive:\n                      type: boolean\n        \"401\":\n          description: Authentication required\n\n    post:\n      operationId: addCalendar\n      summary: Add a new calendar\n      security:\n        - bearerAuth: []\n      requestBody:\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                name:\n                  type: string\n                url:\n                  type: string\n              required:\n                - name\n                - url\n      responses:\n        \"201\":\n          description: Calendar added successfully\n        \"401\":\n          description: Authentication required\n\n  /api/calendars/{id}:\n    delete:\n      operationId: deleteCalendar\n      summary: Delete a calendar\n      security:\n        - bearerAuth: []\n      parameters:\n        - in: path\n          name: id\n          required: true\n          schema:\n            type: string\n      responses:\n        \"200\":\n          description: Calendar deleted successfully\n        \"401\":\n          description: Authentication required\n\n    patch:\n      operationId: updateCalendar\n      summary: Update calendar settings\n      security:\n        - bearerAuth: []\n      parameters:\n        - in: path\n          name: id\n          required: true\n          schema:\n            type: string\n      requestBody:\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                name:\n                  type: string\n                url:\n                  type: string\n                isActive:\n                  type: boolean\n      responses:\n        \"200\":\n          description: Calendar updated successfully\n        \"401\":\n          description: Authentication required","size_bytes":9600},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# FitScore GPT API Dashboard\n\n## Overview\n\nThe FitScore GPT API Dashboard is a full-stack web application designed to integrate with the WHOOP health platform. Its core purpose is to provide users with a dashboard for monitoring their fitness data and managing meal image uploads. This application facilitates deeper insights into health metrics and supports Custom GPT integrations for advanced AI-driven health management.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n- **Framework**: React 18 with TypeScript.\n- **Styling**: Tailwind CSS with shadcn/ui and Radix UI for comprehensive component solutions.\n- **Routing**: Wouter for client-side navigation.\n- **State Management**: TanStack Query for server state.\n- **Build Tool**: Vite.\n\n### Backend\n- **Runtime**: Node.js with TypeScript.\n- **Framework**: Express.js for the API server.\n- **Database**: PostgreSQL with Drizzle ORM for data persistence (users, meals, WHOOP data).\n- **File Storage**: Local file system for meal image uploads.\n\n### Core Features\n- **Data Management**: Persistence of user, meal image metadata, and WHOOP health metrics.\n- **API Endpoints**:\n    - Health Check.\n    - WHOOP Integration: Authentication (OAuth), daily metric retrieval, and token management.\n    - Meal Management: Image upload and data handling.\n    - Calendar Integration: Fetching events from Google Calendar .ics feeds.\n- **Frontend Components**: Dashboard for metric visualization, meal upload interface, and API status monitoring.\n- **Authentication**: JWT-based authentication with role-based access control (admin/user).\n- **Data Flow**: Seamless flow from WHOOP API to backend storage and frontend display, including automated token refresh.\n- **UI/UX**: Dark theme with neon blue accents, responsive design for various devices, circular progress indicators, and smooth animations.\n\n## External Dependencies\n\n- **Database**: Neon Database (PostgreSQL serverless).\n- **Health Platform API**: WHOOP API for health and fitness data (recovery, sleep, strain, HRV).\n- **File Upload**: Multer for multipart form data handling.\n- **Validation**: Zod for runtime type validation.\n- **Date Handling**: date-fns for date manipulation.\n- **Calendar Integration**: Google Calendar (via .ics feeds).","size_bytes":2317},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"test_oauth_simulation.js":{"content":"// Test OAuth simulation to validate session persistence\nconst axios = require('axios');\n\nasync function testOAuthSimulation() {\n  try {\n    console.log('1. Creating test user and token...');\n    \n    // 1. Create a test user and token\n    const tokenResponse = await axios.post('http://localhost:5000/api/whoop/test-token', {\n      access_token: 'test_access_token_for_session',\n      refresh_token: 'test_refresh_token_for_session',\n      expires_in: 3600,\n      user_id: '77888999'\n    });\n    \n    console.log('‚úÖ Test token created:', tokenResponse.data);\n    \n    // 2. Now simulate a successful OAuth callback by manually setting session\n    console.log('2. Testing session persistence...');\n    \n    // The real issue is that we need to test with a valid OAuth flow\n    // Let's check current session state\n    const authCheck = await axios.get('http://localhost:5000/api/auth/me', {\n      validateStatus: () => true // Don't throw on 401\n    });\n    \n    console.log('Current auth status:', authCheck.status, authCheck.data);\n    \n  } catch (error) {\n    console.error('Test failed:', error.response?.data || error.message);\n  }\n}\n\ntestOAuthSimulation();","size_bytes":1164},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/admin.ts":{"content":"#!/usr/bin/env tsx\n\n/**\n * Admin CLI for FitScore Health Dashboard\n * \n * Usage:\n *   npm run admin:create-user <email>\n *   npm run admin:add-token <email> <access_token> [refresh_token] [expires_at_timestamp]\n *   npm run admin:list-users\n *   npm run admin:delete-user <email>\n */\n\nimport { userService } from './userService';\n\nasync function main() {\n  const command = process.argv[2];\n  \n  switch (command) {\n    case 'create-user': {\n      const email = process.argv[3];\n      if (!email) {\n        console.error('Error: Email is required');\n        console.log('Usage: npm run admin:create-user <email>');\n        process.exit(1);\n      }\n      \n      try {\n        // Check if user already exists\n        const existingUser = await userService.getUserByEmail(email);\n        if (existingUser) {\n          console.log(`User with email ${email} already exists with ID: ${existingUser.id}`);\n          process.exit(0);\n        }\n        \n        const user = await userService.createUser(email);\n        console.log(`‚úÖ User created successfully!`);\n        console.log(`   Email: ${user.email}`);\n        console.log(`   ID: ${user.id}`);\n        console.log(`   Created: ${user.createdAt}`);\n      } catch (error) {\n        console.error('‚ùå Failed to create user:', error);\n        process.exit(1);\n      }\n      break;\n    }\n    \n    case 'add-token': {\n      const email = process.argv[3];\n      const accessToken = process.argv[4];\n      const refreshToken = process.argv[5];\n      const expiresAtStr = process.argv[6];\n      \n      if (!email || !accessToken) {\n        console.error('Error: Email and access token are required');\n        console.log('Usage: npm run admin:add-token <email> <access_token> [refresh_token] [expires_at_timestamp]');\n        process.exit(1);\n      }\n      \n      try {\n        const user = await userService.getUserByEmail(email);\n        if (!user) {\n          console.error(`‚ùå User with email ${email} not found`);\n          console.log('Use \"npm run admin:create-user <email>\" to create the user first');\n          process.exit(1);\n        }\n        \n        const expiresAt = expiresAtStr ? new Date(parseInt(expiresAtStr) * 1000) : undefined;\n        \n        await userService.addWhoopToken(user.id, accessToken, refreshToken, expiresAt);\n        console.log(`‚úÖ WHOOP token added successfully for user: ${email}`);\n        console.log(`   User ID: ${user.id}`);\n        console.log(`   Access Token: ${accessToken.substring(0, 20)}...`);\n        if (refreshToken) console.log(`   Refresh Token: ${refreshToken.substring(0, 20)}...`);\n        if (expiresAt) console.log(`   Expires At: ${expiresAt}`);\n      } catch (error) {\n        console.error('‚ùå Failed to add WHOOP token:', error);\n        process.exit(1);\n      }\n      break;\n    }\n    \n    case 'list-users': {\n      try {\n        const users = await userService.getAllUsers();\n        if (users.length === 0) {\n          console.log('No users found');\n          process.exit(0);\n        }\n        \n        console.log(`\\nüìã Found ${users.length} user(s):\\n`);\n        for (const user of users) {\n          console.log(`Email: ${user.email}`);\n          console.log(`ID: ${user.id}`);\n          console.log(`Created: ${user.createdAt}`);\n          \n          // Check if user has WHOOP token\n          const token = await userService.getWhoopToken(user.id);\n          if (token) {\n            console.log(`WHOOP Token: ‚úÖ (expires: ${token.expiresAt || 'no expiry'})`);\n          } else {\n            console.log(`WHOOP Token: ‚ùå No token`);\n          }\n          console.log('‚îÄ'.repeat(50));\n        }\n      } catch (error) {\n        console.error('‚ùå Failed to list users:', error);\n        process.exit(1);\n      }\n      break;\n    }\n    \n    case 'delete-user': {\n      const email = process.argv[3];\n      if (!email) {\n        console.error('Error: Email is required');\n        console.log('Usage: npm run admin:delete-user <email>');\n        process.exit(1);\n      }\n      \n      try {\n        const user = await userService.getUserByEmail(email);\n        if (!user) {\n          console.error(`‚ùå User with email ${email} not found`);\n          process.exit(1);\n        }\n        \n        await userService.deleteUser(user.id);\n        console.log(`‚úÖ User deleted successfully: ${email}`);\n      } catch (error) {\n        console.error('‚ùå Failed to delete user:', error);\n        process.exit(1);\n      }\n      break;\n    }\n    \n    default:\n      console.log('FitScore Health Dashboard - Admin CLI\\n');\n      console.log('Available commands:');\n      console.log('  create-user <email>                              - Create a new user');\n      console.log('  add-token <email> <access_token> [refresh_token] - Add WHOOP token for user');\n      console.log('  list-users                                       - List all users');\n      console.log('  delete-user <email>                              - Delete a user');\n      console.log('\\nExamples:');\n      console.log('  npm run admin:create-user user@example.com');\n      console.log('  npm run admin:add-token user@example.com abc123token xyz456refresh');\n      console.log('  npm run admin:list-users');\n      console.log('  npm run admin:delete-user user@example.com');\n      process.exit(1);\n  }\n  \n  process.exit(0);\n}\n\nmain().catch(console.error);","size_bytes":5340},"server/authMiddleware.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { userService } from './userService';\nimport { getCurrentUserId, requireJWTAuth } from './jwtAuth';\n\n// Extend Request interface to include user\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: {\n        id: string;\n        email: string;\n        created_at: Date;\n        updated_at: Date;\n      };\n    }\n  }\n}\n\n// WHOOP OAuth authentication middleware (JWT-based)\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  return requireJWTAuth(req, res, next);\n}\n\n// Middleware to attach WHOOP user info to request if authenticated\nexport async function attachUser(req: Request, res: Response, next: NextFunction) {\n  try {\n    const whoopUserId = getCurrentUserId(req);\n    \n    if (whoopUserId) {\n      // For WHOOP OAuth, we use the WHOOP user ID directly\n      req.user = {\n        id: whoopUserId,\n        email: `whoop_user_${whoopUserId}@fitscore.local`,\n        created_at: new Date(),\n        updated_at: new Date()\n      };\n    }\n    \n    next();\n  } catch (error) {\n    console.error('Error attaching WHOOP user to request:', error);\n    next();\n  }\n}\n\n// Helper function to get current user ID (re-exported from jwtAuth for compatibility)\nexport { getCurrentUserId } from './jwtAuth';\n\n// Helper function to get user role from JWT token\nexport function getUserRole(req: Request): string | null {\n  const authHeader = req.headers.authorization;\n  \n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    const token = authHeader.substring(7);\n    const { verifyJWT } = require('./jwtAuth');\n    const payload = verifyJWT(token);\n    \n    return payload ? payload.role : null;\n  }\n  \n  return null;\n}\n\n// Admin middleware - checks if user has admin role in JWT\nexport function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  try {\n    const userId = getCurrentUserId(req);\n    const userRole = getUserRole(req);\n    \n    if (!userId) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n    \n    if (userRole !== 'admin') {\n      return res.status(403).json({ \n        error: 'Admin access required',\n        message: 'This action requires administrator privileges'\n      });\n    }\n    \n    console.log(`[ADMIN] Admin access granted for user: ${userId}`);\n    next();\n  } catch (error) {\n    console.error('Error in admin middleware:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n}","size_bytes":2489},"server/clean-callback.js":{"content":"// Clean OAuth callback implementation following exact checklist\napp.get('/api/whoop/callback', async (req, res, next) => {\n  try {\n    console.log('[WHOOP AUTH] OAuth callback received');\n    const { code, error, state } = req.query;\n    \n    if (error) {\n      console.error('[WHOOP AUTH] OAuth error:', error);\n      return res.status(400).json({ error: 'OAuth authentication failed', details: error });\n    }\n\n    if (!code) {\n      console.error('[WHOOP AUTH] No authorization code received');\n      return res.status(400).json({ error: 'No authorization code received' });\n    }\n\n    if (!state || !state.toString().startsWith('whoop_auth_')) {\n      console.error('[WHOOP AUTH] Invalid state parameter:', state);\n      return res.status(400).json({ error: 'Invalid state parameter' });\n    }\n\n    console.log('[WHOOP AUTH] Exchanging code for token...');\n    const tokenResponse = await whoopApiService.exchangeCodeForToken(code as string);\n    \n    console.log('[WHOOP AUTH] Getting user profile...');\n    const userProfile = await whoopApiService.getUserProfile(tokenResponse.access_token);\n    const whoopUserId = `whoop_${userProfile.user_id}`;\n    \n    console.log(`[WHOOP AUTH] User authenticated: ${whoopUserId}`);\n\n    // Store token\n    await whoopTokenStorage.setToken(whoopUserId, {\n      access_token: tokenResponse.access_token,\n      refresh_token: tokenResponse.refresh_token,\n      expires_at: Math.floor(Date.now() / 1000) + tokenResponse.expires_in,\n      user_id: whoopUserId\n    });\n    \n    // Store user\n    await userService.createUser(`${whoopUserId}@fitscore.local`, whoopUserId);\n    \n    // 3. OAuth callback with session regeneration as specified\n    req.session.regenerate((err) => {\n      if (err) {\n        console.error('[WHOOP AUTH] Session regeneration error:', err);\n        return next(err);\n      }\n      \n      // Set userId in regenerated session\n      (req.session as any).userId = whoopUserId;\n      \n      // Save session and redirect\n      req.session.save((saveErr) => {\n        if (saveErr) {\n          console.error('[WHOOP AUTH] Session save error:', saveErr);\n          return res.status(500).send('Authentication failed - session save error');\n        }\n        \n        console.log(`[WHOOP AUTH] Session regenerated and saved: ${req.sessionID}, User: ${whoopUserId}`);\n        \n        // Redirect to dashboard \n        res.redirect('/');\n      });\n    });\n    \n  } catch (error) {\n    console.error('[WHOOP AUTH] Callback error:', error);\n    res.status(500).json({ error: 'Authentication failed', details: error.message });\n  }\n});","size_bytes":2590},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"server/index.ts":{"content":"// Fallback for manual injection in Replit (optional safety net)\nif (!process.env.N8N_SECRET_TOKEN) {\n  process.env.N8N_SECRET_TOKEN = 'fitgpt-secret-2025';\n  console.log('[INFO] Set default N8N_SECRET_TOKEN to: fitgpt-secret-2025');\n}\n\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { whoopApiService } from \"./whoopApiService\";\nimport { userService } from \"./userService\";\nimport { jwtAuthMiddleware } from \"./jwtAuth\";\n\nconst app = express();\n\n// CRITICAL: Trust proxy for Replit deployment\napp.set('trust proxy', 1);\n\n// JWT authentication middleware\napp.use(jwtAuthMiddleware);\n\nconsole.log(`[JWT] JWT-based authentication configured`);\n\n// Background token refresh service\nfunction startTokenRefreshService() {\n  console.log('[TOKEN SERVICE] Starting background token refresh service...');\n  \n  // Check and refresh tokens every 5 minutes\n  const refreshTokens = async () => {\n    try {\n      const adminUser = await userService.getUserByEmail('admin@fitscore.local');\n      if (adminUser) {\n        await whoopApiService.getValidWhoopToken(adminUser.id);\n        console.log('[TOKEN SERVICE] Token validation completed successfully');\n      } else {\n        console.log('[TOKEN SERVICE] Default admin user not found');\n      }\n    } catch (error) {\n      console.log('[TOKEN SERVICE] Token validation failed, user may need to re-authenticate');\n    }\n  };\n\n  // Run immediately and then every 5 minutes\n  refreshTokens();\n  setInterval(refreshTokens, 5 * 60 * 1000); // 5 minutes\n}\n// CORS configuration - must be before express.json()\napp.use((req, res, next) => {\n  // Allow credentials for JWT-based auth\n  res.header('Access-Control-Allow-Credentials', 'true');\n  \n  // Set origin based on environment - be more permissive for Replit\n  const origin = req.headers.origin;\n  if (process.env.NODE_ENV === 'development' || \n      origin?.includes('localhost') || \n      origin?.includes('replit.app') || \n      origin?.includes('replit.dev') ||\n      origin?.includes('health-data-hub')) {\n    res.header('Access-Control-Allow-Origin', origin);\n  } else if (!origin) {\n    // For same-origin requests (no Origin header)\n    res.header('Access-Control-Allow-Origin', '*');\n  }\n  \n  // Allow common headers including session-related ones\n  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization, Cookie, Set-Cookie');\n  \n  // Allow common methods\n  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS, PATCH');\n  \n  // Handle preflight requests\n  if (req.method === 'OPTIONS') {\n    return res.status(200).end();\n  }\n  \n  next();\n});\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, (r: any) => {\n    log(`serving on port ${port}`);\n  });\n\n  // Start background token refresh service\n  startTokenRefreshService();\n\n  // Utility to print all registered routes (for debugging)\n  (app as any)._router.stack\n    .filter((r: any) => r.route)\n    .forEach((r: any) => {\n      const method = Object.keys(r.route.methods)[0].toUpperCase();\n      const path = r.route.path;\n      console.log(`[ROUTE] ${method} ${path}`);\n    });\n})();\n","size_bytes":4860},"server/jwtAuth.ts":{"content":"import jwt from 'jsonwebtoken';\nimport { Request, Response, NextFunction } from 'express';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback-jwt-secret-for-development-only';\n\n// JWT payload interface\ninterface JWTPayload {\n  whoopId: string;\n  role: string;\n  exp: number;\n}\n\n// Generate JWT token for authenticated user\nexport function generateJWT(whoopId: string, role: string = 'user'): string {\n  const payload: JWTPayload = {\n    whoopId,\n    role,\n    exp: Math.floor(Date.now() / 1000) + (10 * 365 * 24 * 60 * 60) // 10 years (set-and-forget)\n  };\n  \n  return jwt.sign(payload, JWT_SECRET);\n}\n\n// Verify JWT token and return payload\nexport function verifyJWT(token: string): JWTPayload | null {\n  try {\n    const payload = jwt.verify(token, JWT_SECRET) as JWTPayload;\n    return payload;\n  } catch (error: any) {\n    console.log('[JWT] Token verification failed:', error?.message || 'Unknown error');\n    return null;\n  }\n}\n\n// Middleware to extract userId from JWT token\nexport function jwtAuthMiddleware(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers.authorization;\n  \n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    const token = authHeader.substring(7);\n    const payload = verifyJWT(token);\n    \n    if (payload) {\n      // Set userId and role on request for compatibility with existing code\n      (req as any).userId = payload.whoopId;\n      (req as any).role = payload.role;\n      console.log(`[JWT] Authentication successful for user: ${payload.whoopId}`);\n      return next();\n    }\n  }\n  \n  // No userId set - existing middleware will handle this\n  console.log(`[JWT] No valid token found`);\n  next();\n}\n\n// Get current user ID from request (compatible with existing getCurrentUserId function)\nexport function getCurrentUserId(req: Request): string | null {\n  return (req as any).userId || null;\n}\n\n// JWT-based authentication middleware for protected routes\nexport function requireJWTAuth(req: Request, res: Response, next: NextFunction) {\n  const userId = getCurrentUserId(req);\n  \n  console.log(`[JWT AUTH] Checking authentication for path: ${req.path}, userId: ${userId}`);\n  \n  if (!userId) {\n    console.log(`[JWT AUTH] No userId found, authentication required`);\n    \n    // For API requests, return JSON error\n    if (req.path.startsWith('/api/')) {\n      return res.status(401).json({ \n        error: 'Authentication required',\n        message: 'Please authenticate with WHOOP to access this resource',\n        redirect_url: '/api/whoop/login'\n      });\n    }\n    \n    // For page requests, redirect to WHOOP OAuth\n    console.log(`[JWT AUTH] Redirecting page request to WHOOP OAuth login`);\n    return res.redirect('/api/whoop/login');\n  }\n  \n  console.log(`[JWT AUTH] Authentication successful for user: ${userId}`);\n  next();\n}","size_bytes":2812},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport express from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport multer, { type FileFilterCallback } from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport cors from \"cors\";\nimport { z } from \"zod\";\nimport type { WhoopTodayResponse, MealResponse, ApiStatusResponse } from \"@shared/schema\";\nimport { whoopApiService } from \"./whoopApiService\";\nimport { whoopTokenStorage } from \"./whoopTokenStorage\";\nimport { userService } from \"./userService\";\nimport ical from \"ical\";\nimport { DateTime } from \"luxon\";\nimport axios from \"axios\";\nimport { getCurrentUserId, requireAdmin } from './authMiddleware';\nimport { requireJWTAuth } from './jwtAuth';\nimport { db } from './db';\nimport { users } from '@shared/schema';\nimport { eq } from 'drizzle-orm';\n\n// Ensure uploads directory exists\nconst uploadsDir = path.join(process.cwd(), \"uploads\");\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\n\n// Configure multer for file uploads\nconst storage_multer = multer.diskStorage({\n  destination: (req: Request, file: Express.Multer.File, cb: (error: Error | null, destination: string) => void) => {\n    cb(null, uploadsDir);\n  },\n  filename: (req: Request, file: Express.Multer.File, cb: (error: Error | null, filename: string) => void) => {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const ext = path.extname(file.originalname);\n    cb(null, `meal_${timestamp}${ext}`);\n  }\n});\n\nconst upload = multer({\n  storage: storage_multer,\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB limit\n  },\n  fileFilter: (req: Request, file: Express.Multer.File, cb: FileFilterCallback) => {\n    if (file.mimetype.startsWith('image/')) {\n      cb(null, true);\n    } else {\n      cb(new Error('Only image files are allowed'));\n    }\n  }\n});\n\n// Helper function for timezone-aware date keys\nfunction todayKey(tz = process.env.USER_TZ || 'Europe/Zurich') {\n  return DateTime.now().setZone(tz).toISODate();\n}\n\n// Helper function to get default user ID for WHOOP OAuth testing\nasync function getDefaultUserId(): Promise<string> {\n  // For WHOOP OAuth, we don't have a default admin user anymore\n  // Return a test WHOOP user ID format for development\n  return 'whoop_25283528';\n}\n\n// Fetch live WHOOP data using OAuth access token\nasync function fetchWhoopData(userId?: string): Promise<WhoopTodayResponse> {\n  try {\n    const actualUserId = userId || await getDefaultUserId();\n    const data = await whoopApiService.getTodaysData(actualUserId);\n    return data;\n  } catch (error) {\n    console.error('Failed to fetch live WHOOP data:', error);\n    throw error;\n  }\n}\n\nfunction getTodayDate(): string {\n  return new Date().toISOString().split('T')[0];\n}\n\n// Daily WHOOP data logging system\nconst historyFile = path.join(process.cwd(), 'data', 'userProfile.json');\n\nfunction logDailyStats(entry: any) {\n  try {\n    // Ensure data directory exists\n    const dataDir = path.dirname(historyFile);\n    if (!fs.existsSync(dataDir)) {\n      fs.mkdirSync(dataDir, { recursive: true });\n    }\n\n    // Read existing data or initialize empty array\n    let allEntries: any[] = [];\n    if (fs.existsSync(historyFile)) {\n      const fileContent = fs.readFileSync(historyFile, 'utf8');\n      allEntries = JSON.parse(fileContent) || [];\n    }\n\n    // Remove existing entry for the same date and add new one\n    const updated = [...allEntries.filter(d => d.date !== entry.date), entry];\n    \n    // Write back to file\n    fs.writeFileSync(historyFile, JSON.stringify(updated, null, 2));\n    console.log('Daily WHOOP stats logged:', entry.date);\n  } catch (error) {\n    console.error('Failed to log daily stats:', error);\n  }\n}\n\nfunction calculateAverages(days: number = 7): any {\n  try {\n    if (!fs.existsSync(historyFile)) {\n      return { avg_recovery: null, avg_strain: null, avg_sleep: null, avg_hrv: null };\n    }\n\n    const fileContent = fs.readFileSync(historyFile, 'utf8');\n    const allEntries = JSON.parse(fileContent) || [];\n    \n    // Get entries from the last N days\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n    const cutoffString = cutoffDate.toISOString().split('T')[0];\n    \n    const recentEntries = allEntries\n      .filter((entry: any) => entry.date >= cutoffString)\n      .filter((entry: any) => entry.recovery_score !== null || entry.strain_score !== null || entry.sleep_score !== null || entry.hrv !== null);\n\n    if (recentEntries.length === 0) {\n      return { avg_recovery: null, avg_strain: null, avg_sleep: null, avg_hrv: null };\n    }\n\n    // Calculate averages\n    const validRecovery = recentEntries.filter((e: any) => e.recovery_score !== null);\n    const validStrain = recentEntries.filter((e: any) => e.strain_score !== null);\n    const validSleep = recentEntries.filter((e: any) => e.sleep_score !== null);\n    const validHrv = recentEntries.filter((e: any) => e.hrv !== null);\n\n    return {\n      avg_recovery: validRecovery.length > 0 ? Math.round(validRecovery.reduce((sum: number, e: any) => sum + e.recovery_score, 0) / validRecovery.length * 10) / 10 : null,\n      avg_strain: validStrain.length > 0 ? Math.round(validStrain.reduce((sum: number, e: any) => sum + e.strain_score, 0) / validStrain.length * 10) / 10 : null,\n      avg_sleep: validSleep.length > 0 ? Math.round(validSleep.reduce((sum: number, e: any) => sum + e.sleep_score, 0) / validSleep.length * 10) / 10 : null,\n      avg_hrv: validHrv.length > 0 ? Math.round(validHrv.reduce((sum: number, e: any) => sum + e.hrv, 0) / validHrv.length * 10) / 10 : null\n    };\n  } catch (error) {\n    console.error('Failed to calculate averages:', error);\n    return { avg_recovery: null, avg_strain: null, avg_sleep: null, avg_hrv: null };\n  }\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Enable CORS for all routes with pre-flight support\n  app.use(cors({\n    origin: true,\n    credentials: true,\n    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n    allowedHeaders: ['Content-Type', 'Authorization', 'Accept']\n  }));\n  \n  // Handle pre-flight requests for all routes\n  app.options('*', cors());\n\n  // Serve static files from uploads directory\n  app.use('/uploads', express.static(uploadsDir));\n\n  // Log API examples on startup\n  console.log('\\nüöÄ FitScore GPT API Endpoints:');\n  console.log('üìä Health Check: GET /api/health');\n  console.log('üîê WHOOP Login: GET /api/whoop/login');\n  console.log('üîÑ WHOOP Callback: GET /api/whoop/callback');\n  console.log('üèÉ WHOOP Data: GET /api/whoop/today');\n  console.log('üì∏ Upload Meals: POST /api/meals (field: mealPhotos)');\n  console.log('üçΩÔ∏è Today\\'s Meals: GET /api/meals/today');\n  console.log('üìÖ Calendar Today: GET /api/calendar/today');\n  console.log('\\nüìù Test with curl:');\n  console.log('curl http://localhost:5000/api/health');\n  console.log('curl http://localhost:5000/api/whoop/login');\n  console.log('curl http://localhost:5000/api/whoop/today');\n  console.log('curl http://localhost:5000/api/meals/today');\n  console.log('curl http://localhost:5000/api/calendar/today');\n  console.log('curl -F \"mealPhotos=@image.jpg\" http://localhost:5000/api/meals');\n  console.log('');\n\n  // Remove email/password authentication - redirect to WHOOP OAuth\n  console.log('[ROUTE] GET /api/auth/login');\n  app.get('/api/auth/login', (req, res) => {\n    res.redirect('/api/whoop/login');\n  });\n  \n  // Legacy POST login redirects to WHOOP OAuth\n  console.log('[ROUTE] POST /api/auth/login');\n  app.post('/api/auth/login', (req, res) => {\n    res.redirect('/api/whoop/login');\n  });\n\n\n  console.log('[ROUTE] POST /api/auth/logout');\n  app.post('/api/auth/logout', (req, res) => {\n    // For JWT, logout is handled client-side by removing the token\n    res.json({ message: 'Logout successful' });\n  });\n\n  console.log('[ROUTE] GET /api/auth/me');\n  app.get('/api/auth/me', async (req, res) => {\n    try {\n      const whoopUserId = getCurrentUserId(req);\n      console.log(`[AUTH ME] Checking JWT authentication, userId: ${whoopUserId}`);\n      console.log(`[AUTH ME] Headers:`, req.headers.authorization ? 'Bearer token present' : 'No bearer token');\n      \n      if (!whoopUserId) {\n        console.log(`[AUTH ME] No userId found in JWT token - authentication required`);\n        return res.status(401).json({ \n          error: 'Authentication required',\n          message: 'Please authenticate with WHOOP to access this resource'\n        });\n      }\n      \n      // Get user role from JWT token\n      const authHeader = req.headers.authorization;\n      let userRole = 'user'; // default role\n      \n      if (authHeader && authHeader.startsWith('Bearer ')) {\n        try {\n          const token = authHeader.split(' ')[1];\n          const { verifyJWT } = await import('./jwtAuth');\n          const payload = verifyJWT(token);\n          userRole = payload.role || 'user';\n        } catch (jwtError) {\n          console.log(`[AUTH ME] JWT verification failed:`, jwtError.message);\n        }\n      }\n      \n      console.log(`[AUTH ME] Authentication successful for user: ${whoopUserId} with role: ${userRole}`);\n      res.json({ userId: whoopUserId, role: userRole });\n    } catch (error) {\n      console.error('Get user error:', error);\n      res.status(500).json({ error: 'Failed to get user information' });\n    }\n  });\n\n  // User profile endpoint\n  console.log('[ROUTE] GET /api/users/me');\n  app.get('/api/users/me', requireJWTAuth, async (req, res) => {\n    try {\n      const whoopUserId = getCurrentUserId(req);\n      \n      // Get user role from JWT token\n      const authHeader = req.headers.authorization;\n      let userRole = 'user';\n      \n      if (authHeader && authHeader.startsWith('Bearer ')) {\n        try {\n          const token = authHeader.split(' ')[1];\n          const { verifyJWT } = await import('./jwtAuth');\n          const payload = verifyJWT(token);\n          userRole = payload.role || 'user';\n        } catch (jwtError) {\n          console.log(`[USERS ME] JWT verification failed:`, jwtError.message);\n        }\n      }\n      \n      res.json({ \n        whoopId: whoopUserId, \n        role: userRole \n      });\n    } catch (error) {\n      console.error('Get user profile error:', error);\n      res.status(500).json({ error: 'Failed to get user profile' });\n    }\n  });\n\n  // Static JWT endpoint for Custom GPT integration\n  console.log('[ROUTE] GET /api/auth/static-jwt');\n  app.get('/api/auth/static-jwt', requireJWTAuth, async (req, res) => {\n    try {\n      const userId = getCurrentUserId(req);\n      console.log(`[STATIC JWT] Fetching static JWT for user: ${userId}`);\n      \n      if (!userId) {\n        return res.status(401).json({ \n          error: 'Authentication required',\n          message: 'Please authenticate with WHOOP to access this resource'\n        });\n      }\n      \n      const tokenData = await whoopTokenStorage.getToken(userId);\n      const staticJwt = tokenData?.static_jwt || null;\n      \n      console.log(`[STATIC JWT] Found static JWT for user ${userId}:`, staticJwt ? 'Present' : 'Not found');\n      \n      res.json({ \n        static_jwt: staticJwt \n      });\n    } catch (error) {\n      console.error('Get static JWT error:', error);\n      res.status(500).json({ error: 'Failed to get static JWT token' });\n    }\n  });\n\n  // Remove registration - users are created via WHOOP OAuth only\n  console.log('[ROUTE] POST /api/auth/register');\n  app.post('/api/auth/register', (req, res) => {\n    res.redirect('/api/whoop/login');\n  });\n\n  // Admin routes for multi-user management (admin only)\n  console.log('[ROUTE] POST /api/admin/users');\n  app.post('/api/admin/users', requireAdmin, async (req, res) => {\n    try {\n      const { email } = req.body;\n      if (!email) {\n        return res.status(400).json({ error: 'Email is required' });\n      }\n\n      const existingUser = await userService.getUserByEmail(email);\n      if (existingUser) {\n        return res.json({ message: 'User already exists', user: existingUser });\n      }\n\n      const user = await userService.createUser(email);\n      res.json({ message: 'User created successfully', user });\n    } catch (error) {\n      console.error('Error creating user:', error);\n      res.status(500).json({ error: 'Failed to create user' });\n    }\n  });\n\n  console.log('[ROUTE] GET /api/admin/users');\n  app.get('/api/admin/users', requireAdmin, async (req, res) => {\n    try {\n      const users = await userService.getAllUsers();\n      const usersWithTokens = await Promise.all(\n        users.map(async (user) => {\n          const token = await userService.getWhoopToken(user.id);\n          return {\n            ...user,\n            hasWhoopToken: !!token,\n            tokenExpiry: token?.expiresAt || null\n          };\n        })\n      );\n      res.json(usersWithTokens);\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      res.status(500).json({ error: 'Failed to fetch users' });\n    }\n  });\n\n  console.log('[ROUTE] POST /api/admin/users/:userId/whoop-token');\n  app.post('/api/admin/users/:userId/whoop-token', requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { accessToken, refreshToken, expiresAt } = req.body;\n      \n      if (!accessToken) {\n        return res.status(400).json({ error: 'Access token is required' });\n      }\n\n      const user = await userService.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ error: 'User not found' });\n      }\n\n      const expiry = expiresAt ? new Date(expiresAt * 1000) : undefined;\n      await userService.addWhoopToken(userId, accessToken, refreshToken, expiry);\n      \n      res.json({ message: 'WHOOP token added successfully' });\n    } catch (error) {\n      console.error('Error adding WHOOP token:', error);\n      res.status(500).json({ error: 'Failed to add WHOOP token' });\n    }\n  });\n\n  console.log('[ROUTE] DELETE /api/admin/users/:userId');\n  app.delete('/api/admin/users/:userId', requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      const user = await userService.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ error: 'User not found' });\n      }\n\n      await userService.deleteUser(userId);\n      res.json({ message: 'User deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting user:', error);\n      res.status(500).json({ error: 'Failed to delete user' });\n    }\n  });\n\n  console.log('[ROUTE] PATCH /api/admin/users/:userId');\n  app.patch('/api/admin/users/:userId', requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { displayName } = req.body;\n      \n      const user = await userService.getUserById(userId);\n      if (!user) {\n        return res.status(404).json({ error: 'User not found' });\n      }\n\n      await userService.updateUserDisplayName(userId, displayName);\n      res.json({ message: 'User display name updated successfully' });\n    } catch (error) {\n      console.error('Error updating user display name:', error);\n      res.status(500).json({ error: 'Failed to update user display name' });\n    }\n  });\n\n  // Health check endpoint (moved from root to avoid conflicts with frontend)\n  app.get('/api/health', async (req, res) => {\n    try {\n      const defaultUserId = await getDefaultUserId();\n      const tokenData = await whoopTokenStorage.getToken(defaultUserId);\n      const tokenStatus = tokenData?.access_token ? 'connected' : 'not connected';\n      \n      let expiryInfo = '';\n      if (tokenData?.expires_at) {\n        const expiryTime = new Date(tokenData.expires_at * 1000);\n        const now = new Date();\n        const timeUntilExpiry = expiryTime.getTime() - now.getTime();\n        const hoursUntilExpiry = Math.round(timeUntilExpiry / (1000 * 60 * 60));\n        \n        if (hoursUntilExpiry > 0) {\n          expiryInfo = ` (expires in ${hoursUntilExpiry} hours)`;\n        } else {\n          expiryInfo = ' (expired, auto-refresh active)';\n        }\n      }\n      \n      const response: ApiStatusResponse = {\n        status: \"success\",\n        message: `‚úÖ FitScore GPT API is running - WHOOP: ${tokenStatus}${expiryInfo} - Auto-refresh: enabled`\n      };\n      res.json(response);\n    } catch (error) {\n      const response: ApiStatusResponse = {\n        status: \"success\",\n        message: \"‚úÖ FitScore GPT API is running - WHOOP: not connected - Auto-refresh: enabled\"\n      };\n      res.json(response);\n    }\n  });\n\n  // GET handler for browser testing of refresh-tokens endpoint\n  app.get('/api/whoop/refresh-tokens', async (req, res) => {\n    const authSecret = req.query.auth as string;\n    const expectedSecret = process.env.N8N_SECRET_TOKEN || 'fitgpt-secret-2025';\n    \n    if (!authSecret || authSecret !== expectedSecret) {\n      return res.status(401).json({ error: 'Unauthorized' });\n    }\n    \n    res.json({ \n      status: 'GET ok', \n      message: 'GET endpoint working - use POST for actual token refresh',\n      auth_valid: true \n    });\n  });\n\n  // Bulk WHOOP token refresh endpoint for n8n automation\n  app.post('/api/whoop/refresh-tokens', async (req, res) => {\n    try {\n      // Force JSON content type header\n      res.setHeader('Content-Type', 'application/json');\n      \n      // Check authentication via query parameter\n      const authSecret = req.query.auth as string;\n      const expectedSecret = process.env.N8N_SECRET_TOKEN || 'fitgpt-secret-2025';\n      \n      if (!authSecret || authSecret !== expectedSecret) {\n        return res.status(401).json({ error: 'Unauthorized' });\n      }\n      \n      console.log('[TOKEN REFRESH] Starting bulk token refresh process...');\n      \n      // Get all WHOOP tokens from database\n      const allTokens = await whoopTokenStorage.getAllTokens();\n      console.log(`[TOKEN REFRESH] Found ${allTokens.length} tokens to check`);\n      \n      if (allTokens.length === 0) {\n        return res.json({\n          message: 'No WHOOP tokens found in database',\n          updated_users: [],\n          total_checked: 0,\n          total_refreshed: 0\n        });\n      }\n      \n      const updatedUsers: string[] = [];\n      let totalChecked = 0;\n      let totalRefreshed = 0;\n      \n      for (const token of allTokens) {\n        totalChecked++;\n        \n        try {\n          // Check if token is expired or expires soon (within 1 hour)\n          const currentTime = Math.floor(Date.now() / 1000);\n          const expiresAt = token.expiresAt ? Math.floor(token.expiresAt.getTime() / 1000) : null;\n          \n          if (!expiresAt) {\n            console.log(`[TOKEN REFRESH] Token for user ${token.userId} has no expiry time, skipping`);\n            continue;\n          }\n          \n          // Refresh if expired or expires within 1 hour (3600 seconds)\n          const needsRefresh = (expiresAt - currentTime) <= 3600;\n          \n          if (!needsRefresh) {\n            const hoursUntilExpiry = Math.round((expiresAt - currentTime) / 3600);\n            console.log(`[TOKEN REFRESH] Token for user ${token.userId} expires in ${hoursUntilExpiry} hours, not refreshing`);\n            continue;\n          }\n          \n          if (!token.refreshToken) {\n            console.log(`[TOKEN REFRESH] Token for user ${token.userId} is expired but has no refresh token`);\n            continue;\n          }\n          \n          console.log(`[TOKEN REFRESH] Refreshing token for user ${token.userId}...`);\n          \n          // Attempt to refresh the token\n          const newToken = await whoopTokenStorage.refreshWhoopToken(token.userId, token.refreshToken);\n          \n          if (newToken) {\n            updatedUsers.push(token.userId);\n            totalRefreshed++;\n            console.log(`[TOKEN REFRESH] Successfully refreshed token for user ${token.userId}`);\n          } else {\n            console.log(`[TOKEN REFRESH] Failed to refresh token for user ${token.userId}`);\n          }\n          \n        } catch (error) {\n          console.error(`[TOKEN REFRESH] Error processing token for user ${token.userId}:`, error);\n        }\n      }\n      \n      // Always return JSON regardless of content negotiation\n      res.setHeader('Content-Type', 'application/json');\n      \n      const result = {\n        message: `Bulk token refresh completed. Checked ${totalChecked} tokens, refreshed ${totalRefreshed}`,\n        updated_users: updatedUsers,\n        total_checked: totalChecked,\n        total_refreshed: totalRefreshed,\n        timestamp: new Date().toISOString()\n      };\n      \n      console.log('[TOKEN REFRESH] Bulk refresh completed:', result);\n      res.json(result);\n      \n    } catch (error) {\n      console.error('[TOKEN REFRESH] Bulk refresh failed:', error);\n      res.status(500).json({ \n        error: 'Failed to refresh tokens',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // WHOOP OAuth login endpoint\n  app.get('/api/whoop/login', (req, res) => {\n    try {\n      const oauthUrl = whoopApiService.getOAuthUrl();\n      console.log('Redirecting to WHOOP OAuth:', oauthUrl);\n      res.redirect(oauthUrl);\n    } catch (error) {\n      console.error('Failed to initiate WHOOP OAuth:', error);\n      res.status(500).json({ error: 'Failed to initiate WHOOP authentication' });\n    }\n  });\n\n  // WHOOP OAuth callback endpoint - CLEAN IMPLEMENTATION FOLLOWING CHECKLIST\n  app.get('/api/whoop/callback', async (req, res, next) => {\n    try {\n      console.log('[WHOOP AUTH] OAuth callback received');\n      const { code, error, state } = req.query;\n      \n      if (error) {\n        console.error('[WHOOP AUTH] OAuth error:', error);\n        return res.status(400).json({ error: 'OAuth authentication failed', details: error });\n      }\n\n      if (!code) {\n        console.error('[WHOOP AUTH] No authorization code received');\n        return res.status(400).json({ error: 'No authorization code received' });\n      }\n\n      if (!state || !state.toString().startsWith('whoop_auth_')) {\n        console.error('[WHOOP AUTH] Invalid state parameter:', state);\n        return res.status(400).json({ error: 'Invalid state parameter' });\n      }\n\n      console.log('[WHOOP AUTH] Exchanging code for token...');\n      const tokenResponse = await whoopApiService.exchangeCodeForToken(code as string);\n      \n      console.log('[WHOOP AUTH] Getting user profile...');\n      const userProfile = await whoopApiService.getUserProfile(tokenResponse.access_token);\n      const whoopUserId = `whoop_${userProfile.user_id}`;\n      \n      console.log(`[WHOOP AUTH] User authenticated: ${whoopUserId}`);\n      console.log(`[WHOOP AUTH] Full user profile:`, JSON.stringify(userProfile, null, 2));\n      \n      // Create or get user in database with admin role check\n      const userEmail = `${whoopUserId}@fitscore.local`;\n      const adminWhoopId = process.env.ADMIN_WHOOP_ID || '25283528';\n      const isAdmin = userProfile.user_id.toString() === adminWhoopId;\n      \n      const userData = {\n        id: whoopUserId,\n        email: userEmail,\n        whoopUserId: userProfile.user_id.toString(),\n        role: isAdmin ? 'admin' : 'user'\n      };\n      \n      console.log(`[WHOOP AUTH] User role assignment: ${isAdmin ? 'admin' : 'user'} (Admin WHOOP ID: ${adminWhoopId})`);\n      \n      // Insert or update user in database with detailed logging\n      console.log(`[WHOOP AUTH] Attempting to upsert user:`, userData);\n      try {\n        // Check if user exists first\n        const existingUser = await db.select().from(users).where(eq(users.id, whoopUserId)).limit(1);\n        if (existingUser.length === 0) {\n          // User doesn't exist, create new one\n          await db.insert(users).values(userData);\n          console.log(`[WHOOP AUTH] New user created in database: ${whoopUserId}`);\n        } else {\n          // User exists, update their information including role\n          await db.update(users).set({\n            email: userData.email,\n            whoopUserId: userData.whoopUserId,\n            role: userData.role,\n            updatedAt: new Date()\n          }).where(eq(users.id, whoopUserId));\n          console.log(`[WHOOP AUTH] Existing user updated in database: ${whoopUserId}`);\n        }\n      } catch (userError) {\n        console.error(`[WHOOP AUTH] User upsert failed:`, userError);\n        throw new Error(`Failed to create user: ${userError.message}`);\n      }\n      \n      // Verify user exists before creating token\n      const existingUser = await db.select().from(users).where(eq(users.id, whoopUserId)).limit(1);\n      if (existingUser.length === 0) {\n        throw new Error(`User verification failed - user ${whoopUserId} not found after upsert`);\n      }\n      console.log(`[WHOOP AUTH] User verified in database: ${whoopUserId}`);\n      \n      // Generate long-lived JWT token for Custom GPT integration (10 years)\n      const { generateJWT } = await import('./jwtAuth');\n      const staticJwtToken = generateJWT(whoopUserId, userData.role);\n      console.log(`[WHOOP AUTH] Generated static JWT token for user: ${whoopUserId} (10-year expiration)`);\n      \n      // Store the token with proper expiration using WHOOP user ID, including static JWT\n      const tokenData = {\n        access_token: tokenResponse.access_token,\n        refresh_token: tokenResponse.refresh_token,\n        expires_at: tokenResponse.expires_in ? Math.floor(Date.now() / 1000) + tokenResponse.expires_in : undefined,\n        user_id: whoopUserId,\n        static_jwt: staticJwtToken\n      };\n      \n      console.log(`[WHOOP AUTH] Attempting to store token for user: ${whoopUserId}`);\n      try {\n        await whoopTokenStorage.setToken(whoopUserId, tokenData);\n        console.log(`[WHOOP AUTH] Token and static JWT stored successfully for WHOOP user ${whoopUserId}`);\n      } catch (tokenError) {\n        console.error(`[WHOOP AUTH] Token storage failed:`, tokenError);\n        throw new Error(`Failed to store token: ${tokenError.message}`);\n      }\n      console.log(`[WHOOP AUTH] Token stored for WHOOP user ${whoopUserId} with expiration:`, tokenData.expires_at ? new Date(tokenData.expires_at * 1000) : 'no expiration');\n      \n      // Immediately fetch and store today's WHOOP data\n      console.log(`[WHOOP AUTH] Fetching today's WHOOP data for user: ${whoopUserId}`);\n      try {\n        const today = new Date().toISOString().split('T')[0];\n        const whoopDataResult = await whoopApiService.getTodaysData(whoopUserId);\n        \n        if (whoopDataResult && whoopDataResult.recovery_score !== undefined) {\n          const whoopDataRecord = {\n            userId: whoopUserId,\n            date: today,\n            recoveryScore: Math.round(whoopDataResult.recovery_score),\n            sleepScore: Math.round(whoopDataResult.sleep_hours * 10) || 0, // Convert hours to score\n            strainScore: Math.round((whoopDataResult.strain || 0) * 10), // Store as integer * 10\n            restingHeartRate: Math.round(whoopDataResult.resting_heart_rate || 0)\n          };\n          \n          // Store with unique key whoop_data_<id>_<yyyy-mm-dd>\n          await storage.upsertWhoopData(whoopDataRecord);\n          console.log(`[WHOOP AUTH] Today's data stored for user: ${whoopUserId}`, whoopDataRecord);\n        }\n      } catch (dataError) {\n        console.error(`[WHOOP AUTH] Failed to fetch initial WHOOP data:`, dataError);\n        // Continue with authentication even if data fetch fails\n      }\n      \n      console.log(`[WHOOP AUTH] Using static JWT token for redirect to user: ${whoopUserId} with role: ${userData.role}`);\n      \n      // Redirect to dashboard with the same static JWT token\n      res.redirect(`/#token=${staticJwtToken}`);\n      \n    } catch (error) {\n      console.error('[WHOOP AUTH] Callback error:', error);\n      \n      // Check if it's a token exchange error (common with expired/used auth codes)\n      if (error.message?.includes('invalid_grant') || error.message?.includes('HTTP 400') || error.message?.includes('request_forbidden')) {\n        console.log('[WHOOP AUTH] OAuth error detected:', error.message);\n        console.log('[WHOOP AUTH] This usually means the authorization code was expired, used, or invalid');\n        console.log('[WHOOP AUTH] Redirecting user to retry OAuth flow with fresh authorization code');\n        \n        // Return error page with retry option instead of automatic redirect\n        const retryHtml = `\n          <!DOCTYPE html>\n          <html>\n            <head>\n              <title>WHOOP Authentication Error</title>\n              <style>\n                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; padding: 40px; background: #0f172a; color: white; text-align: center; }\n                .error { background: #dc2626; padding: 20px; border-radius: 8px; margin: 20px 0; }\n                .retry-info { background: #1e293b; padding: 15px; border-radius: 8px; margin: 20px 0; }\n                .retry-btn { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }\n                .retry-btn:hover { background: #2563eb; }\n              </style>\n            </head>\n            <body>\n              <div class=\"error\">\n                <h1>‚ö†Ô∏è WHOOP Authentication Error</h1>\n                <p>Error: ${error.message}</p>\n                <p>This usually happens when the authorization code expires or is used more than once.</p>\n              </div>\n              <div class=\"retry-info\">\n                <p>Please try authenticating again with a fresh authorization code.</p>\n                <button class=\"retry-btn\" onclick=\"window.location.href='/api/whoop/login'\">\n                  üîÑ Retry WHOOP Authentication\n                </button>\n              </div>\n              <script>\n                console.error('[WHOOP AUTH] OAuth error:', '${error.message}');\n              </script>\n            </body>\n          </html>\n        `;\n        \n        return res.status(400).send(retryHtml);\n      }\n      \n      // Return HTML error page for popup\n      const html = `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>WHOOP Authentication Error</title>\n            <style>\n              body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }\n              .error { color: #ef4444; font-size: 18px; margin-bottom: 20px; }\n              .message { color: #6b7280; }\n              .retry { margin-top: 20px; }\n              .retry a { color: #3b82f6; text-decoration: none; font-weight: bold; }\n              .retry { margin-top: 20px; }\n              .retry a { color: #3b82f6; text-decoration: none; font-weight: bold; }\n            </style>\n          </head>\n          <body>\n            <div class=\"error\">‚ùå Authentication Failed</div>\n            <div class=\"message\">WHOOP authentication encountered an error: ${error instanceof Error ? error.message : 'An error occurred during authentication'}</div>\n            <div class=\"retry\">\n              <a href=\"/api/whoop/login\">üîÑ Try Again</a>\n            </div>\n            <div class=\"message\">This window will close automatically...</div>\n            <script>\n              setTimeout(() => window.close(), 3000);\n            </script>\n          </body>\n        </html>\n      `;\n      \n      res.setHeader('Content-Type', 'text/html');\n      res.status(500).send(html);\n    }\n  });\n\n  // WHOOP raw data debug endpoint (JWT-authenticated)\n  app.get('/api/whoop/raw', requireJWTAuth, async (req, res) => {\n    try {\n      const userId = getCurrentUserId(req);\n      console.log(`[WHOOP RAW] Getting raw WHOOP data for user: ${userId}`);\n      \n      if (!userId) {\n        return res.status(401).json({ \n          error: 'Authentication required',\n          message: 'Please authenticate with WHOOP to access this resource'\n        });\n      }\n      \n      // Fetch comprehensive raw data for debugging\n      const rawData = await whoopApiService.getTodaysData(userId);\n      \n      return res.json({\n        timestamp: new Date().toISOString(),\n        userId: userId,\n        rawData: rawData,\n        message: 'Raw WHOOP API response for debugging purposes'\n      });\n      \n    } catch (error: any) {\n      console.error('[WHOOP RAW] Error:', error.message);\n      res.status(500).json({ \n        error: 'Failed to fetch raw WHOOP data',\n        details: error.message \n      });\n    }\n  });\n\n  // WHOOP authentication status endpoint\n  app.get('/api/whoop/status', requireJWTAuth, async (req, res) => {\n    // Disable caching for this endpoint\n    res.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n    res.set('Pragma', 'no-cache');\n    res.set('Expires', '0');\n    \n    try {\n      const userId = getCurrentUserId(req);\n      const tokenData = await whoopTokenStorage.getToken(userId!);\n      \n      if (!tokenData) {\n        return res.json({\n          authenticated: false,\n          message: 'No WHOOP token found',\n          auth_url: '/api/whoop/login'\n        });\n      }\n\n      const isValid = whoopTokenStorage.isTokenValid(tokenData);\n      \n      if (!isValid) {\n        return res.json({\n          authenticated: false,\n          message: 'WHOOP token has expired',\n          auth_url: '/api/whoop/login',\n          expires_at: tokenData.expires_at\n        });\n      }\n\n      // Test the token against the WHOOP API to make sure it's actually valid\n      try {\n        const headers = { Authorization: `Bearer ${tokenData.access_token}` };\n        console.log('[TOKEN TEST] Testing token against WHOOP API...');\n        const testResponse = await axios.get('https://api.prod.whoop.com/developer/v1/user/profile/basic', { \n          headers,\n          timeout: 5000\n        });\n        \n        console.log('[TOKEN TEST] Token test successful, status:', testResponse.status);\n        res.json({\n          authenticated: true,\n          message: 'WHOOP token is valid',\n          auth_url: null,\n          expires_at: tokenData.expires_at\n        });\n      } catch (tokenError: any) {\n        // Token appears valid but fails API validation\n        console.error('[TOKEN TEST] Token validation failed:', tokenError.response?.status || tokenError.message);\n        res.json({\n          authenticated: false,\n          message: 'WHOOP token is invalid or expired',\n          auth_url: '/api/whoop/login',\n          expires_at: tokenData.expires_at\n        });\n      }\n    } catch (error) {\n      console.error('Error checking WHOOP status:', error);\n      res.status(500).json({ error: 'Failed to check WHOOP authentication status' });\n    }\n  });\n\n  // Debug endpoint to test OAuth URL generation\n  app.get('/api/whoop/debug', async (req, res) => {\n    try {\n      const oauthUrl = whoopApiService.getOAuthUrl();\n      const defaultUserId = await getDefaultUserId();\n      const tokenData = await whoopTokenStorage.getToken(defaultUserId);\n      res.json({\n        oauth_url: oauthUrl,\n        client_id: process.env.WHOOP_CLIENT_ID,\n        redirect_uri: 'https://health-data-hub.replit.app/api/whoop/callback',\n        status: 'OAuth flow ready',\n        has_token: !!tokenData,\n        token_valid: tokenData ? whoopTokenStorage.isTokenValid(tokenData) : false\n      });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to generate OAuth URL' });\n    }\n  });\n\n  // Test endpoint to manually create session (for debugging authentication)\n  app.post('/api/whoop/test-session', async (req, res) => {\n    try {\n      const { user_id } = req.body;\n      \n      if (!user_id) {\n        return res.status(400).json({ error: 'user_id required' });\n      }\n      \n      const whoopUserId = `whoop_${user_id}`;\n      \n      // Set session manually for testing\n      const session = req.session as any;\n      session.userId = whoopUserId;\n      \n      console.log(`[TEST SESSION] Setting session userId to: ${whoopUserId}`);\n      console.log(`[TEST SESSION] Session before save:`, session);\n      \n      // Save session and return success\n      req.session.save((err) => {\n        if (err) {\n          console.error('[TEST SESSION] Session save error:', err);\n          return res.status(500).json({ error: 'Session creation failed' });\n        }\n        \n        console.log(`[TEST SESSION] Session saved successfully for WHOOP user ${whoopUserId}`);\n        console.log(`[TEST SESSION] Session after save:`, req.session);\n        \n        // Force session modification and save\n        req.session.touch();\n        (req.session as any).modified = true;\n        \n        req.session.save((saveErr) => {\n          if (saveErr) {\n            console.error('[TEST SESSION] Session save failed:', saveErr);\n            return res.status(500).json({ error: 'Session save failed' });\n          }\n          \n          // Manually set the Set-Cookie header for testing\n          const cookieName = 'fitscore.sid';\n          const cookieValue = req.sessionID;\n          const isProduction = process.env.NODE_ENV === 'production' || !!process.env.REPLIT_DOMAINS;\n          const isReplotDeployment = !!process.env.REPLIT_DOMAINS;\n          \n          let cookieHeader = `${cookieName}=${cookieValue}; Path=/; HttpOnly; Max-Age=${7 * 24 * 60 * 60}`;\n          \n          if (isProduction) {\n            cookieHeader += '; Secure; SameSite=None';\n          } else {\n            cookieHeader += '; SameSite=Lax';\n          }\n          \n          if (isReplotDeployment) {\n            cookieHeader += '; Domain=.replit.app';\n          }\n          \n          res.setHeader('Set-Cookie', cookieHeader);\n          console.log(`[TEST SESSION] Manually set Set-Cookie header: ${cookieHeader}`);\n          console.log(`[TEST SESSION] Session saved successfully with cookie transmission`);\n          \n          res.json({ \n            message: 'Test session created successfully',\n            userId: whoopUserId,\n            sessionId: req.sessionID,\n            cookieSet: true\n          });\n        });\n\n      });\n      \n    } catch (error) {\n      console.error('Error creating test session:', error);\n      res.status(500).json({ error: 'Failed to create test session' });\n    }\n  });\n\n  // Session debugging endpoint\n  console.log('[ROUTE] GET /api/session/debug');\n  app.get('/api/session/debug', (req, res) => {\n    const userId = getCurrentUserId(req);\n    res.json({\n      sessionId: req.sessionID,\n      userId: userId,\n      sessionExists: !!req.session,\n      sessionKeys: req.session ? Object.keys(req.session) : [],\n      cookies: req.headers.cookie,\n      timestamp: new Date().toISOString()\n    });\n  });\n\n  // Test endpoint to manually set a WHOOP token for debugging\n  app.post('/api/whoop/test-token', async (req, res) => {\n    try {\n      const { access_token, refresh_token, expires_in, user_id } = req.body;\n      \n      if (!access_token || !user_id) {\n        return res.status(400).json({ \n          error: 'Missing required fields: access_token and user_id are required' \n        });\n      }\n      \n      // Use the user_id from request to format as WHOOP user ID\n      const whoopUserId = `whoop_${user_id}`;\n      \n      // First ensure the user exists in the database\n      try {\n        const userData = {\n          id: whoopUserId,\n          email: `${whoopUserId}@fitscore.local`,\n          whoopUserId: user_id.toString()\n        };\n        \n        await db.insert(users).values(userData).onConflictDoUpdate({\n          target: users.id,\n          set: {\n            email: userData.email,\n            whoopUserId: userData.whoopUserId,\n            updatedAt: new Date()\n          }\n        });\n        \n        console.log(`Test user created/updated: ${whoopUserId}`);\n      } catch (userError) {\n        console.error('Failed to create test user:', userError);\n        return res.status(500).json({ error: 'Failed to create test user' });\n      }\n      \n      await whoopTokenStorage.setToken(whoopUserId, {\n        access_token: access_token,\n        refresh_token: refresh_token,\n        expires_at: expires_in ? Math.floor(Date.now() / 1000) + expires_in : Math.floor(Date.now() / 1000) + (24 * 60 * 60),\n        user_id: whoopUserId\n      });\n\n      res.json({ \n        message: 'Test token stored successfully',\n        status: 'authenticated'\n      });\n    } catch (error) {\n      console.error('Error setting test token:', error);\n      res.status(500).json({ error: 'Failed to set test token' });\n    }\n  });\n\n  // WHOOP today's data endpoint (JWT-authenticated)\n  app.get('/api/whoop/today', requireJWTAuth, async (req, res) => {\n    console.log(`[WHOOP TODAY] *** ENDPOINT CALLED *** This should always appear in logs`);\n    try {\n      const userId = getCurrentUserId(req);\n      const sourceLive = req.query.source === 'live';\n      const invalidateCache = req.query.invalidate === '1';\n      const tz = process.env.USER_TZ || 'Europe/Zurich';\n      const todayDate = todayKey(tz);\n      \n      console.log(`[WHOOP TODAY] Getting today's WHOOP data for user: ${userId}, source: ${sourceLive ? 'live' : 'auto'}, invalidate: ${invalidateCache}`);\n      \n      if (!userId) {\n        return res.status(401).json({ \n          error: 'Authentication required',\n          message: 'Please authenticate with WHOOP to access this resource'\n        });\n      }\n      \n      // Handle cache invalidation if requested\n      if (invalidateCache) {\n        console.log(`[WHOOP TODAY] Invalidating cache for user=${userId} date=${todayDate}`);\n        await storage.deleteWhoopDataByUserAndDate(userId, todayDate);\n      }\n      \n      // If source=live, bypass cache and fetch directly from WHOOP\n      let shouldTryLive = sourceLive || true; // Always try live first unless only cache requested\n      let freshData = null;\n      let source = 'cache';\n      \n      if (shouldTryLive) {\n        console.log(`[WHOOP TODAY] Attempting to fetch fresh WHOOP data for user: ${userId}`);\n        \n        try {\n          console.log(`[WHOOP TODAY] About to call whoopApiService.getTodaysData for user: ${userId}`);\n          freshData = await whoopApiService.getTodaysData(userId);\n          \n          if (freshData && typeof freshData.recovery_score === 'number') {\n            // Store the fresh data in cache\n            await storage.upsertWhoopData({\n              userId: userId,\n              date: todayDate,\n              recoveryScore: Math.round(freshData.recovery_score),\n              sleepScore: Math.round(freshData.sleep_score || 0), // Store sleep score as percentage\n              strainScore: freshData.strain || 0, // Store strain as decimal for precision\n              restingHeartRate: Math.round(freshData.resting_heart_rate || 0),\n              sleepHours: freshData.sleep_hours || 0,\n              hrv: freshData.hrv || 0, // Store HRV as decimal for precision\n              respiratoryRate: freshData.respiratory_rate || 0,\n              skinTempCelsius: freshData.skin_temperature || 0,\n              spo2Percentage: freshData.spo2_percentage || 0,\n              averageHeartRate: Math.round(freshData.average_heart_rate || 0)\n            });\n            \n            source = 'live';\n            console.log(`[WHOOP TODAY] user=${userId} date=${todayDate} source=${source} values: rec=${Math.round(freshData.recovery_score)}% sleepScore=${Math.round(freshData.sleep_score)}% hours=${freshData.sleep_hours} strain=${freshData.strain} hrv=${Math.round(freshData.hrv)} rhr=${Math.round(freshData.resting_heart_rate)}`);\n            \n            return res.json({\n              recovery_score: freshData.recovery_score,\n              sleep_score: freshData.sleep_score,\n              sleep_hours: freshData.sleep_hours,\n              strain: freshData.strain,\n              resting_heart_rate: freshData.resting_heart_rate,\n              hrv: Math.round(freshData.hrv),\n              date: todayDate,\n              user_id: userId,\n              timestamp: new Date().toISOString(),\n              source: 'live'\n            });\n          }\n        } catch (fetchError: any) {\n          console.log(`[WHOOP TODAY] Live fetch failed: ${fetchError.message}`);\n          // Continue to cache fallback\n        }\n      }\n      \n      // Try cached data if live failed or wasn't requested\n      if (!sourceLive || !freshData) {\n        console.log(`[WHOOP TODAY] Looking for cached data with userId: ${userId}, date: ${todayDate}`);\n        const cachedData = await storage.getWhoopDataByUserAndDate(userId, todayDate);\n        \n        if (cachedData) {\n          source = 'cache';\n          console.log(`[WHOOP TODAY] user=${userId} date=${todayDate} source=${source} values: rec=${cachedData.recoveryScore}% sleepScore=${cachedData.sleepScore}% hours=${cachedData.sleepHours} strain=${cachedData.strainScore / 10} hrv=${cachedData.hrv} rhr=${cachedData.restingHeartRate}`);\n          \n          return res.json({\n            recovery_score: cachedData.recoveryScore,\n            sleep_score: cachedData.sleepScore,\n            sleep_hours: cachedData.sleepHours || null,\n            strain: cachedData.strainScore / 10, // Convert back from stored int√ó10\n            resting_heart_rate: cachedData.restingHeartRate,\n            hrv: cachedData.hrv || null,\n            date: todayDate,\n            user_id: userId,\n            timestamp: new Date().toISOString(),\n            source: 'cache'\n          });\n        }\n      }\n      console.log(`[WHOOP TODAY] No fresh or cached data available for user: ${userId}`);\n      return res.status(404).json({\n        error: 'No WHOOP data available',\n        message: 'Please complete WHOOP OAuth authentication to fetch today\\'s data',\n        date: todayDate\n      });\n      \n    } catch (error: any) {\n      console.error('[WHOOP TODAY] Error:', error.message);\n      res.status(500).json({ \n        error: 'Failed to fetch WHOOP data',\n        details: error.message\n      });\n    }\n  });\n\n  // Secure WHOOP data endpoint for n8n automation\n  app.get('/api/whoop/n8n', async (req, res) => {\n    const token = req.headers['authorization'];\n\n    // Check for secret token passed by n8n\n    if (token !== `Bearer ${process.env.N8N_SECRET_TOKEN}`) {\n      return res.status(403).json({ error: 'Unauthorized: Invalid token' });\n    }\n\n    try {\n      console.log('[N8N ENDPOINT] Fetching WHOOP data for n8n automation...');\n      \n      // Use the enhanced token validation that includes automatic refresh\n      const defaultUserId = await getDefaultUserId();\n      const whoopData = await whoopApiService.getTodaysData(defaultUserId);\n      \n      // Store in database for caching\n      const todayDate = getTodayDate();\n      await storage.createOrUpdateWhoopData({\n        userId: defaultUserId,\n        date: todayDate,\n        recoveryScore: Math.round(whoopData.recovery_score || 0),\n        sleepScore: Math.round(whoopData.sleep_hours || 0), // Fixed: use sleep_hours instead of sleep_score\n        strainScore: Math.round((whoopData.strain || 0) * 10), // Store as integer * 10\n        restingHeartRate: Math.round(whoopData.resting_heart_rate || 0)\n      });\n\n      // Log daily stats to userProfile.json\n      const dailyEntry = {\n        date: todayDate,\n        recovery_score: whoopData.recovery_score,\n        strain_score: whoopData.strain,\n        sleep_hours: whoopData.sleep_hours,\n        hrv: whoopData.hrv\n      };\n      logDailyStats(dailyEntry);\n\n      // Return the response format optimized for n8n\n      const result = {\n        cycle_id: whoopData.cycle_id,\n        strain: whoopData.strain,\n        recovery_score: whoopData.recovery_score,\n        hrv: whoopData.hrv,\n        resting_heart_rate: whoopData.resting_heart_rate,\n        sleep_hours: whoopData.sleep_hours,\n        date: todayDate,\n        timestamp: new Date().toISOString(),\n        raw: whoopData.raw\n      };\n\n      console.log('[N8N ENDPOINT] WHOOP data retrieved successfully for n8n');\n      res.json(result);\n    } catch (error: any) {\n      console.error('[N8N ENDPOINT] n8n WHOOP fetch failed:', error.message);\n      \n      // Check if it's a token-related error and provide helpful message\n      if (error.message.includes('token') || error.message.includes('access')) {\n        return res.status(401).json({ \n          error: 'WHOOP authentication failed',\n          message: 'Please visit /api/whoop/login to re-authenticate with WHOOP',\n          auth_url: '/api/whoop/login'\n        });\n      }\n      \n      res.status(500).json({ \n        error: 'Failed to fetch WHOOP data',\n        message: error.message\n      });\n    }\n  });\n\n  // Token refresh test endpoint\n  app.post('/api/whoop/test-token-refresh', async (req, res) => {\n    try {\n      console.log('[TOKEN REFRESH TEST] Starting token refresh test...');\n      \n      // Get current token\n      const defaultUserId = await getDefaultUserId();\n      const currentToken = await whoopTokenStorage.getToken(defaultUserId);\n      if (!currentToken) {\n        return res.status(401).json({ error: 'No token found to test' });\n      }\n\n      console.log('[TOKEN REFRESH TEST] Current token expires at:', currentToken.expires_at);\n      console.log('[TOKEN REFRESH TEST] Current time:', Math.floor(Date.now() / 1000));\n      console.log('[TOKEN REFRESH TEST] Token valid:', whoopTokenStorage.isTokenValid(currentToken));\n      \n      // Simulate token expiration by temporarily setting expires_at to past\n      if (currentToken.expires_at) {\n        const expiredToken = {\n          ...currentToken,\n          expires_at: Math.floor(Date.now() / 1000) - 3600 // 1 hour ago\n        };\n        \n        await whoopTokenStorage.setToken(defaultUserId, expiredToken);\n        console.log('[TOKEN REFRESH TEST] Token manually expired for testing');\n      }\n      \n      // Test the automatic refresh via getValidWhoopToken\n      try {\n        const refreshedToken = await whoopApiService.getValidWhoopToken(defaultUserId);\n        console.log('[TOKEN REFRESH TEST] Token refresh successful');\n        \n        res.json({\n          success: true,\n          message: 'Token refresh test completed successfully',\n          original_expires_at: currentToken.expires_at,\n          new_expires_at: refreshedToken.expires_at,\n          refresh_worked: true\n        });\n      } catch (refreshError: any) {\n        console.error('[TOKEN REFRESH TEST] Token refresh failed:', refreshError.message);\n        \n        // Restore original token\n        await whoopTokenStorage.setToken(defaultUserId, currentToken);\n        \n        res.json({\n          success: false,\n          message: 'Token refresh failed',\n          error: refreshError.message,\n          refresh_worked: false,\n          reason: refreshError.message.includes('refresh token') ? 'No refresh token available' : 'Refresh API failed'\n        });\n      }\n    } catch (error: any) {\n      console.error('[TOKEN REFRESH TEST] Test failed:', error.message);\n      res.status(500).json({ \n        error: 'Token refresh test failed',\n        message: error.message\n      });\n    }\n  });\n\n  // Test endpoint to generate JWT token for testing (development only)\n  console.log('[ROUTE] GET /api/test/jwt');\n  app.get('/api/test/jwt', async (req, res) => {\n    try {\n      const { generateJWT } = await import('./jwtAuth');\n      const requestedUserId = req.query.userId as string;\n      const testUserId = requestedUserId ? `whoop_${requestedUserId}` : 'whoop_99999999';\n      const testToken = generateJWT(testUserId, 'user');\n      \n      console.log(`[TEST] Generated JWT token for test user: ${testUserId}`);\n      res.json({ \n        token: testToken,\n        userId: testUserId,\n        message: 'Test JWT token generated successfully'\n      });\n    } catch (error) {\n      console.error('[TEST] JWT generation error:', error);\n      res.status(500).json({ error: 'Failed to generate test JWT token' });\n    }\n  });\n\n  // Test endpoint to simulate WHOOP OAuth callback success\n  console.log('[ROUTE] GET /api/test/whoop-callback');\n  app.get('/api/test/whoop-callback', async (req, res) => {\n    try {\n      const testUserId = 'whoop_88888888';\n      \n      // Create user in database FIRST (before token) with conflict handling\n      const userEmail = `${testUserId}@fitscore.local`;\n      const adminWhoopId = process.env.ADMIN_WHOOP_ID;\n      const isAdmin = adminWhoopId && testUserId.replace('whoop_', '') === adminWhoopId;\n      \n      const userData = {\n        id: testUserId,\n        email: userEmail,\n        whoopUserId: testUserId.replace('whoop_', ''),\n        role: isAdmin ? 'admin' : 'user'\n      };\n      \n      console.log(`[TEST] Attempting to upsert user:`, userData);\n      try {\n        // Check if user exists first\n        const existingUser = await db.select().from(users).where(eq(users.id, testUserId)).limit(1);\n        if (existingUser.length === 0) {\n          // User doesn't exist, create new one\n          await db.insert(users).values(userData);\n          console.log(`[TEST] New user created in database: ${testUserId}`);\n        } else {\n          console.log(`[TEST] User already exists in database: ${testUserId}`);\n        }\n      } catch (userError) {\n        console.error(`[TEST] User upsert failed:`, userError);\n        // Continue execution even if user creation fails (user might already exist)\n      }\n      \n      // Then simulate token storage (after user exists)\n      await whoopTokenStorage.setToken(testUserId, {\n        access_token: 'test_access_token',\n        refresh_token: 'test_refresh_token', \n        expires_at: Math.floor(Date.now() / 1000) + 3600,\n        user_id: testUserId\n      });\n      \n      // Generate JWT token for authentication with role\n      const { generateJWT } = await import('./jwtAuth');\n      const authToken = generateJWT(testUserId, userData.role);\n      \n      console.log(`[TEST] JWT token generated for simulated user: ${testUserId}`);\n      \n      // Redirect to dashboard with token like real callback\n      res.redirect(`/#token=${authToken}`);\n      \n    } catch (error) {\n      console.error('[TEST] Simulated callback error:', error);\n      res.status(500).json({ error: 'Test callback failed', details: error.message });\n    }\n  });\n\n  // WHOOP weekly averages endpoint\n  app.get('/api/whoop/weekly', requireJWTAuth, async (req, res) => {\n    try {\n      console.log('Fetching weekly WHOOP averages...');\n      \n      // Get current user ID from session\n      const userId = getCurrentUserId(req);\n      \n      // Token validation using user-specific token\n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      const tokenData = await whoopTokenStorage.getToken(userId);\n      if (!tokenData?.access_token) {\n        return res.status(401).json({ error: 'Missing WHOOP access token for user' });\n      }\n\n      if (!whoopTokenStorage.isTokenValid(tokenData)) {\n        console.warn('WHOOP access token has expired. Re-authentication required.');\n        return res.status(401).json({ \n          error: 'WHOOP token expired',\n          message: 'Please visit /api/whoop/login to re-authenticate with WHOOP',\n          auth_url: '/api/whoop/login'\n        });\n      }\n      \n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      // Try WHOOP API first, fallback to cache if needed\n      let weeklyData;\n      try {\n        weeklyData = await whoopApiService.getWeeklyAverages(userId);\n        \n        // If API succeeds but returns null values, try cache fallback\n        if (!weeklyData || (weeklyData.avgRecovery === null && weeklyData.avgStrain === null && weeklyData.avgSleep === null && weeklyData.avgHRV === null)) {\n          console.log('WHOOP API returned null values, trying cache fallback');\n          throw new Error('No data from WHOOP API');\n        }\n        \n        console.log('Weekly WHOOP averages retrieved successfully from API');\n      } catch (error: any) {\n        console.log('Failed to get weekly data from WHOOP API, trying cache fallback');\n        \n        // Get 7 days of cached data as fallback using timezone-aware dates\n        const tz = process.env.USER_TZ || 'Europe/Zurich';\n        const cachedData = [];\n        for (let i = 0; i < 7; i++) {\n          const date = DateTime.now().setZone(tz).minus({ days: i }).toISODate();\n          const dayData = await storage.getWhoopDataByUserAndDate(userId, date);\n          if (dayData) cachedData.push(dayData);\n        }\n        \n        if (cachedData && cachedData.length > 0) {\n          // Calculate averages from cached data\n          const recoverySum = cachedData.reduce((sum, d) => sum + (d.recoveryScore || 0), 0);\n          const strainSum = cachedData.reduce((sum, d) => sum + (d.strainScore ? d.strainScore / 10 : 0), 0); // Convert back from stored √ó10\n          const sleepSum = cachedData.reduce((sum, d) => sum + (d.sleepScore || 0), 0);\n          const hrvSum = cachedData.reduce((sum, d) => sum + (d.hrv || 0), 0);\n          \n          const count = cachedData.length;\n          weeklyData = {\n            avgRecovery: recoverySum > 0 ? Math.round(recoverySum / count) : null,\n            avgStrain: strainSum > 0 ? Math.round((strainSum / count) * 10) / 10 : null,\n            avgSleep: sleepSum > 0 ? Math.round(sleepSum / count) : null,\n            avgHRV: hrvSum > 0 ? Math.round(hrvSum / count) : null\n          };\n          const used = 'cache-only';\n          console.log(`[WHOOP WEEKLY] user=${userId} tz=${tz} used=${used} avg: rec=${weeklyData.avgRecovery}, strain=${weeklyData.avgStrain}, sleep=${weeklyData.avgSleep}, hrv=${weeklyData.avgHRV}`);\n        } else {\n          weeklyData = { avgRecovery: null, avgStrain: null, avgSleep: null, avgHRV: null };\n        }\n      }\n      \n      res.json(weeklyData);\n    } catch (error: any) {\n      console.error('Error in /api/whoop/weekly:', error.message);\n      \n      if (error.response) {\n        console.error('WHOOP API Error Response:', {\n          status: error.response.status,\n          data: error.response.data,\n          endpoint: error.config?.url\n        });\n      }\n      \n      res.status(500).json({ \n        error: 'Failed to fetch weekly WHOOP averages',\n        details: error.message\n      });\n    }\n  });\n\n  // Cache management endpoints\n  app.delete('/api/cache/today', requireJWTAuth, async (req, res) => {\n    try {\n      const userId = getCurrentUserId(req);\n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      \n      const tz = process.env.USER_TZ || 'Europe/Zurich';\n      const todayDate = todayKey(tz);\n      \n      await storage.deleteWhoopDataByUserAndDate(userId, todayDate);\n      \n      res.json({\n        deleted: true,\n        date: todayDate\n      });\n    } catch (error: any) {\n      console.error('Error deleting today cache:', error.message);\n      res.status(500).json({ error: 'Failed to delete cache' });\n    }\n  });\n\n  app.delete('/api/cache/day/:date', requireJWTAuth, async (req, res) => {\n    try {\n      const userId = getCurrentUserId(req);\n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      \n      const date = req.params.date;\n      \n      // Validate YYYY-MM-DD format\n      if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n        return res.status(400).json({ error: 'Invalid date format. Use YYYY-MM-DD' });\n      }\n      \n      await storage.deleteWhoopDataByUserAndDate(userId, date);\n      \n      res.json({\n        deleted: true,\n        date: date\n      });\n    } catch (error: any) {\n      console.error('Error deleting day cache:', error.message);\n      res.status(500).json({ error: 'Failed to delete cache' });\n    }\n  });\n\n  // Raw WHOOP data endpoint for verification\n  app.get('/api/whoop/today/raw', requireJWTAuth, async (req, res) => {\n    try {\n      const userId = getCurrentUserId(req);\n      const sourceLive = req.query.source === 'live';\n      \n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      \n      if (sourceLive) {\n        const tz = process.env.USER_TZ || 'Europe/Zurich';\n        const todayDate = todayKey(tz);\n        \n        // Get raw WHOOP data\n        const rawData = await whoopApiService.getTodaysData(userId);\n        \n        // Extract and structure the response\n        const result = {\n          raw: {\n            cycle: rawData.raw_data?.cycle || null,\n            recovery: rawData.raw_data?.recovery || null,\n            sleep: rawData.raw_data?.sleep || null\n          },\n          mapped: {\n            recovery_score: rawData.recovery_score,\n            sleep_score: rawData.sleep_score,\n            sleep_hours: rawData.sleep_hours,\n            strain: rawData.strain,\n            hrv: rawData.hrv,\n            resting_heart_rate: rawData.resting_heart_rate\n          },\n          date: todayDate\n        };\n        \n        res.json(result);\n      } else {\n        res.status(400).json({ error: 'source=live parameter required for raw endpoint' });\n      }\n    } catch (error: any) {\n      console.error('Error fetching raw WHOOP data:', error.message);\n      res.status(500).json({ error: 'Failed to fetch raw data', details: error.message });\n    }\n  });\n\n  // WHOOP summary analytics endpoint\n  app.get('/api/whoop/summary', requireJWTAuth, async (req, res) => {\n    try {\n      const days = parseInt(req.query.days as string) || 7;\n      \n      // Validate days parameter\n      if (days < 1 || days > 365) {\n        return res.status(400).json({ \n          error: 'Invalid days parameter. Must be between 1 and 365.' \n        });\n      }\n\n      const averages = calculateAverages(days);\n      \n      console.log(`WHOOP summary calculated for last ${days} days:`, averages);\n      \n      res.json({\n        period_days: days,\n        ...averages\n      });\n    } catch (error: any) {\n      console.error('Error in /api/whoop/summary:', error.message);\n      res.status(500).json({ \n        error: 'Failed to calculate WHOOP summary',\n        details: error.message\n      });\n    }\n  });\n\n  // Meal upload endpoint\n  app.post('/api/meals', upload.array('mealPhotos', 10), async (req: Request, res: Response) => {\n    try {\n      console.log('Processing meal uploads...');\n      \n      const files = req.files as Express.Multer.File[];\n      if (!files || !Array.isArray(files) || files.length === 0) {\n        return res.status(400).json({ error: 'No files uploaded' });\n      }\n      \n      const today = getTodayDate();\n      const uploadedMeals = [];\n      \n      const userId = getCurrentUserId(req) || 'default-user';\n      \n      for (const file of files) {\n        const meal = await storage.createMeal({\n          userId: userId,\n          filename: file.filename,\n          originalName: file.originalname,\n          mimetype: file.mimetype,\n          size: file.size,\n          date: today\n        });\n        uploadedMeals.push(meal);\n      }\n      \n      console.log(`Uploaded ${uploadedMeals.length} meal images`);\n      res.json({ \n        message: `Successfully uploaded ${uploadedMeals.length} meal images`,\n        meals: uploadedMeals \n      });\n    } catch (error) {\n      console.error('Error uploading meals:', error);\n      res.status(500).json({ error: 'Failed to upload meal images' });\n    }\n  });\n\n  // Get today's meals endpoint\n  app.get('/api/meals/today', async (req, res) => {\n    try {\n      console.log('Fetching today\\'s meals...');\n      \n      const today = getTodayDate();\n      const meals = await storage.getMealsByDate(today);\n      \n      // Return full URLs including domain\n      const baseUrl = req.protocol + '://' + req.get('host');\n      const mealUrls = meals.map(meal => `${baseUrl}/uploads/${meal.filename}`);\n      \n      console.log(`Found ${meals.length} meals for today`);\n      res.json(mealUrls);\n    } catch (error) {\n      console.error('Error fetching meals:', error);\n      res.status(500).json({ error: 'Failed to fetch today\\'s meals' });\n    }\n  });\n\n  // Get all meals (for dashboard)\n  app.get('/api/meals', async (req, res) => {\n    try {\n      const meals = await storage.getAllMeals();\n      res.json(meals);\n    } catch (error) {\n      console.error('Error fetching all meals:', error);\n      res.status(500).json({ error: 'Failed to fetch meals' });\n    }\n  });\n\n  // User-specific calendar today's events endpoint\n  app.get('/api/calendar/today', requireJWTAuth, async (req, res) => {\n    try {\n      console.log('Fetching today\\'s calendar events...');\n      \n      // Get current user ID from session\n      const userId = getCurrentUserId(req);\n      \n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      \n      // Get user's calendars from database\n      const userCalendars = await storage.getUserCalendars(userId);\n      \n      if (userCalendars.length === 0) {\n        return res.json({\n          date: DateTime.now().setZone('Europe/Zurich').toISODate(),\n          events: [],\n          message: 'No calendars configured. Add a calendar in your profile to see events.'\n        });\n      }\n      \n      const calendarUrls = userCalendars\n        .filter(cal => cal.isActive)\n        .map(cal => cal.calendarUrl);\n      \n      // Use Europe/Zurich timezone for accurate date/time handling\n      const zurichTime = DateTime.now().setZone('Europe/Zurich');\n      const todayStart = zurichTime.startOf('day');\n      const todayEnd = zurichTime.endOf('day');\n      \n      const allEvents: any[] = [];\n      \n      // Fetch and parse each calendar\n      for (const calendarUrl of calendarUrls) {\n        try {\n          console.log(`Fetching calendar from: ${calendarUrl}`);\n          const response = await fetch(calendarUrl);\n          \n          if (!response.ok) {\n            console.error(`Failed to fetch calendar: ${response.status} ${response.statusText}`);\n            continue;\n          }\n          \n          const icsData = await response.text();\n          const parsedCal = ical.parseICS(icsData);\n          \n          // Filter events for today\n          Object.keys(parsedCal).forEach(key => {\n            const event = parsedCal[key];\n            \n            if (event.type === 'VEVENT' && event.start && event.summary) {\n              // Convert event times to Europe/Zurich timezone\n              const eventStart = DateTime.fromJSDate(new Date(event.start)).setZone('Europe/Zurich');\n              const eventEnd = event.end ? DateTime.fromJSDate(new Date(event.end)).setZone('Europe/Zurich') : eventStart;\n              \n              // Check if event is today and not in the past\n              const now = DateTime.now().setZone('Europe/Zurich');\n              const isToday = eventStart >= todayStart && eventStart <= todayEnd;\n              const isFutureOrActive = eventEnd >= now;\n              \n              if (isToday && isFutureOrActive) {\n                allEvents.push({\n                  title: event.summary,\n                  start: eventStart.toISO(), // Returns ISO string with timezone info\n                  location: event.location || null,\n                  startTime: eventStart.toFormat('HH:mm'), // 24-hour format for display\n                  endTime: eventEnd.toFormat('HH:mm')\n                });\n              }\n            }\n          });\n        } catch (error) {\n          console.error(`Error parsing calendar ${calendarUrl}:`, error);\n        }\n      }\n      \n      // Sort events by start time\n      allEvents.sort((a, b) => DateTime.fromISO(a.start).toMillis() - DateTime.fromISO(b.start).toMillis());\n      \n      const result = {\n        date: zurichTime.toISODate(), // Returns YYYY-MM-DD format\n        events: allEvents\n      };\n      \n      console.log(`Found ${allEvents.length} events for today`);\n      res.json(result);\n      \n    } catch (error) {\n      console.error('Error fetching calendar events:', error);\n      res.status(500).json({ \n        error: 'Failed to fetch calendar events',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // User-specific calendar events endpoint with date range support\n  app.get('/api/calendar/events', requireJWTAuth, async (req, res) => {\n    try {\n      const { start, end } = req.query as { start?: string; end?: string };\n      \n      if (!start || !end) {\n        return res.status(400).json({ error: 'start and end date parameters are required' });\n      }\n\n      console.log(`Fetching calendar events from ${start} to ${end}...`);\n      \n      // Get current user ID from session\n      const userId = getCurrentUserId(req);\n      \n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      \n      // Get user's calendars from database\n      const userCalendars = await storage.getUserCalendars(userId);\n      \n      if (userCalendars.length === 0) {\n        return res.json({\n          events: [],\n          range: { start, end },\n          message: 'No calendars configured. Add a calendar in your profile to see events.'\n        });\n      }\n      \n      const calendarUrls = userCalendars\n        .filter(cal => cal.isActive)\n        .map(cal => cal.calendarUrl);\n      \n      // Use Europe/Zurich timezone for date range\n      const rangeStart = DateTime.fromISO(start).setZone('Europe/Zurich').startOf('day');\n      const rangeEnd = DateTime.fromISO(end).setZone('Europe/Zurich').endOf('day');\n      \n      const allEvents: any[] = [];\n      \n      // Fetch and parse each calendar\n      for (const calendarUrl of calendarUrls) {\n        try {\n          console.log(`Fetching calendar from: ${calendarUrl}`);\n          const response = await fetch(calendarUrl);\n          \n          if (!response.ok) {\n            console.error(`Failed to fetch calendar: ${response.status} ${response.statusText}`);\n            continue;\n          }\n          \n          const icsData = await response.text();\n          const parsedCal = ical.parseICS(icsData);\n          \n          // Filter events for date range\n          Object.keys(parsedCal).forEach(key => {\n            const event = parsedCal[key];\n            \n            if (event.type === 'VEVENT' && event.start && event.summary) {\n              const eventStart = DateTime.fromJSDate(new Date(event.start)).setZone('Europe/Zurich');\n              const eventEnd = event.end ? DateTime.fromJSDate(new Date(event.end)).setZone('Europe/Zurich') : eventStart;\n              \n              // Check if event overlaps with the requested range\n              const eventOverlaps = eventStart <= rangeEnd && eventEnd >= rangeStart;\n              \n              if (eventOverlaps) {\n                allEvents.push({\n                  id: key,\n                  title: event.summary,\n                  start: eventStart.toISO(),\n                  end: eventEnd.toISO(),\n                  startTime: eventStart.toFormat('HH:mm'),\n                  endTime: eventEnd.toFormat('HH:mm'),\n                  location: event.location || null,\n                  date: eventStart.toISODate()\n                });\n              }\n            }\n          });\n        } catch (error) {\n          console.error(`Error parsing calendar ${calendarUrl}:`, error);\n        }\n      }\n      \n      // Sort events by start time\n      allEvents.sort((a, b) => DateTime.fromISO(a.start).toMillis() - DateTime.fromISO(b.start).toMillis());\n      \n      const result = {\n        events: allEvents,\n        range: {\n          start: rangeStart.toISODate(),\n          end: rangeEnd.toISODate()\n        }\n      };\n      \n      console.log(`Found ${allEvents.length} events in date range`);\n      res.json(result);\n      \n    } catch (error) {\n      console.error('Error fetching calendar events:', error);\n      res.status(500).json({ \n        error: 'Failed to fetch calendar events',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Calendar Management Endpoints\n  \n  // Get user's calendars\n  app.get('/api/calendars', requireJWTAuth, async (req, res) => {\n    try {\n      const userId = getCurrentUserId(req);\n      if (!userId) {\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n      const calendars = await storage.getUserCalendars(userId);\n      res.json(calendars);\n    } catch (error) {\n      console.error('Error fetching calendars:', error);\n      res.status(500).json({ error: 'Failed to fetch calendars' });\n    }\n  });\n\n  // Add new calendar\n  app.post('/api/calendars', requireJWTAuth, async (req, res) => {\n    try {\n      const { calendarUrl, calendarName } = req.body;\n      const userId = getCurrentUserId(req);\n      \n      console.log('[CALENDAR] Add request - URL:', calendarUrl, 'Name:', calendarName, 'UserId:', userId);\n      \n      if (!calendarUrl || !calendarName) {\n        console.log('[CALENDAR] Missing required fields');\n        return res.status(400).json({ error: 'Calendar URL and name are required' });\n      }\n      \n      if (!userId) {\n        console.log('[CALENDAR] User ID not found in JWT');\n        return res.status(401).json({ error: 'Authentication required' });\n      }\n\n      // Validate the calendar URL format\n      if (!calendarUrl.includes('calendar.google.com') && !calendarUrl.includes('.ics')) {\n        console.log('[CALENDAR] Invalid URL format');\n        return res.status(400).json({ error: 'Please provide a valid Google Calendar ICS URL' });\n      }\n      \n      const calendar = await storage.createUserCalendar({\n        userId: userId,\n        calendarUrl,\n        calendarName,\n        isActive: true\n      });\n      \n      console.log('[CALENDAR] Calendar created successfully:', calendar);\n      res.json(calendar);\n    } catch (error) {\n      console.error('Error creating calendar:', error);\n      res.status(500).json({ error: 'Failed to create calendar' });\n    }\n  });\n\n  // Delete calendar\n  app.delete('/api/calendars/:id', requireJWTAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteUserCalendar(id);\n      res.json({ message: 'Calendar deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting calendar:', error);\n      res.status(500).json({ error: 'Failed to delete calendar' });\n    }\n  });\n\n  // Update calendar (toggle active status or change name)\n  app.patch('/api/calendars/:id', requireJWTAuth, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      const calendar = await storage.updateUserCalendar(id, updates);\n      res.json(calendar);\n    } catch (error) {\n      console.error('Error updating calendar:', error);\n      res.status(500).json({ error: 'Failed to update calendar' });\n    }\n  });\n\n  // Serve ai-plugin.json for Custom GPT integration\n  app.get('/ai-plugin.json', (req, res) => {\n    res.setHeader('Content-Type', 'application/json');\n    const pluginManifest = {\n      \"schema_version\": \"v1\",\n      \"name_for_human\": \"FitScore Health Dashboard\",\n      \"name_for_model\": \"fitscore_health\",\n      \"description_for_human\": \"Access your WHOOP fitness data, meal tracking, and calendar integration through a comprehensive health dashboard.\",\n      \"description_for_model\": \"FitScore Health Dashboard provides access to WHOOP fitness metrics (recovery, sleep, strain, HRV), meal photo uploads, and Google Calendar integration. Use this to retrieve health data, track meals, and manage calendar events for health and productivity insights.\",\n      \"auth\": {\n        \"type\": \"user_http\",\n        \"authorization_type\": \"bearer\",\n        \"verification_tokens\": {}\n      },\n      \"api\": {\n        \"type\": \"openapi\",\n        \"url\": `${req.protocol}://${req.get('host')}/openapi.yaml`\n      },\n      \"logo_url\": `${req.protocol}://${req.get('host')}/generated-icon.png`,\n      \"contact_email\": \"support@fitscore.local\",\n      \"legal_info_url\": `${req.protocol}://${req.get('host')}`\n    };\n    res.json(pluginManifest);\n  });\n\n  // Serve OpenAPI specification for Custom GPT integration\n  app.get('/openapi.yaml', (req, res) => {\n    res.setHeader('Content-Type', 'text/yaml');\n    res.sendFile(path.join(process.cwd(), 'openapi.yaml'));\n  });\n\n  // Static file serving\n  app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":76341},"server/storage.ts":{"content":"import { users, meals, whoopData, userCalendars, type User, type InsertUser, type Meal, type InsertMeal, type WhoopData, type InsertWhoopData, type UserCalendar, type InsertUserCalendar } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Meal operations\n  createMeal(meal: InsertMeal): Promise<Meal>;\n  getMealsByDate(date: string): Promise<Meal[]>;\n  getAllMeals(): Promise<Meal[]>;\n  \n  // WHOOP data operations\n  getWhoopDataByDate(date: string): Promise<WhoopData | undefined>;\n  getWhoopDataByUserAndDate(userId: string, date: string): Promise<WhoopData | undefined>;\n  createOrUpdateWhoopData(data: InsertWhoopData): Promise<WhoopData>;\n  upsertWhoopData(data: InsertWhoopData): Promise<WhoopData>;\n  deleteWhoopDataByUserAndDate(userId: string, date: string): Promise<void>;\n  \n  // Calendar operations\n  getUserCalendars(userId: string): Promise<UserCalendar[]>;\n  createUserCalendar(data: InsertUserCalendar): Promise<UserCalendar>;\n  deleteUserCalendar(id: number): Promise<void>;\n  updateUserCalendar(id: number, data: Partial<InsertUserCalendar>): Promise<UserCalendar>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(insertUser)\n      .returning();\n    return user;\n  }\n\n  async createMeal(insertMeal: InsertMeal): Promise<Meal> {\n    const [meal] = await db\n      .insert(meals)\n      .values(insertMeal)\n      .returning();\n    return meal;\n  }\n\n  async getMealsByDate(date: string): Promise<Meal[]> {\n    return await db.select().from(meals).where(eq(meals.date, date));\n  }\n\n  async getAllMeals(): Promise<Meal[]> {\n    return await db.select().from(meals);\n  }\n\n  async getWhoopDataByDate(date: string): Promise<WhoopData | undefined> {\n    const [data] = await db.select().from(whoopData).where(eq(whoopData.date, date));\n    return data || undefined;\n  }\n\n  async getWhoopDataByUserAndDate(userId: string, date: string): Promise<WhoopData | undefined> {\n    const [data] = await db.select().from(whoopData)\n      .where(and(eq(whoopData.userId, userId), eq(whoopData.date, date)));\n    return data || undefined;\n  }\n\n  async createOrUpdateWhoopData(insertData: InsertWhoopData): Promise<WhoopData> {\n    const existing = await this.getWhoopDataByUserAndDate(insertData.userId, insertData.date);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(whoopData)\n        .set({\n          ...insertData,\n          lastSync: new Date()\n        })\n        .where(and(eq(whoopData.userId, insertData.userId), eq(whoopData.date, insertData.date)))\n        .returning();\n      return updated;\n    } else {\n      const [data] = await db\n        .insert(whoopData)\n        .values(insertData)\n        .returning();\n      return data;\n    }\n  }\n\n  async upsertWhoopData(insertData: InsertWhoopData): Promise<WhoopData> {\n    return this.createOrUpdateWhoopData(insertData);\n  }\n\n  async deleteWhoopDataByUserAndDate(userId: string, date: string): Promise<void> {\n    await db.delete(whoopData).where(and(eq(whoopData.userId, userId), eq(whoopData.date, date)));\n  }\n\n  // Calendar operations\n  async getUserCalendars(userId: string): Promise<UserCalendar[]> {\n    return await db.select().from(userCalendars).where(eq(userCalendars.userId, userId));\n  }\n\n  async createUserCalendar(data: InsertUserCalendar): Promise<UserCalendar> {\n    const [calendar] = await db\n      .insert(userCalendars)\n      .values(data)\n      .returning();\n    return calendar;\n  }\n\n  async deleteUserCalendar(id: number): Promise<void> {\n    await db.delete(userCalendars).where(eq(userCalendars.id, id));\n  }\n\n  async updateUserCalendar(id: number, data: Partial<InsertUserCalendar>): Promise<UserCalendar> {\n    const [calendar] = await db\n      .update(userCalendars)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(userCalendars.id, id))\n      .returning();\n    return calendar;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":4326},"server/userService.ts":{"content":"import { db } from './db';\nimport { users, whoopTokens, type InsertUser, type User, type InsertWhoopToken } from '@shared/schema';\nimport { eq } from 'drizzle-orm';\n\nexport class UserService {\n  // Create WHOOP OAuth user (no password needed)\n  async createWhoopUser(id: string, email: string, whoopUserId: string): Promise<User> {\n    try {\n      const insertData: InsertUser = { \n        id,\n        email,\n        whoopUserId \n      };\n      const [user] = await db.insert(users).values(insertData).returning();\n      console.log(`Created new WHOOP user: ${email} with ID: ${user.id}`);\n      return user;\n    } catch (error) {\n      console.error('Failed to create WHOOP user:', error);\n      throw new Error(`Failed to create WHOOP user: ${error}`);\n    }\n  }\n\n  // WHOOP OAuth doesn't use passwords - users authenticate via WHOOP only\n  async validatePassword(email: string, password: string): Promise<User | null> {\n    console.log(`[AUTH] Password validation not supported for WHOOP OAuth - redirecting to WHOOP login`);\n    return null;\n  }\n\n  // Legacy method for backward compatibility - creates WHOOP user\n  async createUser(email: string, password: string = 'admin'): Promise<User> {\n    // Extract WHOOP user ID from email format: whoop_12345@fitscore.local\n    const whoopIdMatch = email.match(/whoop_(\\d+)@/);\n    if (!whoopIdMatch) {\n      throw new Error('Invalid WHOOP user email format');\n    }\n    \n    const whoopUserId = whoopIdMatch[1];\n    const id = `whoop_${whoopUserId}`;\n    \n    return this.createWhoopUser(id, email, whoopUserId);\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.email, email));\n      return user;\n    } catch (error) {\n      console.error('Failed to get user by email:', error);\n      return undefined;\n    }\n  }\n\n  async getUserById(userId: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.id, userId));\n      return user;\n    } catch (error) {\n      console.error('Failed to get user by ID:', error);\n      return undefined;\n    }\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    try {\n      return await db.select().from(users);\n    } catch (error) {\n      console.error('Failed to get all users:', error);\n      return [];\n    }\n  }\n\n  async addWhoopToken(userId: string, accessToken: string, refreshToken?: string, expiresAt?: Date): Promise<void> {\n    try {\n      // Delete existing token for this user\n      await db.delete(whoopTokens).where(eq(whoopTokens.userId, userId));\n      \n      // Insert new token\n      const insertData: InsertWhoopToken = {\n        userId,\n        accessToken,\n        refreshToken: refreshToken || null,\n        expiresAt: expiresAt || null,\n      };\n      \n      await db.insert(whoopTokens).values(insertData);\n      console.log(`WHOOP token added for user: ${userId}`);\n    } catch (error) {\n      console.error('Failed to add WHOOP token:', error);\n      throw new Error(`Failed to add WHOOP token: ${error}`);\n    }\n  }\n\n  async getWhoopToken(userId: string) {\n    try {\n      const [token] = await db.select().from(whoopTokens).where(eq(whoopTokens.userId, userId));\n      return token;\n    } catch (error) {\n      console.error('Failed to get WHOOP token:', error);\n      return undefined;\n    }\n  }\n\n  async deleteUser(userId: string): Promise<void> {\n    try {\n      await db.delete(users).where(eq(users.id, userId));\n      console.log(`Deleted user: ${userId}`);\n    } catch (error) {\n      console.error('Failed to delete user:', error);\n      throw new Error(`Failed to delete user: ${error}`);\n    }\n  }\n\n  async updateUserDisplayName(userId: string, displayName: string): Promise<void> {\n    try {\n      await db.update(users)\n        .set({ displayName })\n        .where(eq(users.id, userId));\n      console.log(`Updated display name for user: ${userId}`);\n    } catch (error) {\n      console.error('Failed to update user display name:', error);\n      throw new Error(`Failed to update user display name: ${error}`);\n    }\n  }\n}\n\nexport const userService = new UserService();","size_bytes":4143},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"server/whoopApiService.ts":{"content":"import axios, { AxiosError } from 'axios';\nimport { whoopTokenStorage } from './whoopTokenStorage';\n\nconst BASE = 'https://api.prod.whoop.com/developer/v1';\nconst WHOOP_OAUTH_BASE = 'https://api.prod.whoop.com/oauth';\n\n// Error types for better error handling\nexport enum WhoopErrorType {\n  AUTHENTICATION_ERROR = 'AUTHENTICATION_ERROR',\n  RATE_LIMIT_ERROR = 'RATE_LIMIT_ERROR',\n  NETWORK_ERROR = 'NETWORK_ERROR',\n  DATA_NOT_FOUND = 'DATA_NOT_FOUND',\n  INVALID_TOKEN = 'INVALID_TOKEN',\n  API_ERROR = 'API_ERROR',\n  UNKNOWN_ERROR = 'UNKNOWN_ERROR'\n}\n\nexport interface WhoopError {\n  type: WhoopErrorType;\n  message: string;\n  statusCode?: number;\n  retryable: boolean;\n  details?: any;\n}\n\nclass WhoopApiError extends Error {\n  public readonly type: WhoopErrorType;\n  public readonly statusCode?: number;\n  public readonly retryable: boolean;\n  public readonly details?: any;\n\n  constructor(error: WhoopError) {\n    super(error.message);\n    this.name = 'WhoopApiError';\n    this.type = error.type;\n    this.statusCode = error.statusCode;\n    this.retryable = error.retryable;\n    this.details = error.details;\n  }\n}\n\nexport interface WhoopRecoveryData {\n  recovery_score: number;\n  resting_heart_rate: number;\n  hrv_rmssd_milli: number;\n  spo2_percentage: number;\n  skin_temp_celsius: number;\n}\n\nexport interface WhoopSleepData {\n  sleep_score: number;\n  stage_summary: {\n    total_in_bed_time_milli: number;\n    total_awake_time_milli: number;\n    total_no_data_time_milli: number;\n    total_light_sleep_time_milli: number;\n    total_slow_wave_sleep_time_milli: number;\n    total_rem_sleep_time_milli: number;\n  };\n}\n\nexport interface WhoopStrainData {\n  strain: number;\n  kilojoule: number;\n  average_heart_rate: number;\n  max_heart_rate: number;\n}\n\nexport interface WhoopTodayData {\n  cycle_id?: string;\n  strain?: number;\n  recovery_score?: number;\n  sleep_score?: number;\n  sleep_hours?: number;\n  sleepHours?: number; // temporary camelCase alias for frontend compatibility\n  sleep_stages?: {\n    light_sleep_minutes?: number;\n    deep_sleep_minutes?: number;\n    rem_sleep_minutes?: number;\n    awake_minutes?: number;\n  } | null;\n  time_in_bed_hours?: number | null;\n  sleep_efficiency_pct?: number | null;\n  hrv?: number;\n  resting_heart_rate?: number;\n  average_heart_rate?: number;\n  stress_score?: number;\n  skin_temperature?: number;\n  spo2_percentage?: number;\n  respiratory_rate?: number;\n  calories_burned?: number;\n  activity_log?: any[];\n  raw_data?: any;\n  raw?: {\n    cycle?: any;\n    recovery?: any;\n    sleep?: any;\n    workout?: any;\n    body_measurements?: any;\n  };\n  error?: {\n    type: string;\n    message: string;\n    retryable: boolean;\n  };\n}\n\nexport class WhoopApiService {\n  private async authHeader(userId: string) {\n    if (!userId) {\n      throw new Error('User ID is required for authentication');\n    }\n    const tokenData = await this.getValidWhoopToken(userId);\n    return { Authorization: `Bearer ${tokenData.access_token}` };\n  }\n\n  private async refreshToken(refreshToken: string, userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required for token refresh');\n    }\n    const clientId = process.env.WHOOP_CLIENT_ID;\n    const clientSecret = process.env.WHOOP_CLIENT_SECRET;\n    \n    if (!clientId || !clientSecret) {\n      throw new Error('Missing WHOOP client credentials');\n    }\n\n    console.log('[TOKEN REFRESH] Starting WHOOP token refresh...');\n\n    try {\n      const params = new URLSearchParams({\n        grant_type: 'refresh_token',\n        refresh_token: refreshToken,\n        client_id: clientId,\n        client_secret: clientSecret,\n        scope: 'offline'\n      });\n\n      const response = await axios.post('https://api.prod.whoop.com/oauth/oauth2/token', params, {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          'Accept': 'application/json'\n        }\n      });\n\n      const { access_token, refresh_token, expires_in } = response.data;\n      const expiresAt = expires_in ? Date.now() + (expires_in * 1000) : undefined;\n\n      console.log('[TOKEN REFRESH] Token refreshed successfully, expires in:', expires_in, 'seconds');\n\n      return {\n        access_token,\n        refresh_token: refresh_token || refreshToken,\n        expires_at: expiresAt ? Math.floor(expiresAt / 1000) : undefined,\n        user_id: userId\n      };\n    } catch (error: any) {\n      console.error('[TOKEN REFRESH] Token refresh failed:', error.response?.data || error.message);\n      throw new Error(`Token refresh failed: ${error.response?.data?.error || error.message}`);\n    }\n  }\n\n  // New function to ensure we always have a valid token\n  async getValidWhoopToken(userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required to get WHOOP token');\n    }\n    \n    let tokenData = await whoopTokenStorage.getToken(userId);\n    \n    if (!tokenData?.access_token) {\n      console.log('[TOKEN VALIDATION] No WHOOP access token found for user:', userId);\n      throw new WhoopApiError({\n        type: WhoopErrorType.AUTHENTICATION_ERROR,\n        message: 'Missing WHOOP access token',\n        retryable: false\n      });\n    }\n\n    // Check if token is expired and needs refresh\n    const currentTime = Math.floor(Date.now() / 1000);\n    if (tokenData.expires_at && tokenData.expires_at < currentTime) {\n      console.log('[TOKEN VALIDATION] Token expired for user:', userId, 'expired at:', new Date(tokenData.expires_at * 1000));\n      \n      if (!tokenData.refresh_token) {\n        console.log('[TOKEN VALIDATION] No refresh token available for user:', userId);\n        throw new WhoopApiError({\n          type: WhoopErrorType.AUTHENTICATION_ERROR,\n          message: 'WHOOP access token expired and no refresh token available',\n          retryable: false\n        });\n      }\n\n      try {\n        console.log('[TOKEN VALIDATION] Refreshing expired token for user:', userId);\n        const refreshedTokenData = await this.refreshToken(tokenData.refresh_token, userId);\n        \n        // Store the refreshed token\n        await whoopTokenStorage.setToken(userId, refreshedTokenData);\n        console.log('[TOKEN VALIDATION] Token refreshed and stored for user:', userId);\n        \n        return refreshedTokenData;\n      } catch (refreshError: any) {\n        console.error('[TOKEN VALIDATION] Token refresh failed for user:', userId, refreshError.message);\n        throw new WhoopApiError({\n          type: WhoopErrorType.AUTHENTICATION_ERROR,\n          message: 'Failed to refresh expired WHOOP token',\n          retryable: false\n        });\n      }\n    }\n\n    console.log('[TOKEN VALIDATION] Using valid existing token for user:', userId);\n    return tokenData;\n  }\n\n  async exchangeCodeForToken(code: string): Promise<any> {\n    const clientId = process.env.WHOOP_CLIENT_ID;\n    const clientSecret = process.env.WHOOP_CLIENT_SECRET;\n    \n    // Use production redirect URI since we have registered WHOOP credentials  \n    const isProduction = true; // Use registered redirect URI\n    const redirectUri = isProduction \n      ? 'https://health-data-hub.replit.app/api/whoop/callback'\n      : 'http://localhost:5000/api/whoop/callback';\n\n    if (!clientId || !clientSecret) {\n      throw new Error('Missing WHOOP client credentials');\n    }\n\n    console.log('Starting WHOOP token exchange...');\n\n    const requestData = {\n      client_id: clientId,\n      client_secret: clientSecret,\n      grant_type: 'authorization_code',\n      code: code,\n      redirect_uri: redirectUri\n    };\n\n    try {\n      const formBody = Object.entries(requestData)\n        .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)\n        .join('&');\n\n      const response = await fetch(`${WHOOP_OAUTH_BASE}/oauth2/token`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          'Accept': 'application/json',\n          'User-Agent': 'FitScore-GPT-API/1.0'\n        },\n        body: formBody\n      });\n\n      const responseText = await response.text();\n      console.log('[WHOOP OAUTH] Response status:', response.status);\n      console.log('[WHOOP OAUTH] Raw response body:', responseText);\n      console.log('[WHOOP OAUTH] Request data sent:', JSON.stringify(requestData, null, 2));\n\n      if (!response.ok) {\n        // Parse error response for detailed debugging\n        let errorDetails = responseText;\n        try {\n          const errorData = JSON.parse(responseText);\n          errorDetails = JSON.stringify(errorData, null, 2);\n          console.error('[WHOOP OAUTH] Detailed error response:', errorData);\n        } catch (parseError) {\n          console.error('[WHOOP OAUTH] Could not parse error response as JSON');\n        }\n        \n        throw new Error(`HTTP ${response.status}: ${errorDetails}`);\n      }\n\n      const data = JSON.parse(responseText);\n      console.log('WHOOP token exchange successful');\n      return data;\n    } catch (error: any) {\n      console.error('WHOOP token exchange failed:', error.message);\n      throw new Error(`Failed to exchange code for access token: ${error.message}`);\n    }\n  }\n\n  async getUserProfile(accessToken: string): Promise<any> {\n    try {\n      console.log('[WHOOP API] Fetching user profile...');\n      \n      const response = await fetch(`${BASE}/user/profile/basic`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${accessToken}`,\n          'Accept': 'application/json',\n          'User-Agent': 'FitScore-GPT-API/1.0'\n        }\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`HTTP ${response.status}: ${errorText}`);\n      }\n\n      const profileData = await response.json();\n      console.log('[WHOOP API] User profile retrieved successfully:', profileData);\n      return profileData;\n    } catch (error: any) {\n      console.error('[WHOOP API] Failed to fetch user profile:', error.message);\n      throw new Error(`Failed to fetch user profile: ${error.message}`);\n    }\n  }\n\n  async getLatestCycle(userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required to get latest cycle');\n    }\n    try {\n      const headers = await this.authHeader(userId);\n      console.log('Fetching latest cycle from WHOOP API...');\n      \n      const response = await axios.get(`${BASE}/cycle?limit=1`, { headers });\n      \n      if (response.status === 200 && response.data.records && response.data.records.length > 0) {\n        console.log('Latest cycle found:', response.data.records[0].id);\n        return response.data.records[0];\n      } else {\n        console.log('No cycles found in response');\n        return null;\n      }\n    } catch (error: any) {\n      console.error('Failed to fetch latest cycle:', error.response?.status, error.response?.data);\n      if (error.response?.status === 404) {\n        console.log('Cycle endpoint returned 404 - no cycles available');\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  async getRecovery(cycleId: string, userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required to get recovery data');\n    }\n    try {\n      const headers = await this.authHeader(userId);\n      console.log(`Fetching recovery for cycle ${cycleId}...`);\n      \n      const response = await axios.get(`${BASE}/cycle/${cycleId}/recovery`, { headers });\n      \n      if (response.status === 200) {\n        console.log('Recovery data found for cycle:', cycleId);\n        return response.data;\n      }\n      return null;\n    } catch (error: any) {\n      console.error(`Failed to fetch recovery for cycle ${cycleId}:`, error.response?.status, error.response?.data);\n      if (error.response?.status === 404) {\n        console.log(`No recovery data available for cycle ${cycleId}`);\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  async getSleep(cycleId: string, userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required to get sleep data');\n    }\n    try {\n      const headers = await this.authHeader(userId);\n      console.log(`Fetching sleep for cycle ${cycleId}...`);\n      \n      const response = await axios.get(`${BASE}/activity/sleep/${cycleId}`, { headers });\n      \n      if (response.status === 200) {\n        console.log('Sleep data found for cycle:', cycleId);\n        console.log('Sleep data structure:', JSON.stringify(response.data, null, 2));\n        return response.data;\n      }\n      return null;\n    } catch (error: any) {\n      console.error(`Failed to fetch sleep for cycle ${cycleId}:`, error.response?.status, error.response?.data);\n      if (error.response?.status === 404) {\n        console.log(`No sleep data available for cycle ${cycleId}, trying previous cycle...`);\n        \n        // Try to get previous cycle's sleep data\n        try {\n          const headers = await this.authHeader(userId);\n          const cycleResponse = await axios.get(`${BASE}/cycle?limit=10`, { headers });\n          \n          if (cycleResponse.data.records && cycleResponse.data.records.length > 0) {\n            // Find the current cycle index and get the previous one\n            const cycles = cycleResponse.data.records;\n            const currentCycleIndex = cycles.findIndex((cycle: any) => cycle.id === cycleId);\n            \n            if (currentCycleIndex !== -1 && currentCycleIndex < cycles.length - 1) {\n              const previousCycleId = cycles[currentCycleIndex + 1].id;\n              console.log(`Trying to fetch sleep data from previous cycle: ${previousCycleId}`);\n              \n              const previousSleepResponse = await axios.get(`${BASE}/activity/sleep/${previousCycleId}`, { headers });\n              \n              if (previousSleepResponse.status === 200) {\n                console.log('Sleep data found in previous cycle:', previousCycleId);\n                console.log('Previous cycle sleep data structure:', JSON.stringify(previousSleepResponse.data, null, 2));\n                return previousSleepResponse.data;\n              }\n            }\n          }\n        } catch (previousError: any) {\n          console.log(`Could not fetch sleep data from previous cycle:`, previousError.response?.status);\n        }\n        \n        return null;\n      }\n      throw error;\n    }\n  }\n\n  async getLatestSleepData(userId: string): Promise<{ sleep_score: number | null; cycleDate: string | null }> {\n    if (!userId) {\n      throw new Error('User ID is required to get latest sleep data');\n    }\n    try {\n      const headers = await this.authHeader(userId);\n      const response = await axios.get(`${BASE}/cycle?limit=3`, { headers });\n      \n      if (!response.data.records || response.data.records.length === 0) {\n        return { sleep_score: null, cycleDate: null };\n      }\n\n      const cycles = response.data.records;\n\n      // Check today's cycle first\n      const todayCycle = cycles[0];\n      if (todayCycle?.id) {\n        const todaySleep = await this.getSleep(todayCycle.id, userId);\n        if (todaySleep?.score?.sleep_score) {\n          return { \n            sleep_score: todaySleep.score.sleep_score, \n            cycleDate: todayCycle.start \n          };\n        }\n      }\n\n      // If today's sleep is null, check yesterday's cycle\n      if (cycles.length > 1) {\n        const yesterdayCycle = cycles[1];\n        if (yesterdayCycle?.id) {\n          const yesterdaySleep = await this.getSleep(yesterdayCycle.id, userId);\n          if (yesterdaySleep?.score?.sleep_score) {\n            return { \n              sleep_score: yesterdaySleep.score.sleep_score, \n              cycleDate: yesterdayCycle.start \n            };\n          }\n        }\n      }\n\n      return { sleep_score: null, cycleDate: null };\n    } catch (error) {\n      console.error('Error fetching latest sleep data:', error);\n      return { sleep_score: null, cycleDate: null };\n    }\n  }\n\n  async getLatestSleepSession(userId: string): Promise<number | null> {\n    if (!userId) {\n      throw new Error('User ID is required to get latest sleep session');\n    }\n    try {\n      console.log('Fetching latest sleep session data...');\n      \n      // Get today and yesterday dates for sleep data range\n      const today = new Date();\n      const yesterday = new Date(today);\n      yesterday.setDate(yesterday.getDate() - 1);\n      \n      const todayStr = today.toISOString().split('T')[0];\n      const yesterdayStr = yesterday.toISOString().split('T')[0];\n      \n      // Try direct sleep endpoint with date range first\n      try {\n        const headers = await this.authHeader(userId);\n        const response = await axios.get(`${BASE}/activity/sleep?start=${yesterdayStr}&end=${todayStr}`, { \n          headers,\n          timeout: 10000\n        });\n        \n        if (response.data && response.data.records && response.data.records.length > 0) {\n          // Derive \"time asleep\" from stages when available; otherwise, try time-in-bed; skip naps.\n          const toHours = (ms: number) => Math.round((ms / 3600000) * 10) / 10;\n\n          const sessions = response.data.records\n            .filter((s: any) => s.nap === false)\n            .map((s: any) => {\n              const ss = s?.score?.stage_summary;\n              // Prefer true time asleep from stages\n              const asleepMs = (ss?.total_light_sleep_time_milli ?? 0)\n                             + (ss?.total_slow_wave_sleep_time_milli ?? 0)\n                             + (ss?.total_rem_sleep_time_milli ?? 0);\n              let asleepHours: number | null = null;\n              if (ss && (ss.total_light_sleep_time_milli != null\n                      || ss.total_slow_wave_sleep_time_milli != null\n                      || ss.total_rem_sleep_time_milli != null)) {\n                asleepHours = toHours(asleepMs);\n              } else if (s.start && s.end) {\n                // fallback to time in bed if stages are missing\n                const tibMs = new Date(s.end).getTime() - new Date(s.start).getTime();\n                asleepHours = toHours(tibMs);\n              }\n              return { start: s.start, asleepHours };\n            })\n            .filter((x: any) => x.asleepHours != null)\n            .sort((a: any, b: any) => new Date(b.start).getTime() - new Date(a.start).getTime());\n\n          if (sessions.length > 0) {\n            console.log(`Derived latest sleep hours from list: ${sessions[0].asleepHours} h`);\n            return sessions[0].asleepHours;\n          }\n        }\n        \n        console.log('No valid sleep sessions in date range, trying broader search...');\n      } catch (directError) {\n        console.log('Direct sleep endpoint failed, trying cycle-based approach...');\n      }\n      \n      // Fallback to cycle-based approach with broader range\n      try {\n        const headers = await this.authHeader(userId);\n        const cycleResponse = await axios.get(`${BASE}/cycle?limit=7`, { // Increased to 7 days\n          headers,\n          timeout: 10000\n        });\n        \n        if (!cycleResponse.data.records || cycleResponse.data.records.length === 0) {\n          console.log('No cycle data available');\n          return null;\n        }\n        \n        // Start from most recent cycle and work backwards\n        for (let i = 0; i < Math.min(cycleResponse.data.records.length, 5); i++) {\n          const cycle = cycleResponse.data.records[i];\n          \n          try {\n            // Add small delay between requests to avoid rate limiting\n            if (i > 0) {\n              await new Promise(resolve => setTimeout(resolve, 500));\n            }\n            \n            const sleepData = await this.getSleep(cycle.id, userId);\n            \n            // Check for valid sleep data\n            if (sleepData && sleepData.nap === false && sleepData.sleep_hours != null && sleepData.sleep_hours > 0) {\n              console.log(`Found valid sleep data for cycle ${cycle.id}: ${sleepData.sleep_hours} hours`);\n              return Math.round(sleepData.sleep_hours * 10) / 10;\n            } else {\n              console.log(`Skipping cycle ${cycle.id}: nap=${sleepData?.nap}, sleep_hours=${sleepData?.sleep_hours}`);\n            }\n          } catch (cycleError) {\n            console.log(`No sleep data for cycle ${cycle.id}, continuing to next cycle`);\n            continue;\n          }\n        }\n        \n        console.log('No valid sleep data found in recent cycles');\n        return null;\n        \n      } catch (cycleError) {\n        console.error('Cycle-based sleep data retrieval failed:', cycleError);\n        return null;\n      }\n    } catch (error) {\n      console.error('Error in getLatestSleepSession:', error);\n      return null;\n    }\n  }\n\n  async getWorkoutData(userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required to get workout data');\n    }\n    try {\n      console.log('Fetching recent workout data...');\n      \n      // Get today and yesterday dates for workout data range\n      const today = new Date();\n      const yesterday = new Date(today);\n      yesterday.setDate(yesterday.getDate() - 1);\n      \n      const todayStr = today.toISOString().split('T')[0];\n      const yesterdayStr = yesterday.toISOString().split('T')[0];\n      \n      const headers = await this.authHeader(userId);\n      const response = await axios.get(`${BASE}/activity/workout?start=${yesterdayStr}&end=${todayStr}`, { \n        headers,\n        timeout: 10000\n      });\n      \n      if (response.data && response.data.records && response.data.records.length > 0) {\n        // Return the most recent workout\n        const workouts = response.data.records\n          .sort((a: any, b: any) => new Date(b.start).getTime() - new Date(a.start).getTime());\n        \n        console.log(`Found ${workouts.length} workouts from today`);\n        return workouts[0] || null;\n      }\n      \n      console.log('No recent workouts found');\n      return null;\n    } catch (error) {\n      console.error('Error fetching workout data:', error);\n      return null;\n    }\n  }\n\n  async getBodyMeasurements(userId: string): Promise<any> {\n    if (!userId) {\n      throw new Error('User ID is required to get body measurements');\n    }\n    try {\n      console.log('Fetching body measurements...');\n      \n      const headers = await this.authHeader(userId);\n      const response = await axios.get(`${BASE}/user/measurement`, { \n        headers,\n        timeout: 10000\n      });\n      \n      if (response.data) {\n        console.log('Body measurements retrieved successfully');\n        return response.data;\n      }\n      \n      console.log('No body measurements found');\n      return null;\n    } catch (error) {\n      console.error('Error fetching body measurements:', error);\n      return null;\n    }\n  }\n\n  async getWeeklyAverages(userId: string): Promise<{\n    avgRecovery: number | null;\n    avgStrain: number | null;\n    avgSleep: number | null;\n    avgHRV: number | null;\n  }> {\n    if (!userId) {\n      throw new Error('User ID is required to get weekly averages');\n    }\n    try {\n      const headers = await this.authHeader(userId);\n      \n      // Get cycles from the past 7 days\n      const endDate = new Date();\n      const startDate = new Date();\n      startDate.setDate(startDate.getDate() - 7);\n      \n      const response = await axios.get(\n        `${BASE}/cycle?start=${startDate.toISOString()}&end=${endDate.toISOString()}`, \n        { headers }\n      );\n      \n      if (!response.data.records || response.data.records.length === 0) {\n        console.log('No cycles found for weekly averages');\n        return { avgRecovery: null, avgStrain: null, avgSleep: null, avgHRV: null };\n      }\n      \n      const cycles = response.data.records;\n      console.log(`Processing ${cycles.length} cycles for weekly averages`);\n      \n      const recoveryScores: number[] = [];\n      const strainScores: number[] = [];\n      const sleepScores: number[] = [];\n      const hrvScores: number[] = [];\n      \n      // Process each cycle with rate limiting protection\n      for (let i = 0; i < Math.min(cycles.length, 5); i++) {\n        const cycle = cycles[i];\n        try {\n          // Add delay between API calls to respect rate limits\n          if (i > 0) {\n            await new Promise(resolve => setTimeout(resolve, 100));\n          }\n          \n          // Get recovery data\n          const recovery = await this.getRecovery(cycle.id, userId);\n          if (recovery?.score?.recovery_score) {\n            recoveryScores.push(recovery.score.recovery_score);\n          }\n          if (recovery?.score?.hrv_rmssd_milli) {\n            hrvScores.push(recovery.score.hrv_rmssd_milli);\n          }\n          \n          // Get strain data from cycle\n          if (cycle.score?.strain) {\n            strainScores.push(cycle.score.strain);\n          }\n          \n          // Get sleep data using sleep_id from recovery data if available\n          if (recovery?.sleep_id) {\n            try {\n              // Add delay before sleep API call\n              await new Promise(resolve => setTimeout(resolve, 100));\n              \n              const headers = await this.authHeader(userId);\n              const response = await axios.get(`${BASE}/activity/sleep/${recovery.sleep_id}`, { headers });\n              if (response.status === 200) {\n                const sleepData = response.data;\n                \n                // Get sleep score percentage \n                if (sleepData.score?.sleep_performance_percentage !== null && sleepData.score?.sleep_performance_percentage !== undefined) {\n                  sleepScores.push(sleepData.score.sleep_performance_percentage);\n                }\n              }\n            } catch (error) {\n              // Sleep data may not be available for all cycles or rate limited\n            }\n          }\n          \n        } catch (error) {\n          if (error.response?.status === 429) {\n            console.log(`Rate limit hit for cycle ${cycle.id}, skipping remaining cycles`);\n            break;\n          }\n          console.error(`Error processing cycle ${cycle.id}:`, error.message);\n          // Continue with other cycles\n        }\n      }\n      \n      // Calculate averages\n      const avgRecovery = recoveryScores.length > 0 \n        ? Math.round((recoveryScores.reduce((a, b) => a + b, 0) / recoveryScores.length) * 10) / 10\n        : null;\n      \n      const avgStrain = strainScores.length > 0 \n        ? Math.round((strainScores.reduce((a, b) => a + b, 0) / strainScores.length) * 10) / 10\n        : null;\n      \n      const avgSleep = sleepScores.length > 0 \n        ? Math.round((sleepScores.reduce((a, b) => a + b, 0) / sleepScores.length) * 10) / 10\n        : null;\n      \n      const avgHRV = hrvScores.length > 0 \n        ? Math.round((hrvScores.reduce((a, b) => a + b, 0) / hrvScores.length) * 10) / 10\n        : null;\n      \n      console.log(`Weekly averages calculated: Recovery: ${avgRecovery}%, Strain: ${avgStrain}, Sleep: ${avgSleep}%, HRV: ${avgHRV}ms`);\n      \n      return { avgRecovery, avgStrain, avgSleep, avgHRV };\n      \n    } catch (error) {\n      console.error('Error calculating weekly averages:', error);\n      return { avgRecovery: null, avgStrain: null, avgSleep: null, avgHRV: null };\n    }\n  }\n\n  async getTodaysData(userId: string): Promise<WhoopTodayData> {\n    if (!userId) {\n      throw new Error('User ID is required to get today\\'s data');\n    }\n    try {\n      // Get the latest cycle with user-specific authentication\n      const latestCycle = await this.getLatestCycle(userId);\n      if (!latestCycle) {\n        console.log('No cycles found');\n        return {};\n      }\n\n      console.log(`Using cycle: ${latestCycle.id}`);\n\n      // Get recovery data with user-specific authentication\n      const recovery = await this.getRecovery(latestCycle.id, userId);\n      console.log('Recovery data found for cycle:', latestCycle.id);\n\n      // Get sleep data using sleep_id from recovery data if available\n      let sleepData = null;\n      let sleepHours = null;\n      let sleepScore = null;\n      let sleepEfficiencyPct: number | null = null;\n      let timeInBedHours: number | null = null;\n      let stageSummary: any = null;\n      \n      if (recovery?.sleep_id) {\n        console.log(`Found sleep_id in recovery data: ${recovery.sleep_id}`);\n        try {\n          const headers = await this.authHeader(userId);\n          const response = await axios.get(`${BASE}/activity/sleep/${recovery.sleep_id}`, { headers });\n          if (response.status === 200) {\n            sleepData = response.data;\n            console.log('Sleep data retrieved via sleep_id:', JSON.stringify(sleepData, null, 2));\n            \n            // After `sleepData = response.data;` and before building `result`, derive sleep hours properly.\n            // Prefer time asleep (sum of light + slow wave + REM) when scored; otherwise fall back to time in bed.\n\n            // Extract score and stage summary safely\n            const scoreState = sleepData?.score_state || sleepData?.score?.score_state; // tolerate different shapes\n            stageSummary = sleepData?.score?.stage_summary;\n\n            console.log(\"[SLEEP] stageSummary present:\", !!stageSummary,\n              \"| keys:\", stageSummary ? Object.keys(stageSummary) : \"none\");\n\n            // Extract sleep score (0‚Äì100) from performance percentage if present\n            if (sleepData?.score?.sleep_performance_percentage !== undefined && sleepData?.score?.sleep_performance_percentage !== null) {\n              sleepScore = Math.min(Math.max(sleepData.score.sleep_performance_percentage, 0), 100);\n              console.log(`[SLEEP] Sleep score (performance %): ${sleepScore}`);\n            }\n\n            // Extract efficiency if present\n            if (typeof sleepData?.score?.sleep_efficiency_percentage === \"number\") {\n              sleepEfficiencyPct = Math.round(sleepData.score.sleep_efficiency_percentage);\n            }\n\n            // Compute time in bed (hours)\n            if (typeof stageSummary?.total_in_bed_time_milli === \"number\") {\n              timeInBedHours = Math.round((stageSummary.total_in_bed_time_milli / 3600000) * 10) / 10;\n            } else if (sleepData?.start && sleepData?.end) {\n              const tibMs = new Date(sleepData.end).getTime() - new Date(sleepData.start).getTime();\n              timeInBedHours = Math.round((tibMs / 3600000) * 10) / 10;\n            }\n\n            // Compute time asleep (Sleep Hours) when we have scored stages\n            if (stageSummary &&\n                typeof stageSummary.total_light_sleep_time_milli === \"number\" &&\n                typeof stageSummary.total_slow_wave_sleep_time_milli === \"number\" &&\n                typeof stageSummary.total_rem_sleep_time_milli === \"number\") {\n              const asleepMs =\n                (stageSummary.total_light_sleep_time_milli || 0) +\n                (stageSummary.total_slow_wave_sleep_time_milli || 0) +\n                (stageSummary.total_rem_sleep_time_milli || 0);\n\n              sleepHours = Math.round((asleepMs / 3600000) * 10) / 10;\n              console.log(`[SLEEP] Time asleep (derived from stages): ${sleepHours} h`);\n            } else {\n              // No stage data yet ‚Üí fallback to time in bed\n              sleepHours = null; // keep null to avoid mislabeling as \"sleep hours\"\n              console.log(\"[SLEEP] Stage summary missing ‚Üí using Time in Bed fallback, scoring may be pending\");\n            }\n          }\n        } catch (sleepError: any) {\n          console.log(`Failed to get sleep data via sleep_id ${recovery.sleep_id}:`, sleepError.response?.status);\n        }\n      }\n\n      // Fallback to previous sleep retrieval method if sleep_id approach failed\n      if (!sleepHours) {\n        try {\n          sleepHours = await this.getLatestSleepSession(userId);\n          if (sleepHours !== null) {\n            console.log(`Sleep hours retrieved via fallback method: ${sleepHours}`);\n          } else {\n            console.log('No sleep data available - this is normal if sleep hasn\\'t been processed yet');\n          }\n        } catch (error) {\n          console.log('Sleep data retrieval failed:', error instanceof WhoopApiError ? error.message : error);\n        }\n      }\n\n      // Get additional insights: workout and body measurements\n      let workoutData = null;\n      let bodyMeasurements = null;\n      \n      try {\n        console.log('Fetching additional insights...');\n        \n        // Get recent workout data\n        workoutData = await this.getWorkoutData(userId);\n        \n        // Get body measurements  \n        bodyMeasurements = await this.getBodyMeasurements(userId);\n        \n      } catch (error) {\n        console.log('Error fetching additional insights:', error);\n      }\n\n      // Calculate sleep stages in minutes if available\n      // Note: stageSummary already extracted earlier in the sleep processing\n      const sleepStages = stageSummary ? {\n        light_sleep_minutes: Math.round((stageSummary.total_light_sleep_time_milli || 0) / 60000),\n        deep_sleep_minutes: Math.round((stageSummary.total_slow_wave_sleep_time_milli || 0) / 60000),\n        rem_sleep_minutes: Math.round((stageSummary.total_rem_sleep_time_milli || 0) / 60000),\n        awake_minutes: Math.round((stageSummary.total_awake_time_milli || 0) / 60000),\n      } : null;\n\n      const result: WhoopTodayData = {\n        cycle_id: latestCycle.id,\n        strain: latestCycle.score?.strain || null,\n        recovery_score: recovery?.score?.recovery_score || null,\n        // sleep fields\n        sleep_score: sleepScore ?? null,\n        sleep_stages: sleepStages ?? null,\n\n        // primary \"time asleep\" (null if stages not scored yet)\n        sleep_hours: sleepHours ?? null,\n\n        // NEW: temporary camelCase alias for frontend compatibility (remove later if not needed)\n        sleepHours: sleepHours ?? null as any,\n\n        // fallback & context\n        time_in_bed_hours: timeInBedHours ?? null,\n        sleep_efficiency_pct: sleepEfficiencyPct ?? null,\n        hrv: recovery?.score?.hrv_rmssd_milli || null,\n        resting_heart_rate: recovery?.score?.resting_heart_rate || null,\n        average_heart_rate: workoutData?.avgHeartRate || latestCycle.score?.average_heart_rate || null,\n        stress_score: undefined, // WHOOP doesn't provide stress score in current API\n        skin_temperature: recovery?.score?.skin_temp_celsius || undefined,\n        spo2_percentage: recovery?.score?.spo2_percentage || null,\n        respiratory_rate: recovery?.score?.respiratory_rate || null,\n        calories_burned: workoutData?.kilojoule ? Math.round(workoutData.kilojoule * 0.239) : undefined, // Convert kJ to calories\n        activity_log: workoutData?.activities || [],\n        raw_data: {\n          cycle: latestCycle,\n          recovery: recovery,\n          sleep: sleepData,\n          workout: workoutData,\n          body_measurements: bodyMeasurements\n        }\n      };\n\n\n\n      // Store in database for historical tracking\n      const today = new Date().toISOString().split('T')[0];\n      const dataToStore = {\n        date: today,\n        cycle_id: result.cycle_id,\n        strain: result.strain,\n        recovery_score: result.recovery_score,\n        hrv: result.hrv,\n        resting_heart_rate: result.resting_heart_rate,\n        sleep_hours: result.sleep_hours,\n        raw_data: result.raw\n      };\n\n      // Log the daily stats before storing\n      console.log(`Daily WHOOP stats logged: ${today}`);\n      \n      // Database storage handled in routes.ts\n      console.log('WHOOP data retrieved successfully');\n\n      return result;\n    } catch (error) {\n      console.error('Error fetching WHOOP data:', error);\n      return {};\n    }\n  }\n\n  getOAuthUrl(): string {\n    const clientId = process.env.WHOOP_CLIENT_ID;\n    if (!clientId) {\n      throw new Error('WHOOP_CLIENT_ID not configured');\n    }\n\n    // Use production redirect URI since we have registered WHOOP credentials\n    const isProduction = true; // Use registered redirect URI \n    const redirectUri = isProduction \n      ? 'https://health-data-hub.replit.app/api/whoop/callback'\n      : 'http://localhost:5000/api/whoop/callback';\n\n    const scope = 'read:cycles read:recovery read:sleep read:profile read:workout read:body_measurement offline';\n    const state = 'whoop_auth_' + Date.now();\n    \n    console.log('[OAUTH] Environment: Production=' + isProduction);\n    console.log('[OAUTH] Redirect URI:', redirectUri);\n    console.log('[OAUTH] Client ID:', clientId);\n    console.log('[OAUTH] Requesting scopes:', scope);\n    console.log('[OAUTH] Including offline scope for refresh token capability');\n    \n    const oauthUrl = `${WHOOP_OAUTH_BASE}/oauth2/auth?` +\n      `client_id=${clientId}&` +\n      `redirect_uri=${encodeURIComponent(redirectUri)}&` +\n      `scope=${encodeURIComponent(scope)}&` +\n      `state=${state}&` +\n      `response_type=code`;\n      \n    console.log('[OAUTH] Generated OAuth URL:', oauthUrl);\n    return oauthUrl;\n  }\n}\n\nexport const whoopApiService = new WhoopApiService();","size_bytes":37019},"server/whoopTokenStorage.ts":{"content":"import { db } from './db';\nimport { whoopTokens, users } from '@shared/schema';\nimport { eq } from 'drizzle-orm';\n\nexport interface WhoopTokenData {\n  access_token: string;\n  refresh_token?: string;\n  expires_at?: number;\n  user_id?: string;\n  static_jwt?: string;\n}\n\nexport class WhoopTokenStorage {\n  async getToken(userId: string): Promise<WhoopTokenData | null> {\n    try {\n      const [token] = await db.select().from(whoopTokens).where(eq(whoopTokens.userId, userId));\n      if (!token) {\n        return null;\n      }\n      \n      // Convert Date object back to unix timestamp for consistency\n      const expiresAtTimestamp = token.expiresAt instanceof Date \n        ? Math.floor(token.expiresAt.getTime() / 1000)\n        : token.expiresAt;\n\n      return {\n        access_token: token.accessToken,\n        refresh_token: token.refreshToken || undefined,\n        expires_at: expiresAtTimestamp || undefined,\n        user_id: userId,\n        static_jwt: token.staticJwt || undefined\n      };\n    } catch (error) {\n      console.error('Error fetching WHOOP token:', error);\n      return null;\n    }\n  }\n\n  async setToken(userId: string, tokenData: WhoopTokenData): Promise<void> {\n    try {\n      // First ensure the user exists\n      const existingUser = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n      if (existingUser.length === 0) {\n        throw new Error(`User ${userId} does not exist. Create user first.`);\n      }\n\n      // Fix expires_at Date handling to prevent .toISOString() errors\n      const expiresAt = tokenData.expires_at\n        ? tokenData.expires_at instanceof Date\n          ? tokenData.expires_at\n          : new Date(tokenData.expires_at * 1000)\n        : null;\n\n      // Upsert the token\n      await db.insert(whoopTokens).values({\n        userId: userId,\n        accessToken: tokenData.access_token,\n        refreshToken: tokenData.refresh_token || null,\n        expiresAt: expiresAt,\n        staticJwt: tokenData.static_jwt || null,\n      }).onConflictDoUpdate({\n        target: whoopTokens.userId,\n        set: {\n          accessToken: tokenData.access_token,\n          refreshToken: tokenData.refresh_token || null,\n          expiresAt: expiresAt,\n          staticJwt: tokenData.static_jwt || null,\n          updatedAt: new Date(),\n        },\n      });\n\n      console.log(`WHOOP token stored successfully for user: ${userId}`);\n    } catch (error) {\n      console.error('Error storing WHOOP token:', error);\n      throw error;\n    }\n  }\n\n  async deleteToken(userId: string): Promise<void> {\n    try {\n      await db.delete(whoopTokens).where(eq(whoopTokens.userId, userId));\n      console.log(`WHOOP token deleted for user: ${userId}`);\n    } catch (error) {\n      console.error('Error deleting WHOOP token:', error);\n      throw error;\n    }\n  }\n\n  isTokenValid(tokenData: WhoopTokenData): boolean {\n    if (!tokenData || !tokenData.access_token) {\n      return false;\n    }\n    \n    if (!tokenData.expires_at) {\n      return true; // No expiration set, assume valid\n    }\n    \n    const now = Math.floor(Date.now() / 1000);\n    const bufferTime = 5 * 60; // 5 minutes buffer\n    return now < (tokenData.expires_at - bufferTime);\n  }\n\n  async getAllTokens(): Promise<Array<{ userId: string; tokenData: WhoopTokenData }>> {\n    try {\n      const tokens = await db.select().from(whoopTokens);\n      return tokens.map(token => ({\n        userId: token.userId,\n        tokenData: {\n          access_token: token.accessToken,\n          refresh_token: token.refreshToken || undefined,\n          expires_at: token.expiresAt || undefined,\n          user_id: token.userId\n        }\n      }));\n    } catch (error) {\n      console.error('Error fetching all tokens:', error);\n      return [];\n    }\n  }\n\n  async refreshWhoopToken(userId: string, refreshToken: string): Promise<WhoopTokenData | null> {\n    const clientId = process.env.WHOOP_CLIENT_ID;\n    const clientSecret = process.env.WHOOP_CLIENT_SECRET;\n    \n    if (!clientId || !clientSecret) {\n      throw new Error('Missing WHOOP OAuth credentials');\n    }\n\n    try {\n      const response = await fetch('https://api.prod.whoop.com/oauth/oauth2/token', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          'Accept': 'application/json',\n        },\n        body: new URLSearchParams({\n          client_id: clientId,\n          client_secret: clientSecret,\n          grant_type: 'refresh_token',\n          refresh_token: refreshToken,\n        }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Token refresh failed: HTTP ${response.status} - ${errorText}`);\n      }\n\n      const tokenResponse = await response.json();\n      \n      const newTokenData: WhoopTokenData = {\n        access_token: tokenResponse.access_token,\n        refresh_token: tokenResponse.refresh_token || refreshToken,\n        expires_at: tokenResponse.expires_in ? Math.floor(Date.now() / 1000) + tokenResponse.expires_in : undefined,\n        user_id: userId\n      };\n\n      // Store the refreshed token\n      await this.setToken(userId, newTokenData);\n      \n      console.log(`WHOOP token refreshed successfully for user: ${userId}`);\n      return newTokenData;\n    } catch (error) {\n      console.error(`Failed to refresh WHOOP token for user ${userId}:`, error);\n      throw error;\n    }\n  }\n}\n\n// Export singleton instance\nexport const whoopTokenStorage = new WhoopTokenStorage();","size_bytes":5486},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, timestamp, uuid, boolean, real } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// WHOOP OAuth-based multi-user support with text user IDs\nexport const users = pgTable(\"users\", {\n  id: text(\"id\").primaryKey(), // WHOOP user ID like \"whoop_25283528\"\n  email: text(\"email\").notNull().unique(),\n  whoopUserId: text(\"whoop_user_id\").notNull(), // Original WHOOP numeric ID\n  displayName: text(\"display_name\"), // Optional display name for admin to set\n  role: text(\"role\").notNull().default(\"user\"), // \"user\" or \"admin\"\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const whoopTokens = pgTable(\"whoop_tokens\", {\n  userId: text(\"user_id\").primaryKey().references(() => users.id, { onDelete: 'cascade' }), // One token per user\n  accessToken: text(\"access_token\").notNull(),\n  refreshToken: text(\"refresh_token\"),\n  expiresAt: timestamp(\"expires_at\"),\n  staticJwt: text(\"staticJwt\"), // Long-lived Bearer token for Custom GPT\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const meals = pgTable(\"meals\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  filename: text(\"filename\").notNull(),\n  originalName: text(\"original_name\").notNull(),\n  mimetype: text(\"mimetype\").notNull(),\n  size: integer(\"size\").notNull(),\n  uploadedAt: timestamp(\"uploaded_at\").defaultNow().notNull(),\n  date: text(\"date\").notNull(), // YYYY-MM-DD format\n});\n\nexport const whoopData = pgTable(\"whoop_data\", {\n  userId: text(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  date: text(\"date\").notNull(), // YYYY-MM-DD format\n  recoveryScore: integer(\"recovery_score\").notNull(),\n  sleepScore: integer(\"sleep_score\").notNull(),\n  strainScore: real(\"strain_score\").notNull(), // Store as decimal for precision\n  restingHeartRate: integer(\"resting_heart_rate\").notNull(),\n  sleepHours: real(\"sleep_hours\"),\n  hrv: real(\"hrv\"), // HRV can be decimal like 93.759125\n  respiratoryRate: real(\"respiratory_rate\"), // Can be decimal like 17.285156\n  skinTempCelsius: real(\"skin_temp_celsius\"),\n  spo2Percentage: real(\"spo2_percentage\"), // Can be decimal like 96.375\n  averageHeartRate: integer(\"average_heart_rate\"),\n  lastSync: timestamp(\"last_sync\").defaultNow().notNull(),\n}, (table) => ({\n  pk: { name: \"whoop_data_pkey\", columns: [table.userId, table.date] }\n}));\n\nexport const userCalendars = pgTable(\"user_calendars\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  calendarUrl: text(\"calendar_url\").notNull(),\n  calendarName: text(\"calendar_name\").notNull(),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  id: true,\n  email: true,\n  whoopUserId: true,\n  role: true,\n});\n\nexport const insertMealSchema = createInsertSchema(meals).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertWhoopDataSchema = createInsertSchema(whoopData).omit({\n  lastSync: true,\n});\n\nexport const insertWhoopTokenSchema = createInsertSchema(whoopTokens).omit({\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserCalendarSchema = createInsertSchema(userCalendars).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Type definitions\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertMeal = z.infer<typeof insertMealSchema>;\nexport type Meal = typeof meals.$inferSelect;\nexport type InsertWhoopData = z.infer<typeof insertWhoopDataSchema>;\nexport type WhoopData = typeof whoopData.$inferSelect;\nexport type InsertWhoopToken = z.infer<typeof insertWhoopTokenSchema>;\nexport type WhoopToken = typeof whoopTokens.$inferSelect;\nexport type InsertUserCalendar = z.infer<typeof insertUserCalendarSchema>;\nexport type UserCalendar = typeof userCalendars.$inferSelect;\n\n\n\n// WHOOP API response types\nexport interface WhoopTodayResponse {\n  cycle_id?: string;\n  strain?: number;\n  recovery_score?: number;\n  sleep_score?: number; // Primary sleep metric\n  sleep_hours?: number; // Secondary sleep metric  \n  sleep_stages?: {\n    light_sleep_minutes?: number;\n    deep_sleep_minutes?: number;\n    rem_sleep_minutes?: number;\n    awake_minutes?: number;\n  };\n  hrv?: number;\n  resting_heart_rate?: number;\n  average_heart_rate?: number;\n  stress_score?: number;\n  skin_temperature?: number;\n  spo2_percentage?: number;\n  respiratory_rate?: number;\n  calories_burned?: number;\n  activity_log?: any[];\n  date?: string;\n  last_sync?: string;\n  raw_data?: {\n    cycle?: any;\n    recovery?: any;\n    sleep?: any;\n    workout?: any;\n    body_measurements?: any;\n  };\n  error?: {\n    type: string;\n    message: string;\n    retryable: boolean;\n  };\n}\n\nexport interface MealResponse {\n  meals: string[];\n}\n\nexport interface ApiStatusResponse {\n  status: string;\n  message: string;\n}\n","size_bytes":5280},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthWrapper } from \"@/components/AuthWrapper\";\nimport Dashboard from \"@/pages/dashboard\";\nimport CalendarPage from \"@/pages/calendar\";\nimport Profile from \"@/pages/profile\";\nimport AdminPage from \"@/pages/admin\";\nimport LoginPage from \"@/pages/login\";\nimport PrivacyPolicy from \"@/pages/PrivacyPolicy\";\nimport Disclaimer from \"@/pages/Disclaimer\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/login\" component={LoginPage} />\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/dashboard\" component={Dashboard} />\n      <Route path=\"/calendar\" component={CalendarPage} />\n      <Route path=\"/profile\" component={Profile} />\n      <Route path=\"/admin\" component={AdminPage} />\n      <Route path=\"/privacy\" component={PrivacyPolicy} />\n      <Route path=\"/disclaimer\" component={Disclaimer} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <AuthWrapper>\n          <Router />\n        </AuthWrapper>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1461},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n.logo {\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  box-shadow: 0 0 18px rgba(0, 140, 255, 0.55);\n}\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(20, 14.3%, 4.1%);\n  --muted: hsl(60, 4.8%, 95.9%);\n  --muted-foreground: hsl(25, 5.3%, 44.7%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(20, 14.3%, 4.1%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(20, 14.3%, 4.1%);\n  --border: hsl(20, 5.9%, 90%);\n  --input: hsl(20, 5.9%, 90%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(60, 4.8%, 95.9%);\n  --secondary-foreground: hsl(24, 9.8%, 10%);\n  --accent: hsl(60, 4.8%, 95.9%);\n  --accent-foreground: hsl(24, 9.8%, 10%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(20, 14.3%, 4.1%);\n  --radius: 0.75rem;\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(240, 3.7%, 15.9%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 15.9%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.75rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n  }\n}\n\n@layer components {\n  .animate-fade-in {\n    animation: fadeIn 0.6s ease-out forwards;\n    opacity: 0;\n  }\n  \n  /* Mobile-specific optimizations */\n  @media (max-width: 640px) {\n    .container {\n      padding-left: 0.75rem;\n      padding-right: 0.75rem;\n    }\n    \n    /* Ensure cards don't overflow on small screens */\n    .card {\n      min-width: 0;\n    }\n    \n    /* Better button spacing on mobile */\n    .mobile-button-stack {\n      display: flex;\n      flex-direction: column;\n      gap: 0.5rem;\n      width: 100%;\n    }\n    \n    /* Mobile-friendly text sizes */\n    .mobile-text-xs { font-size: 0.6875rem; }\n    .mobile-text-sm { font-size: 0.8125rem; }\n    \n    /* Mobile grid optimizations */\n    .mobile-grid-1 {\n      grid-template-columns: repeat(1, minmax(0, 1fr));\n    }\n  }\n  \n  @media (max-width: 480px) {\n    /* Extra small devices */\n    .container {\n      padding-left: 0.5rem;\n      padding-right: 0.5rem;\n    }\n    \n    /* Even smaller text for tiny screens */\n    h1 { font-size: 1.25rem !important; }\n    h2 { font-size: 1.125rem !important; }\n  }\n  \n  .animate-slide-up {\n    animation: slideUp 0.8s ease-out forwards;\n    opacity: 0;\n  }\n  \n  .gradient-glow {\n    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(59, 130, 246, 0.2);\n  }\n\n  .glassy-card {\n    background: rgba(30, 41, 59, 0.4);\n    backdrop-filter: blur(16px);\n    border: 1px solid rgba(148, 163, 184, 0.1);\n    box-shadow: \n      0 4px 32px rgba(0, 0, 0, 0.3),\n      inset 0 1px 0 rgba(255, 255, 255, 0.1);\n  }\n\n  .hover\\:scale-102:hover {\n    transform: scale(1.02);\n  }\n\n  /* Custom Calendar Styles */\n  .custom-calendar {\n    background: transparent;\n    color: #e2e8f0;\n    font-family: 'Inter', sans-serif;\n  }\n\n  .custom-calendar .rbc-header {\n    background: #475569;\n    color: #f8fafc;\n    font-weight: 600;\n    padding: 8px 12px;\n    border-bottom: 1px solid #334155;\n    font-size: 14px;\n  }\n\n  .custom-calendar .rbc-month-view {\n    background: transparent;\n    border: 1px solid #334155;\n    border-radius: 8px;\n    overflow: hidden;\n  }\n\n  .custom-calendar .rbc-date-cell {\n    background: #1e293b;\n    border-right: 1px solid #334155;\n    color: #cbd5e1;\n    padding: 8px;\n    font-size: 14px;\n    font-weight: 500;\n  }\n\n  .custom-calendar .rbc-date-cell:hover {\n    background: #334155;\n  }\n\n  .custom-calendar .rbc-off-range-bg {\n    background: #0f172a;\n    color: #64748b;\n  }\n\n  .custom-calendar .rbc-today {\n    background: #1e40af !important;\n    color: white !important;\n  }\n\n  /* Mobile Responsive Calendar Styles */\n  @media (max-width: 768px) {\n    .custom-calendar {\n      font-size: 12px;\n    }\n    \n    .custom-calendar .rbc-header {\n      padding: 6px 4px;\n      font-size: 12px;\n      font-weight: 500;\n    }\n    \n    .custom-calendar .rbc-date-cell {\n      padding: 4px 2px;\n      font-size: 11px;\n      min-height: 30px;\n    }\n    \n    .custom-calendar .rbc-date-cell a {\n      font-size: 11px;\n      font-weight: 500;\n    }\n    \n    .custom-calendar .rbc-show-more {\n      font-size: 10px;\n      padding: 1px 4px;\n      margin-top: 2px;\n    }\n    \n    .custom-calendar .rbc-month-view {\n      font-size: 11px;\n    }\n    \n    .custom-calendar .rbc-event {\n      font-size: 10px;\n      padding: 1px 2px;\n      margin-bottom: 1px;\n    }\n    \n    .custom-calendar .rbc-toolbar {\n      flex-direction: column;\n      gap: 8px;\n      margin-bottom: 12px;\n    }\n    \n    .custom-calendar .rbc-toolbar-label {\n      font-size: 16px;\n      font-weight: 600;\n    }\n    \n    .custom-calendar .rbc-btn-group {\n      display: flex;\n      gap: 4px;\n    }\n    \n    .custom-calendar .rbc-btn-group button {\n      padding: 4px 8px;\n      font-size: 12px;\n      min-height: 32px;\n    }\n    \n    .custom-calendar .rbc-time-view .rbc-time-header {\n      font-size: 11px;\n    }\n    \n    .custom-calendar .rbc-time-view .rbc-time-gutter {\n      font-size: 10px;\n    }\n    \n    .custom-calendar .rbc-agenda-view .rbc-agenda-date-cell {\n      font-size: 11px;\n      padding: 6px 4px;\n    }\n    \n    .custom-calendar .rbc-agenda-view .rbc-agenda-time-cell {\n      font-size: 10px;\n      padding: 6px 4px;\n    }\n    \n    .custom-calendar .rbc-agenda-view .rbc-agenda-event-cell {\n      font-size: 11px;\n      padding: 6px 4px;\n    }\n  }\n\n  @media (max-width: 480px) {\n    .custom-calendar {\n      font-size: 11px;\n    }\n    \n    .custom-calendar .rbc-header {\n      padding: 4px 2px;\n      font-size: 11px;\n    }\n    \n    .custom-calendar .rbc-date-cell {\n      padding: 2px 1px;\n      font-size: 10px;\n      min-height: 28px;\n    }\n    \n    .custom-calendar .rbc-date-cell a {\n      font-size: 10px;\n    }\n    \n    .custom-calendar .rbc-show-more {\n      font-size: 9px;\n      padding: 0px 2px;\n    }\n    \n    .custom-calendar .rbc-event {\n      font-size: 9px;\n      padding: 0px 1px;\n    }\n    \n    .custom-calendar .rbc-toolbar-label {\n      font-size: 14px;\n    }\n    \n    .custom-calendar .rbc-btn-group button {\n      padding: 3px 6px;\n      font-size: 11px;\n      min-height: 28px;\n    }\n  }\n\n  .custom-calendar .rbc-event {\n    background: #3b82f6;\n    border: none;\n    border-radius: 4px;\n    color: white;\n    font-size: 12px;\n    padding: 2px 4px;\n    margin: 1px;\n  }\n\n  .custom-calendar .rbc-event:hover {\n    background: #2563eb;\n  }\n\n  .custom-calendar .rbc-selected {\n    background: #1d4ed8;\n    color: white;\n  }\n\n  .custom-calendar .rbc-day-bg {\n    background: #1e293b;\n    border-right: 1px solid #334155;\n  }\n\n  .custom-calendar .rbc-day-bg:hover {\n    background: #334155;\n  }\n\n  .custom-calendar .rbc-time-view {\n    background: transparent;\n    border: 1px solid #334155;\n    border-radius: 8px;\n    overflow: hidden;\n  }\n\n  .custom-calendar .rbc-time-header {\n    background: #475569;\n    border-bottom: 1px solid #334155;\n  }\n\n  .custom-calendar .rbc-time-content {\n    background: #1e293b;\n    border-right: 1px solid #334155;\n  }\n\n  .custom-calendar .rbc-time-gutter {\n    background: #1e293b;\n    border-right: 1px solid #334155;\n  }\n\n  .custom-calendar .rbc-time-slot {\n    border-top: 1px solid #334155;\n    color: #94a3b8;\n    font-size: 12px;\n  }\n\n  .custom-calendar .rbc-current-time-indicator {\n    background: #ef4444;\n    height: 2px;\n    z-index: 3;\n  }\n\n  .custom-calendar .rbc-agenda-view {\n    background: transparent;\n    border: 1px solid #334155;\n    border-radius: 8px;\n    overflow: hidden;\n  }\n\n  .custom-calendar .rbc-agenda-view table {\n    background: #1e293b;\n  }\n\n  .custom-calendar .rbc-agenda-view .rbc-agenda-table {\n    border-collapse: collapse;\n  }\n\n  .custom-calendar .rbc-agenda-view .rbc-agenda-table th {\n    background: #475569;\n    color: #f8fafc;\n    font-weight: 600;\n    padding: 12px;\n    border-bottom: 1px solid #334155;\n  }\n\n  .custom-calendar .rbc-agenda-view .rbc-agenda-table td {\n    background: #1e293b;\n    color: #cbd5e1;\n    padding: 8px 12px;\n    border-bottom: 1px solid #334155;\n  }\n\n  .custom-calendar .rbc-agenda-view .rbc-agenda-table tr:hover td {\n    background: #334155;\n  }\n\n  .custom-calendar .rbc-agenda-date-cell {\n    font-weight: 600;\n    color: #3b82f6;\n  }\n\n  .custom-calendar .rbc-agenda-time-cell {\n    color: #94a3b8;\n    font-size: 12px;\n  }\n\n  .custom-calendar .rbc-agenda-event-cell {\n    color: #e2e8f0;\n  }\n\n  .custom-calendar .rbc-show-more {\n    background: #6366f1;\n    color: white;\n    font-size: 11px;\n    padding: 2px 6px;\n    border-radius: 4px;\n    cursor: pointer;\n  }\n\n  .custom-calendar .rbc-show-more:hover {\n    background: #4f46e5;\n  }\n\n  .custom-calendar .rbc-toolbar {\n    background: transparent;\n    padding: 0;\n    margin: 0;\n    border: none;\n  }\n\n  .custom-calendar .rbc-toolbar button {\n    background: #475569;\n    color: #f8fafc;\n    border: 1px solid #334155;\n    padding: 6px 12px;\n    margin: 0 2px;\n    border-radius: 4px;\n    font-size: 14px;\n    cursor: pointer;\n  }\n\n  .custom-calendar .rbc-toolbar button:hover {\n    background: #64748b;\n  }\n\n  .custom-calendar .rbc-toolbar button:focus {\n    outline: none;\n    box-shadow: 0 0 0 2px #3b82f6;\n  }\n\n  .custom-calendar .rbc-toolbar button.rbc-active {\n    background: #3b82f6;\n    color: white;\n  }\n\n  .custom-calendar .rbc-toolbar-label {\n    color: #f8fafc;\n    font-size: 18px;\n    font-weight: 600;\n    margin: 0 16px;\n  }\n\n  /* Animated gradient backgrounds for weekly average cards */\n  .gradient-recovery {\n    background: linear-gradient(135deg, #1E3A8A, #1E40AF, #3B82F6);\n    background-size: 300% 300%;\n    animation: gradientMove 6s ease-in-out infinite;\n  }\n\n  .gradient-strain {\n    background: linear-gradient(135deg, #7F1D1D, #B91C1C, #DC2626);\n    background-size: 300% 300%;\n    animation: gradientMove 6s ease-in-out infinite;\n    animation-delay: 1.5s;\n  }\n\n  .gradient-sleep {\n    background: linear-gradient(135deg, #581C87, #6D28D9, #7C3AED);\n    background-size: 300% 300%;\n    animation: gradientMove 6s ease-in-out infinite;\n    animation-delay: 3s;\n  }\n\n  .gradient-hrv {\n    background: linear-gradient(135deg, #064E3B, #047857, #059669);\n    background-size: 300% 300%;\n    animation: gradientMove 6s ease-in-out infinite;\n    animation-delay: 4.5s;\n  }\n}\n\n@keyframes gradientMove {\n  0%, 100% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes slideUp {\n  from {\n    opacity: 0;\n    transform: translateY(40px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* Custom scrollbar for dark theme */\n::-webkit-scrollbar {\n  width: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(15, 23, 42, 0.1);\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(59, 130, 246, 0.3);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(59, 130, 246, 0.5);\n}","size_bytes":11893},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/AuthWrapper.tsx":{"content":"import { useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useAuth } from '@/hooks/useAuth';\n\ninterface AuthWrapperProps {\n  children: React.ReactNode;\n}\n\nexport function AuthWrapper({ children }: AuthWrapperProps) {\n  const { isAuthenticated, isAuthLoading } = useAuth();\n  const [location, setLocation] = useLocation();\n\n  useEffect(() => {\n    // Check if we have a token in localStorage\n    const hasToken = !!localStorage.getItem('auth_token');\n    \n    console.log('[AUTH] Authentication check:', { isAuthenticated, isAuthLoading, hasToken });\n    \n    // CRITICAL: Every user MUST authenticate with WHOOP first - no bypassing allowed\n    if (!isAuthLoading && !isAuthenticated && !hasToken) {\n      console.log('[AUTH] User not authenticated - MUST authenticate with WHOOP first');\n      \n      // Clear any existing auth data to ensure fresh authentication\n      localStorage.removeItem('auth_token');\n      localStorage.removeItem('whoop_token');\n      \n      // Force WHOOP OAuth authentication - required for all users\n      window.location.href = '/api/whoop/login';\n      return;\n    }\n  }, [isAuthenticated, isAuthLoading]);\n\n  // Show loading spinner while checking authentication\n  if (isAuthLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-slate-300\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Only show content if user is fully authenticated with WHOOP\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-center text-white\">\n          <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <h2 className=\"text-xl font-semibold mb-2\">WHOOP Authentication Required</h2>\n          <p className=\"text-slate-300 mb-4\">You must authenticate with your WHOOP account to access your personal health metrics.</p>\n          <p className=\"text-sm text-slate-400\">Redirecting to WHOOP OAuth...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}","size_bytes":2427},"client/src/components/HealthIcon.tsx":{"content":"import React from 'react';\n\ninterface HealthIconProps {\n  className?: string;\n  size?: number;\n}\n\nexport const HealthIcon: React.FC<HealthIconProps> = ({ className = \"\", size = 24 }) => {\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 100 100\"\n      className={className}\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <defs>\n        <linearGradient id=\"healthGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" stopColor=\"#3b82f6\" />\n          <stop offset=\"50%\" stopColor=\"#8b5cf6\" />\n          <stop offset=\"100%\" stopColor=\"#d946ef\" />\n        </linearGradient>\n      </defs>\n      \n      {/* Outer circle */}\n      <circle\n        cx=\"50\"\n        cy=\"50\"\n        r=\"45\"\n        fill=\"none\"\n        stroke=\"url(#healthGradient)\"\n        strokeWidth=\"3\"\n        strokeLinecap=\"round\"\n        strokeDasharray=\"200 20\"\n        opacity=\"0.8\"\n      />\n      \n      {/* Heartbeat line */}\n      <path\n        d=\"M20 50 L25 50 L30 35 L35 65 L40 20 L45 80 L50 50 L55 40 L60 60 L65 50 L80 50\"\n        fill=\"none\"\n        stroke=\"url(#healthGradient)\"\n        strokeWidth=\"2.5\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      \n      {/* Center pulse dot */}\n      <circle\n        cx=\"50\"\n        cy=\"50\"\n        r=\"3\"\n        fill=\"url(#healthGradient)\"\n        opacity=\"0.9\"\n      >\n        <animate\n          attributeName=\"r\"\n          values=\"3;5;3\"\n          dur=\"1.5s\"\n          repeatCount=\"indefinite\"\n        />\n        <animate\n          attributeName=\"opacity\"\n          values=\"0.9;0.5;0.9\"\n          dur=\"1.5s\"\n          repeatCount=\"indefinite\"\n        />\n      </circle>\n    </svg>\n  );\n};","size_bytes":1686},"client/src/components/api-status.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AlertTriangle } from \"lucide-react\";\n\nexport function ApiStatus() {\n  return (\n    <Card className=\"mt-8\">\n      <CardHeader>\n        <CardTitle className=\"text-lg\">API Endpoints</CardTitle>\n        <p className=\"text-sm text-slate-600\">Available endpoints for Custom GPT integration</p>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-6\">\n          <div className=\"border border-slate-200 rounded-lg p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 hover:bg-green-100\">GET</Badge>\n                <code className=\"text-sm font-mono text-slate-900\">/</code>\n              </div>\n              <Badge variant=\"outline\" className=\"text-xs\">Health Check</Badge>\n            </div>\n            <p className=\"text-sm text-slate-600 mb-2\">Returns API status confirmation</p>\n            <div className=\"bg-slate-50 rounded p-3\">\n              <code className=\"text-xs text-green-700\">\"‚úÖ FitScore GPT API is running\"</code>\n            </div>\n          </div>\n\n          <div className=\"border border-slate-200 rounded-lg p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 hover:bg-green-100\">GET</Badge>\n                <code className=\"text-sm font-mono text-slate-900\">/api/whoop/today</code>\n              </div>\n              <Badge variant=\"outline\" className=\"text-xs bg-blue-50 text-blue-700\">WHOOP Data</Badge>\n            </div>\n            <p className=\"text-sm text-slate-600 mb-2\">Retrieves today's health metrics from WHOOP API</p>\n            <div className=\"bg-slate-50 rounded p-3\">\n              <code className=\"text-xs text-slate-900 whitespace-pre\">\n{`{\n  \"recovery_score\": 78,\n  \"sleep_score\": 85,\n  \"strain_score\": 12.4,\n  \"resting_heart_rate\": 65\n}`}\n              </code>\n            </div>\n          </div>\n\n          <div className=\"border border-slate-200 rounded-lg p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                <Badge variant=\"secondary\" className=\"bg-amber-100 text-amber-800 hover:bg-amber-100\">POST</Badge>\n                <code className=\"text-sm font-mono text-slate-900\">/api/meals</code>\n              </div>\n              <Badge variant=\"outline\" className=\"text-xs bg-amber-50 text-amber-700\">Upload</Badge>\n            </div>\n            <p className=\"text-sm text-slate-600 mb-2\">Upload multiple meal images with multer middleware</p>\n            <div className=\"bg-slate-50 rounded p-3\">\n              <code className=\"text-xs text-slate-900\">Content-Type: multipart/form-data</code>\n            </div>\n          </div>\n\n          <div className=\"border border-slate-200 rounded-lg p-4\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center space-x-3\">\n                <Badge variant=\"secondary\" className=\"bg-green-100 text-green-800 hover:bg-green-100\">GET</Badge>\n                <code className=\"text-sm font-mono text-slate-900\">/api/meals/today</code>\n              </div>\n              <Badge variant=\"outline\" className=\"text-xs bg-green-50 text-green-700\">Meals List</Badge>\n            </div>\n            <p className=\"text-sm text-slate-600 mb-2\">Returns list of today's uploaded meal image URLs</p>\n            <div className=\"bg-slate-50 rounded p-3\">\n              <code className=\"text-xs text-slate-900 whitespace-pre\">\n{`{\n  \"meals\": [\n    \"/uploads/breakfast_0845.jpg\",\n    \"/uploads/lunch_1230.jpg\"\n  ]\n}`}\n              </code>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg\">\n          <div className=\"flex items-start space-x-3\">\n            <AlertTriangle className=\"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0\" />\n            <div>\n              <p className=\"text-sm font-medium text-amber-800\">Implementation Notes</p>\n              <ul className=\"text-sm text-amber-700 mt-2 space-y-1\">\n                <li>‚Ä¢ WHOOP API integration uses placeholder logic with stored access token</li>\n                <li>‚Ä¢ File uploads saved to <code className=\"bg-amber-100 px-1 rounded\">/uploads/</code> with timestamp naming</li>\n                <li>‚Ä¢ Meal metadata stored in server memory (JSON object)</li>\n                <li>‚Ä¢ Static files served from <code className=\"bg-amber-100 px-1 rounded\">/uploads/</code> for Custom GPT access</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4962},"client/src/components/calendar-management.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Trash2, Plus, ExternalLink, ToggleLeft, ToggleRight, CalendarDays, Copy, Check, Edit3 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface UserCalendar {\n  id: number;\n  userId: string;\n  calendarUrl: string;\n  calendarName: string;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport function CalendarManagement() {\n  const { toast } = useToast();\n  const [calendarUrl, setCalendarUrl] = useState('');\n  const [calendarName, setCalendarName] = useState('');\n  const [isAdding, setIsAdding] = useState(false);\n  const [copiedId, setCopiedId] = useState<number | null>(null);\n  const [editingCalendar, setEditingCalendar] = useState<UserCalendar | null>(null);\n\n  const copyToClipboard = async (text: string, id: number) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopiedId(id);\n      setTimeout(() => setCopiedId(null), 2000);\n      toast({\n        title: \"Copied!\",\n        description: \"Calendar URL copied to clipboard\",\n      });\n    } catch (err) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to copy to clipboard\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Fetch user's calendars\n  const { data: calendars = [], isLoading } = useQuery<UserCalendar[]>({\n    queryKey: ['/api/calendars'],\n    retry: false,\n    queryFn: async () => {\n      const token = localStorage.getItem('auth_token');\n      const response = await fetch('/api/calendars', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      if (!response.ok) {\n        throw new Error('Failed to fetch calendars');\n      }\n      return response.json();\n    },\n  });\n\n  // Add calendar mutation\n  const addCalendarMutation = useMutation({\n    mutationFn: async ({ calendarUrl, calendarName }: { calendarUrl: string; calendarName: string }) => {\n      const token = localStorage.getItem('auth_token');\n      const response = await fetch('/api/calendars', {\n        method: 'POST',\n        body: JSON.stringify({ calendarUrl, calendarName }),\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to add calendar');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/calendars'] });\n      setCalendarUrl('');\n      setCalendarName('');\n      setIsAdding(false);\n      toast({\n        title: \"Calendar Added\",\n        description: \"Your calendar has been added successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to add calendar: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete calendar mutation\n  const deleteCalendarMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const token = localStorage.getItem('auth_token');\n      const response = await fetch(`/api/calendars/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete calendar');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/calendars'] });\n      toast({\n        title: \"Calendar Removed\",\n        description: \"Calendar has been removed from your account.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to remove calendar: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update calendar mutation\n  const updateCalendarMutation = useMutation({\n    mutationFn: async ({ id, calendarUrl, calendarName }: { id: number; calendarUrl: string; calendarName: string }) => {\n      const token = localStorage.getItem('auth_token');\n      const response = await fetch(`/api/calendars/${id}`, {\n        method: 'PATCH',\n        body: JSON.stringify({ calendarUrl, calendarName }),\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to update calendar');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/calendars'] });\n      setEditingCalendar(null);\n      setCalendarUrl('');\n      setCalendarName('');\n      toast({\n        title: \"Calendar Updated\",\n        description: \"Calendar has been updated successfully.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update calendar: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Toggle calendar active status\n  const toggleCalendarMutation = useMutation({\n    mutationFn: async ({ id, isActive }: { id: number; isActive: boolean }) => {\n      const token = localStorage.getItem('auth_token');\n      const response = await fetch(`/api/calendars/${id}`, {\n        method: 'PATCH',\n        body: JSON.stringify({ isActive }),\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to update calendar');\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/calendars'] });\n      toast({\n        title: \"Calendar Updated\",\n        description: \"Calendar status has been updated.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: `Failed to update calendar: ${error.message}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddCalendar = async () => {\n    if (!calendarUrl.trim() || !calendarName.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please provide both calendar URL and name.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!calendarUrl.includes('calendar.google.com/calendar/ical/') && !calendarUrl.includes('.ics')) {\n      toast({\n        title: \"Invalid URL\",\n        description: \"Please provide a valid Google Calendar ICS URL (.ics file).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    addCalendarMutation.mutate({ calendarUrl, calendarName });\n  };\n\n  const handleUpdateCalendar = async () => {\n    if (!editingCalendar || !calendarUrl.trim() || !calendarName.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please provide both calendar URL and name.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!calendarUrl.includes('calendar.google.com/calendar/ical/') && !calendarUrl.includes('.ics')) {\n      toast({\n        title: \"Invalid URL\",\n        description: \"Please provide a valid Google Calendar ICS URL (.ics file).\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    updateCalendarMutation.mutate({ \n      id: editingCalendar.id, \n      calendarUrl, \n      calendarName \n    });\n  };\n\n  const startEditing = (calendar: UserCalendar) => {\n    setEditingCalendar(calendar);\n    setCalendarUrl(calendar.calendarUrl);\n    setCalendarName(calendar.calendarName);\n    setIsAdding(false);\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle>Calendar Management</CardTitle>\n          <CardDescription>Loading your calendars...</CardDescription>\n        </CardHeader>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2 text-white\">\n              <CalendarDays className=\"h-5 w-5\" />\n              Calendar Management\n            </CardTitle>\n            <CardDescription className=\"text-slate-400\">\n              By adding your calendars (Google Calendar ICS links), FitScore AI will be able to read your scheduled trainings and other events that may affect performance and recovery to personalize your daily insights.\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={() => setIsAdding(!isAdding)}\n              size=\"sm\"\n              className=\"bg-blue-600 hover:bg-blue-700 text-white border-0\"\n            >\n              <Plus className=\"h-4 w-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">Add</span>\n            </Button>\n\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {(isAdding || editingCalendar) && (\n          <div className=\"p-4 border border-slate-600 rounded-lg bg-slate-900/50 space-y-3\">\n            <h4 className=\"font-medium text-white\">\n              {editingCalendar ? 'Edit Calendar' : 'Add New Calendar'}\n            </h4>\n            <p className=\"text-sm text-slate-400\">\n              To add your Google Calendar:\n              <br />\n              1. Go to your Google Calendar settings\n              <br />\n              2. Find \"Integrate calendar\" section\n              <br />\n              3. Copy the \"Public URL to this calendar\" (ICS format)\n              <br />\n              4. Paste it below along with a name for your calendar\n            </p>\n            <div className=\"space-y-2\">\n              <Input\n                placeholder=\"Calendar Name (e.g., Personal, Work)\"\n                value={calendarName}\n                onChange={(e) => setCalendarName(e.target.value)}\n                className=\"bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-blue-500\"\n              />\n              <Input\n                placeholder=\"Calendar ICS URL (https://calendar.google.com/calendar/ical/...)\"\n                value={calendarUrl}\n                onChange={(e) => setCalendarUrl(e.target.value)}\n                className=\"bg-slate-700 border-slate-600 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-blue-500\"\n              />\n              <div className=\"flex gap-2\">\n                <Button \n                  onClick={editingCalendar ? handleUpdateCalendar : handleAddCalendar}\n                  disabled={editingCalendar ? updateCalendarMutation.isPending : addCalendarMutation.isPending}\n                  size=\"sm\"\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white border-0\"\n                >\n                  {editingCalendar \n                    ? (updateCalendarMutation.isPending ? 'Updating...' : 'Update Calendar')\n                    : (addCalendarMutation.isPending ? 'Adding...' : 'Add Calendar')\n                  }\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => {\n                    setIsAdding(false);\n                    setEditingCalendar(null);\n                    setCalendarUrl('');\n                    setCalendarName('');\n                  }}\n                  size=\"sm\"\n                  className=\"bg-transparent border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {calendars.length === 0 ? (\n          <div className=\"text-center py-8 text-slate-400\">\n            <p>No calendars configured.</p>\n            <p className=\"text-sm\">Add a calendar to see your events in the dashboard.</p>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {calendars.map((calendar) => (\n              <div\n                key={calendar.id}\n                className=\"flex items-center justify-between p-3 border border-slate-600 rounded-lg bg-slate-900/30\"\n              >\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-3 mb-2\">\n                    <h4 className=\"font-medium text-white\">{calendar.calendarName}</h4>\n                    {calendar.isActive ? (\n                      <span className=\"text-xs bg-green-600/20 text-green-400 px-2 py-1 rounded border border-green-600/30 whitespace-nowrap\">\n                        Active\n                      </span>\n                    ) : (\n                      <span className=\"text-xs bg-slate-600/20 text-slate-400 px-2 py-1 rounded border border-slate-600/30 whitespace-nowrap\">\n                        Inactive\n                      </span>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <p className=\"text-sm text-slate-400 truncate flex-1\">\n                      {calendar.calendarUrl.length > 45 \n                        ? `${calendar.calendarUrl.substring(0, 42)}...`\n                        : calendar.calendarUrl\n                      }\n                    </p>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => copyToClipboard(calendar.calendarUrl, calendar.id)}\n                      className=\"bg-transparent border-slate-600 text-slate-400 hover:bg-slate-700 hover:text-white transition-all duration-200 p-1 h-6 w-6 shrink-0\"\n                      title=\"Copy URL\"\n                    >\n                      {copiedId === calendar.id ? (\n                        <Check className=\"h-3 w-3 text-green-400\" />\n                      ) : (\n                        <Copy className=\"h-3 w-3\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2 shrink-0\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => toggleCalendarMutation.mutate({ \n                      id: calendar.id, \n                      isActive: !calendar.isActive \n                    })}\n                    disabled={toggleCalendarMutation.isPending}\n                    className=\"bg-transparent border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200\"\n                  >\n                    {calendar.isActive ? (\n                      <ToggleRight className=\"h-4 w-4\" />\n                    ) : (\n                      <ToggleLeft className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => startEditing(calendar)}\n                    className=\"bg-transparent border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200\"\n                  >\n                    <Edit3 className=\"h-4 w-4\" />\n                  </Button>\n\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => window.open(calendar.calendarUrl, '_blank')}\n                    className=\"hidden sm:flex bg-transparent border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200\"\n                  >\n                    <ExternalLink className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    onClick={() => deleteCalendarMutation.mutate(calendar.id)}\n                    disabled={deleteCalendarMutation.isPending}\n                    className=\"bg-red-600/20 border-red-600/50 text-red-400 hover:bg-red-600/30 hover:text-red-300\"\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":16714},"client/src/components/health-metrics.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Heart, Moon, Zap, Activity, RefreshCw, AlertCircle, ExternalLink } from \"lucide-react\";\nimport type { WhoopTodayResponse } from \"@shared/schema\";\n\ninterface HealthMetricsProps {\n  data?: WhoopTodayResponse;\n  isLoading: boolean;\n  error?: any;\n  onRetry?: () => void;\n}\n\nexport function HealthMetrics({ data, isLoading, error, onRetry }: HealthMetricsProps) {\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Today's Health Metrics</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 gap-6\">\n            {[1, 2, 3, 4].map((i) => (\n              <div key={i} className=\"text-center animate-pulse\">\n                <div className=\"w-20 h-20 bg-slate-200 rounded-full mx-auto mb-3\"></div>\n                <div className=\"h-4 bg-slate-200 rounded mb-1\"></div>\n                <div className=\"h-3 bg-slate-200 rounded w-16 mx-auto\"></div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    const isAuthError = error?.response?.status === 401;\n    \n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Today's Health Metrics</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Alert>\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              {isAuthError \n                ? \"WHOOP authentication required. Please connect your WHOOP account above.\"\n                : \"Unable to fetch health data. Please check your connection and try again.\"\n              }\n            </AlertDescription>\n          </Alert>\n          {onRetry && !isAuthError && (\n            <Button \n              onClick={onRetry} \n              variant=\"outline\" \n              className=\"mt-4\"\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Retry\n            </Button>\n          )}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!data) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Today's Health Metrics</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <Activity className=\"h-12 w-12 text-slate-400 mx-auto mb-4\" />\n            <p className=\"text-slate-600\">No health data available</p>\n            <p className=\"text-sm text-slate-500 mt-1\">Ensure WHOOP account is connected</p>\n          </div>\n          {onRetry && (\n            <Button \n              onClick={onRetry} \n              variant=\"outline\" \n              className=\"mt-4\"\n            >\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Retry\n            </Button>\n          )}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const getScoreColor = (score: number, max: number = 100) => {\n    const percentage = (score / max) * 100;\n    if (percentage >= 80) return \"text-green-600\";\n    if (percentage >= 60) return \"text-amber-600\";\n    return \"text-red-600\";\n  };\n\n  const getScoreLabel = (score: number, max: number = 100) => {\n    const percentage = (score / max) * 100;\n    if (percentage >= 80) return \"Excellent\";\n    if (percentage >= 60) return \"Good\";\n    return \"Needs Attention\";\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg\">Today's Health Metrics</CardTitle>\n          <div className=\"flex items-center space-x-2 text-sm text-slate-600\">\n            <RefreshCw className=\"h-4 w-4\" />\n            <span>Auto-refresh: 5min</span>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 gap-6\">\n          {/* Recovery Score */}\n          <div className=\"text-center\">\n            <div className=\"relative w-20 h-20 mx-auto mb-3\">\n              <Progress \n                value={data.recovery_score} \n                className=\"w-20 h-20 rounded-full [&>div]:rounded-full\" \n              />\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <span className={`text-lg font-bold ${getScoreColor(data.recovery_score)}`}>\n                  {data.recovery_score}\n                </span>\n              </div>\n            </div>\n            <p className=\"text-sm font-medium text-slate-900\">Recovery Score</p>\n            <p className=\"text-xs text-slate-600\">{getScoreLabel(data.recovery_score)}</p>\n          </div>\n\n          {/* Sleep Score */}\n          <div className=\"text-center\">\n            <div className=\"relative w-20 h-20 mx-auto mb-3\">\n              <Progress \n                value={data.sleep_score} \n                className=\"w-20 h-20 rounded-full [&>div]:rounded-full [&>div]:bg-blue-500\" \n              />\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <span className={`text-lg font-bold ${getScoreColor(data.sleep_score)}`}>\n                  {data.sleep_score}\n                </span>\n              </div>\n            </div>\n            <p className=\"text-sm font-medium text-slate-900\">Sleep Score</p>\n            <p className=\"text-xs text-slate-600\">{getScoreLabel(data.sleep_score)}</p>\n          </div>\n\n          {/* Strain Score */}\n          <div className=\"text-center\">\n            <div className=\"bg-amber-50 rounded-lg p-4 mb-2\">\n              <div className=\"text-2xl font-bold text-amber-600\">{data.strain_score}</div>\n            </div>\n            <p className=\"text-sm font-medium text-slate-900\">Strain Score</p>\n            <p className=\"text-xs text-slate-600\">\n              {data.strain_score < 10 ? \"Light Activity\" : data.strain_score < 15 ? \"Moderate Activity\" : \"High Activity\"}\n            </p>\n          </div>\n\n          {/* Resting Heart Rate */}\n          <div className=\"text-center\">\n            <div className=\"bg-red-50 rounded-lg p-4 mb-2\">\n              <div className=\"text-2xl font-bold text-red-600\">{data.resting_heart_rate}</div>\n              <div className=\"text-xs text-slate-600 mt-1\">BPM</div>\n            </div>\n            <p className=\"text-sm font-medium text-slate-900\">Resting HR</p>\n            <p className=\"text-xs text-slate-600\">\n              {data.resting_heart_rate < 60 ? \"Athletic\" : data.resting_heart_rate < 80 ? \"Normal Range\" : \"Above Average\"}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"mt-6 p-4 bg-slate-50 rounded-lg\">\n          <div className=\"flex items-center justify-between text-sm\">\n            <span className=\"text-slate-600\">Last sync:</span>\n            <span className=\"font-medium text-slate-900\">\n              {new Date().toLocaleString([], { \n                month: 'short', \n                day: 'numeric', \n                hour: '2-digit', \n                minute: '2-digit' \n              })}\n            </span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":7258},"client/src/components/meal-upload.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Upload, CloudUpload } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface MealUploadProps {\n  onUploadSuccess: () => void;\n}\n\nexport function MealUpload({ onUploadSuccess }: MealUploadProps) {\n  const [selectedFiles, setSelectedFiles] = useState<FileList | null>(null);\n  const { toast } = useToast();\n\n  const uploadMutation = useMutation({\n    mutationFn: async (files: FileList) => {\n      const formData = new FormData();\n      Array.from(files).forEach(file => {\n        formData.append('mealPhotos', file);\n      });\n\n      const response = await fetch('/api/meals', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to upload meals');\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Upload successful\",\n        description: data.message,\n      });\n      setSelectedFiles(null);\n      // Reset the input\n      const input = document.getElementById('meal-upload') as HTMLInputElement;\n      if (input) input.value = '';\n      onUploadSuccess();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Upload failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setSelectedFiles(e.target.files);\n  };\n\n  const handleUpload = () => {\n    if (selectedFiles && selectedFiles.length > 0) {\n      uploadMutation.mutate(selectedFiles);\n    }\n  };\n\n  const handleDropZoneClick = () => {\n    document.getElementById('meal-upload')?.click();\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg\">Upload Meals</CardTitle>\n        <p className=\"text-sm text-slate-600\">Add meal images for today's nutrition tracking</p>\n      </CardHeader>\n      <CardContent>\n        <div \n          className=\"border-2 border-dashed border-slate-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer\"\n          onClick={handleDropZoneClick}\n        >\n          <div className=\"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center mx-auto mb-4\">\n            <CloudUpload className=\"h-6 w-6 text-blue-600\" />\n          </div>\n          <p className=\"text-slate-900 font-medium mb-2\">Click to upload meal images</p>\n          <p className=\"text-sm text-slate-600\">PNG, JPG up to 10MB each</p>\n          <Input\n            id=\"meal-upload\"\n            type=\"file\"\n            multiple\n            accept=\"image/*\"\n            className=\"hidden\"\n            onChange={handleFileSelect}\n          />\n        </div>\n        \n        {selectedFiles && selectedFiles.length > 0 && (\n          <div className=\"mt-4 p-3 bg-slate-50 rounded-lg\">\n            <p className=\"text-sm text-slate-700 mb-2\">\n              Selected {selectedFiles.length} file(s):\n            </p>\n            <ul className=\"text-xs text-slate-600 space-y-1\">\n              {Array.from(selectedFiles).map((file, index) => (\n                <li key={index} className=\"truncate\">\n                  {file.name} ({(file.size / 1024 / 1024).toFixed(1)} MB)\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n        \n        <div className=\"mt-4\">\n          <Button \n            className=\"w-full bg-blue-600 hover:bg-blue-700\" \n            onClick={handleUpload}\n            disabled={!selectedFiles || selectedFiles.length === 0 || uploadMutation.isPending}\n          >\n            {uploadMutation.isPending ? (\n              <>\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                Uploading...\n              </>\n            ) : (\n              <>\n                <Upload className=\"h-4 w-4 mr-2\" />\n                Upload Selected Images\n              </>\n            )}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4218},"client/src/components/social-auth.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ExternalLink, LogIn, User } from 'lucide-react';\n\ninterface SocialAuthProps {\n  onWhoopAuth?: () => void;\n  isLoading?: boolean;\n  connectedServices?: {\n    whoop: boolean;\n  };\n}\n\nexport default function SocialAuth({ \n  onWhoopAuth,\n  isLoading = false,\n  connectedServices = { whoop: false }\n}: SocialAuthProps) {\n  return (\n    <Card className=\"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border-slate-700 backdrop-blur-sm\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2 text-white\">\n          <LogIn className=\"h-5 w-5\" />\n          WHOOP Authentication\n        </CardTitle>\n        <CardDescription className=\"text-slate-300\">\n          Connect your WHOOP account to access health data\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* WHOOP Authentication Only */}\n        <div className=\"p-6 bg-gradient-to-r from-slate-800 to-slate-700 rounded-lg border border-slate-600\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg\">\n                <User className=\"h-6 w-6 text-white\" />\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <span className=\"text-white font-semibold text-lg\">WHOOP Account</span>\n                  {connectedServices.whoop && (\n                    <Badge variant=\"default\" className=\"text-xs bg-green-600 text-white\">\n                      Connected\n                    </Badge>\n                  )}\n                </div>\n                <span className=\"text-slate-300 text-sm\">Access comprehensive health data and metrics</span>\n              </div>\n            </div>\n            <Button\n              onClick={onWhoopAuth}\n              disabled={isLoading}\n              variant=\"outline\"\n              size=\"lg\"\n              className=\"bg-gradient-to-r from-blue-600 to-purple-600 border-0 text-white hover:from-blue-700 hover:to-purple-700 font-medium px-6 py-3 w-full sm:w-auto\"\n            >\n              {connectedServices.whoop ? (\n                'Reconnect'\n              ) : (\n                <>\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\n                  Connect WHOOP\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n\n        {/* Info Box */}\n        <div className=\"p-4 bg-gradient-to-r from-blue-600/20 to-purple-600/20 border border-blue-500/30 rounded-lg\">\n          <p className=\"text-blue-200 text-sm\">\n            WHOOP connection is required to access real-time health metrics, recovery scores, \n            sleep data, and strain analytics for personalized wellness insights.\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3167},"client/src/components/whoop-auth.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertCircle, CheckCircle, ExternalLink, RefreshCw } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useLocation } from 'wouter';\n\ninterface WhoopAuthStatus {\n  authenticated: boolean;\n  message: string;\n  auth_url?: string;\n  expires_at?: number;\n}\n\nexport function WhoopAuth() {\n  const [authWindow, setAuthWindow] = useState<Window | null>(null);\n  const [, setLocation] = useLocation();\n\n  const { data: authStatus, isLoading, error } = useQuery<WhoopAuthStatus>({\n    queryKey: ['/api/whoop/status'],\n    refetchInterval: 5000, // Check status every 5 seconds\n  });\n\n  const authMutation = useMutation({\n    mutationFn: () => {\n      const authUrl = window.location.origin + '/api/whoop/login';\n      const popup = window.open(authUrl, 'whoop-auth', 'width=600,height=700,scrollbars=yes,resizable=yes');\n      setAuthWindow(popup);\n      return Promise.resolve();\n    },\n    onSuccess: () => {\n      // Start polling for auth completion\n      const pollInterval = setInterval(() => {\n        if (authWindow?.closed) {\n          clearInterval(pollInterval);\n          setAuthWindow(null);\n          // Refresh auth status\n          queryClient.invalidateQueries({ queryKey: ['/api/whoop/status'] });\n        }\n      }, 1000);\n    }\n  });\n\n  const refreshMutation = useMutation({\n    mutationFn: () => {\n      return queryClient.invalidateQueries({ queryKey: ['/api/whoop/status'] });\n    }\n  });\n\n  useEffect(() => {\n    // Listen for authentication success message\n    const handleMessage = (event: MessageEvent) => {\n      if (event.data?.type === 'WHOOP_AUTH_SUCCESS') {\n        console.log('WHOOP authentication successful, redirecting to dashboard...');\n        // Close the auth window\n        if (authWindow && !authWindow.closed) {\n          authWindow.close();\n        }\n        setAuthWindow(null);\n        // Refresh auth status\n        queryClient.invalidateQueries({ queryKey: ['/api/whoop/status'] });\n        // Redirect to dashboard\n        setLocation('/');\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n    \n    // Clean up auth window on unmount\n    return () => {\n      window.removeEventListener('message', handleMessage);\n      if (authWindow && !authWindow.closed) {\n        authWindow.close();\n      }\n    };\n  }, [authWindow, setLocation]);\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <RefreshCw className=\"h-4 w-4 animate-spin\" />\n            WHOOP Connection\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-sm text-muted-foreground\">Checking authentication status...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (error) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <AlertCircle className=\"h-4 w-4 text-destructive\" />\n            WHOOP Connection Error\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Alert>\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Failed to check WHOOP authentication status. Please try again.\n            </AlertDescription>\n          </Alert>\n          <Button \n            onClick={() => refreshMutation.mutate()} \n            disabled={refreshMutation.isPending}\n            className=\"mt-4\"\n            variant=\"outline\"\n          >\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Retry\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const isAuthenticated = authStatus?.authenticated;\n  const expiresAt = authStatus?.expires_at ? new Date(authStatus.expires_at) : null;\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <span className=\"flex items-center gap-2\">\n            {isAuthenticated ? (\n              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n            ) : (\n              <AlertCircle className=\"h-4 w-4 text-yellow-500\" />\n            )}\n            WHOOP Connection\n          </span>\n          <Badge variant={isAuthenticated ? \"default\" : \"secondary\"}>\n            {isAuthenticated ? \"Connected\" : \"Not Connected\"}\n          </Badge>\n        </CardTitle>\n        <CardDescription>\n          {authStatus?.message}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {!isAuthenticated ? (\n          <div className=\"space-y-4\">\n            <Alert>\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Connect your WHOOP account to access live health data including recovery scores, sleep metrics, and strain data.\n              </AlertDescription>\n            </Alert>\n            <Button \n              onClick={() => authMutation.mutate()}\n              disabled={authMutation.isPending}\n              className=\"w-full\"\n            >\n              <ExternalLink className=\"h-4 w-4 mr-2\" />\n              {authMutation.isPending ? 'Opening WHOOP...' : 'Connect WHOOP Account'}\n            </Button>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <Alert>\n              <CheckCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Your WHOOP account is connected and ready to provide live health data.\n              </AlertDescription>\n            </Alert>\n            {expiresAt && (\n              <p className=\"text-sm text-muted-foreground\">\n                Access token expires: {expiresAt.toLocaleDateString()} at {expiresAt.toLocaleTimeString()}\n              </p>\n            )}\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => refreshMutation.mutate()}\n                disabled={refreshMutation.isPending}\n              >\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Refresh Status\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => authMutation.mutate()}\n                disabled={authMutation.isPending}\n              >\n                <ExternalLink className=\"h-4 w-4 mr-2\" />\n                Re-authenticate\n              </Button>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6835},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/hooks/useAuth.ts":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useEffect } from 'react';\n\ninterface AuthUser {\n  userId: string;\n  role?: string;\n}\n\ninterface AuthResponse {\n  message: string;\n}\n\nfunction isTokenExpired(token: string): boolean {\n  try {\n    const payload = JSON.parse(atob(token.split('.')[1]));\n    return payload.exp * 1000 < Date.now();\n  } catch {\n    return true; // Invalid token format\n  }\n}\n\nexport function useAuth() {\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n\n  // Check for token in URL hash on mount (OAuth callback)\n  useEffect(() => {\n    const checkForToken = () => {\n      if (window.location.hash.startsWith('#token=')) {\n        const token = window.location.hash.replace('#token=', '');\n        localStorage.setItem('auth_token', token);\n        window.history.replaceState({}, '', '/');\n        \n        // Trigger a refetch of user data\n        queryClient.invalidateQueries({ queryKey: ['/api/auth/me'] });\n        \n        console.log('[AUTH] JWT token received and stored');\n        return;\n      }\n      \n      // Check if current token is expired or missing\n      const currentToken = localStorage.getItem('auth_token');\n      if (!currentToken || isTokenExpired(currentToken)) {\n        console.log('[AUTH] No valid token found, redirecting to WHOOP OAuth');\n        localStorage.removeItem('auth_token');\n        window.location.href = '/api/whoop/login';\n        return;\n      }\n    };\n\n    checkForToken();\n  }, [queryClient]);\n\n  // Query to check if user is authenticated\n  const { data: user, isLoading, error } = useQuery({\n    queryKey: ['/api/auth/me'],\n    queryFn: () => apiRequest<AuthUser>('/api/auth/me'),\n    retry: false,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  // Check if token exists and is valid in localStorage\n  const currentToken = localStorage.getItem('auth_token');\n  const hasValidToken = currentToken && !isTokenExpired(currentToken);\n\n  // Logout mutation\n  const logoutMutation = useMutation({\n    mutationFn: () => apiRequest<AuthResponse>('/api/auth/logout', { method: 'POST' }),\n    onSuccess: () => {\n      // Remove JWT token from localStorage\n      localStorage.removeItem('auth_token');\n      queryClient.clear(); // Clear all cached data\n      setLocation('/');\n    },\n  });\n\n  const logout = () => {\n    logoutMutation.mutate();\n  };\n  \n  // More robust authentication logic\n  const isAuthenticated = hasValidToken && !!user && !error;\n  \n  // Consider authenticated if we have a valid token, even if user data is still loading\n  const isAuthLoading = isLoading && hasValidToken;\n\n  return {\n    user,\n    isAuthenticated,\n    isAuthLoading,\n    logout,\n    isLoggingOut: logoutMutation.isPending\n  };\n}","size_bytes":2848},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest<T = any>(\n  url: string,\n  options: RequestInit = {}\n): Promise<T> {\n  const token = localStorage.getItem('auth_token');\n  \n  const res = await fetch(url, {\n    credentials: \"include\", // 5. ALWAYS include credentials\n    mode: \"cors\",\n    ...options,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token && { 'Authorization': `Bearer ${token}` }),\n      ...options.headers,\n    },\n  });\n\n  await throwIfResNotOk(res);\n  return await res.json();\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const token = localStorage.getItem('auth_token');\n    \n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\", // 5. ALWAYS include credentials\n      mode: \"cors\",\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token && { 'Authorization': `Bearer ${token}` }),\n      },\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1759},"client/src/lib/utils.ts":{"content":"import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nexport function formatFileSize(bytes: number): string {\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  if (bytes === 0) return '0 Bytes';\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];\n}\n\nexport function formatDate(date: Date | string): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n  });\n}\n\nexport function formatTime(date: Date | string): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleTimeString('en-US', {\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n}\n","size_bytes":890},"client/src/pages/admin.tsx":{"content":"import { useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { useAuth } from '@/hooks/useAuth';\nimport { Users, Crown, Calendar, ExternalLink } from 'lucide-react';\n\nfunction FitScoreLogo({ size = 64 }: { size?: number }) {\n  return (\n    <div className=\"relative flex items-center justify-center\" style={{ width: size, height: size }}>\n      <svg \n        width={size} \n        height={size} \n        viewBox=\"0 0 100 100\" \n        fill=\"none\" \n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"drop-shadow-lg\"\n      >\n        <defs>\n          <linearGradient id=\"logoGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"#06B6D4\" />\n            <stop offset=\"30%\" stopColor=\"#3B82F6\" />\n            <stop offset=\"70%\" stopColor=\"#8B5CF6\" />\n            <stop offset=\"100%\" stopColor=\"#D946EF\" />\n          </linearGradient>\n        </defs>\n        \n        {/* Background circle */}\n        <circle \n          cx=\"50\" \n          cy=\"50\" \n          r=\"48\" \n          fill=\"rgba(30, 41, 59, 0.8)\"\n          stroke=\"url(#logoGradient)\"\n          strokeWidth=\"1\"\n        />\n        \n        {/* Heartbeat line */}\n        <path\n          d=\"M15 50 L20 50 L25 35 L30 65 L35 20 L40 80 L45 50 L50 40 L55 60 L60 50 L65 45 L70 55 L75 50 L85 50\"\n          fill=\"none\"\n          stroke=\"white\"\n          strokeWidth=\"2.8\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          opacity=\"0.95\"\n        />\n        \n        {/* Center pulse dot */}\n        <circle\n          cx=\"50\"\n          cy=\"50\"\n          r=\"2.5\"\n          fill=\"white\"\n          opacity=\"1\"\n        />\n      </svg>\n    </div>\n  );\n}\nimport { Link } from 'wouter';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface AdminUser {\n  id: string;\n  email: string;\n  createdAt: string;\n  hasWhoopToken: boolean;\n  tokenExpiresAt?: string;\n}\n\nexport default function AdminPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  // Redirect non-admin users\n  useEffect(() => {\n    if (user && user.role !== 'admin') {\n      toast({\n        title: \"Unauthorized\",\n        description: \"Admin access required to view this page.\",\n        variant: \"destructive\",\n      });\n      window.location.href = '/';\n    }\n  }, [user, toast]);\n\n  const { data: adminUsers, isLoading: usersLoading } = useQuery<AdminUser[]>({\n    queryKey: ['/api/admin/users'],\n    enabled: user?.role === 'admin',\n    retry: 3,\n  });\n\n  if (!user || user.role !== 'admin') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-center text-white\">\n          <div className=\"w-8 h-8 border-4 border-red-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <h2 className=\"text-xl font-semibold mb-2\">Access Denied</h2>\n          <p className=\"text-slate-300\">Admin privileges required</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6 lg:py-8\">\n        {/* Header */}\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 sm:mb-8 space-y-4 sm:space-y-0\">\n          <div className=\"flex items-center space-x-3 sm:space-x-4\">\n            <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-orange-500 to-red-600 rounded-full flex items-center justify-center\">\n              <Crown className=\"h-5 w-5 sm:h-6 sm:w-6 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-white\">Admin Dashboard</h1>\n              <p className=\"text-slate-400 text-sm sm:text-base hidden sm:block\">User management and system administration</p>\n              <p className=\"text-slate-400 text-xs sm:hidden\">User Management</p>\n            </div>\n          </div>\n\n          <div className=\"flex justify-center sm:justify-end\">\n            <Link href=\"/\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"relative overflow-hidden border-transparent bg-gradient-to-r from-pink-500 to-rose-600 text-white hover:from-pink-600 hover:to-rose-700\"\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-r from-pink-400 to-rose-500 opacity-30 animate-pulse\"></div>\n                <div className=\"relative flex items-center space-x-2\">\n                  <FitScoreLogo size={16} />\n                  <span className=\"hidden sm:inline\">Dashboard</span>\n                  <span className=\"sm:hidden\">Back</span>\n                </div>\n              </Button>\n            </Link>\n          </div>\n        </div>\n\n        {/* User Management Section */}\n        <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center space-x-3\">\n              <Users className=\"h-5 w-5 text-blue-400\" />\n              <span>User Management</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {usersLoading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <div className=\"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin\"></div>\n                <span className=\"ml-3 text-slate-300\">Loading users...</span>\n              </div>\n            ) : adminUsers && adminUsers.length > 0 ? (\n              <div className=\"space-y-4\">\n                {adminUsers.map((adminUser) => (\n                  <div\n                    key={adminUser.id}\n                    className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 sm:p-4 bg-slate-700/50 rounded-lg border border-slate-600 space-y-3 sm:space-y-0\"\n                  >\n                    <div className=\"flex items-center space-x-3 sm:space-x-4 min-w-0 flex-1\">\n                      <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0\">\n                        <Users className=\"h-4 w-4 sm:h-5 sm:w-5 text-white\" />\n                      </div>\n                      <div className=\"min-w-0 flex-1\">\n                        <p className=\"text-white font-medium text-sm sm:text-base truncate\">\n                          {adminUser.email \n                            ? adminUser.email.length > 25 \n                              ? `${adminUser.email.substring(0, 22)}...`\n                              : adminUser.email\n                            : `${adminUser.id.substring(0, 20)}...`\n                          }\n                        </p>\n                        <p className=\"text-slate-400 text-xs sm:text-sm\">\n                          Added: {new Date(adminUser.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between sm:justify-end space-x-2 sm:space-x-3 flex-shrink-0\">\n                      <Badge\n                        variant={adminUser.hasWhoopToken ? \"default\" : \"secondary\"}\n                        className={`text-xs ${adminUser.hasWhoopToken ? \"bg-green-600 hover:bg-green-700\" : \"bg-slate-600\"}`}\n                      >\n                        {adminUser.hasWhoopToken ? \"Connected\" : \"No Token\"}\n                      </Badge>\n                      \n                      {adminUser.hasWhoopToken && adminUser.tokenExpiresAt && (\n                        <span className=\"text-xs text-slate-400 hidden lg:inline\">\n                          Expires: {new Date(adminUser.tokenExpiresAt).toLocaleDateString()}\n                        </span>\n                      )}\n\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"bg-transparent border-slate-500 text-slate-300 hover:bg-slate-600 hover:text-white text-xs sm:text-sm px-2 sm:px-3\"\n                        onClick={() => {\n                          toast({\n                            title: \"User Details\",\n                            description: `WHOOP ID: ${adminUser.id}`,\n                          });\n                        }}\n                      >\n                        <ExternalLink className=\"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2\" />\n                        <span className=\"hidden sm:inline\">View</span>\n                        <span className=\"sm:hidden\">‚Ä¢‚Ä¢‚Ä¢</span>\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Users className=\"h-12 w-12 text-slate-500 mx-auto mb-4\" />\n                <p className=\"text-slate-400\">No users found</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":9267},"client/src/pages/calendar.tsx":{"content":"import { useState, useEffect, useMemo } from 'react';\nimport { Calendar, momentLocalizer, Views } from 'react-big-calendar';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { CalendarIcon, MapPin, Clock, ChevronLeft, ChevronRight, ArrowLeft } from 'lucide-react';\nimport { Link } from 'wouter';\nimport moment from 'moment-timezone';\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\nimport '../styles/calendar.css';\n\n// Configure moment for Europe/Zurich timezone\nmoment.tz.setDefault('Europe/Zurich');\nmoment.locale('en');\nconst localizer = momentLocalizer(moment);\n\ninterface CalendarEvent {\n  id: string;\n  title: string;\n  start: string;\n  end: string;\n  startTime: string;\n  endTime: string;\n  location?: string;\n  date: string;\n}\n\ninterface CalendarEventsResponse {\n  events: CalendarEvent[];\n  range: {\n    start: string;\n    end: string;\n  };\n}\n\nexport default function CalendarPage() {\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [view, setView] = useState<'month' | 'week' | 'day'>('month');\n  const [selectedEvent, setSelectedEvent] = useState<any>(null);\n  const [showEventDialog, setShowEventDialog] = useState(false);\n\n  // Calculate date range for API query based on current view\n  const { startDate, endDate } = useMemo(() => {\n    const current = moment(currentDate).tz('Europe/Zurich');\n    \n    switch (view) {\n      case 'month':\n        return {\n          startDate: current.clone().startOf('month').startOf('week').format('YYYY-MM-DD'),\n          endDate: current.clone().endOf('month').endOf('week').format('YYYY-MM-DD')\n        };\n      case 'week':\n        return {\n          startDate: current.clone().startOf('week').format('YYYY-MM-DD'),\n          endDate: current.clone().endOf('week').format('YYYY-MM-DD')\n        };\n      case 'day':\n        return {\n          startDate: current.format('YYYY-MM-DD'),\n          endDate: current.format('YYYY-MM-DD')\n        };\n      default:\n        return {\n          startDate: current.clone().startOf('month').format('YYYY-MM-DD'),\n          endDate: current.clone().endOf('month').format('YYYY-MM-DD')\n        };\n    }\n  }, [currentDate, view]);\n\n  // Fetch calendar events\n  const { data: calendarData, isLoading, error, refetch } = useQuery<CalendarEventsResponse>({\n    queryKey: ['/api/calendar/events', startDate, endDate],\n    queryFn: async () => {\n      const token = localStorage.getItem('auth_token');\n      const response = await fetch(`/api/calendar/events?start=${startDate}&end=${endDate}`, {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      if (!response.ok) {\n        throw new Error('Failed to fetch calendar events');\n      }\n      return response.json();\n    },\n    refetchInterval: 5 * 60 * 1000, // Refresh every 5 minutes\n  });\n\n  // Transform events for react-big-calendar\n  const calendarEvents = useMemo(() => {\n    if (!calendarData?.events) return [];\n\n    return calendarData.events.map(event => ({\n      id: event.id,\n      title: event.title,\n      start: new Date(event.start),\n      end: new Date(event.end),\n      resource: {\n        location: event.location,\n        startTime: event.startTime,\n        endTime: event.endTime\n      }\n    }));\n  }, [calendarData]);\n\n  // Navigation handlers\n  const handleNavigate = (newDate: Date) => {\n    setCurrentDate(newDate);\n  };\n\n  const handleViewChange = (newView: 'month' | 'week' | 'day') => {\n    setView(newView);\n  };\n\n  // Handle event selection\n  const handleEventClick = (event: any) => {\n    setSelectedEvent(event);\n    setShowEventDialog(true);\n  };\n\n  // Custom event component\n  const EventComponent = ({ event }: { event: any }) => (\n    <div \n      className=\"text-xs p-1 text-slate-200 bg-slate-700/80 hover:bg-slate-600/80 rounded cursor-pointer transition-colors duration-200 backdrop-blur-sm border border-slate-600/30\"\n      onClick={() => handleEventClick(event)}\n    >\n      <div className=\"font-medium truncate\">{event.title}</div>\n      <div className=\"flex items-center space-x-1 mt-1 text-slate-300\">\n        <Clock className=\"h-3 w-3\" />\n        <span>{event.resource.startTime}</span>\n      </div>\n    </div>\n  );\n\n  // Custom toolbar component\n  const CustomToolbar = ({ label, onNavigate, onView }: any) => (\n    <div className=\"flex items-center justify-between mb-6 p-4 bg-slate-800/30 rounded-lg border border-slate-700/30 backdrop-blur-sm\">\n      <div className=\"flex items-center space-x-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => onNavigate('PREV')}\n          className=\"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-colors duration-200\"\n        >\n          <ChevronLeft className=\"h-4 w-4\" />\n        </Button>\n        <h2 className=\"text-lg font-semibold text-white\">{label}</h2>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => onNavigate('NEXT')}\n          className=\"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-colors duration-200\"\n        >\n          <ChevronRight className=\"h-4 w-4\" />\n        </Button>\n      </div>\n      \n      <div className=\"flex items-center space-x-2\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => onNavigate('TODAY')}\n          className=\"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-colors duration-200\"\n        >\n          Today\n        </Button>\n        <div className=\"flex border border-slate-600/50 rounded-md overflow-hidden\">\n          {['month', 'week', 'day'].map((v) => (\n            <Button\n              key={v}\n              variant={view === v ? 'default' : 'ghost'}\n              size=\"sm\"\n              onClick={() => onView(v)}\n              className={`\n                capitalize rounded-none border-0 transition-colors duration-200\n                ${view === v \n                  ? 'bg-slate-600 text-white' \n                  : 'text-slate-300 hover:text-white hover:bg-slate-700/50'\n                }\n              `}\n            >\n              {v}\n            </Button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center justify-center h-96\">\n            <div className=\"flex items-center space-x-2 text-slate-400\">\n              <div className=\"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\n              <span>Loading calendar...</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <Card className=\"max-w-md mx-auto bg-slate-800/50 border-slate-700\">\n            <CardContent className=\"p-6 text-center\">\n              <div className=\"text-red-400 mb-4\">\n                <CalendarIcon className=\"h-16 w-16 mx-auto mb-2\" />\n                <h3 className=\"text-lg font-semibold\">Calendar Error</h3>\n              </div>\n              <p className=\"text-slate-400 mb-4\">\n                {error instanceof Error ? error.message : 'Failed to load calendar'}\n              </p>\n              <Button onClick={() => refetch()} className=\"bg-blue-600 hover:bg-blue-700\">\n                Try Again\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-2 sm:px-4 py-4 sm:py-8\">\n        {/* Header */}\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 gap-4\">\n          <div>\n            <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Calendar</h1>\n            <p className=\"text-slate-400 text-sm sm:text-base\">Your schedule in Europe/Zurich time</p>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            <Badge variant=\"secondary\" className=\"bg-slate-700 text-slate-300 text-xs sm:text-sm\">\n              {calendarEvents.length} events\n            </Badge>\n\n            <Button\n              onClick={() => refetch()}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"bg-transparent border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200 text-xs sm:text-sm\"\n            >\n              <CalendarIcon className=\"h-4 w-4 mr-2\" />\n              Refresh\n            </Button>\n\n            <Link href=\"/dashboard\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"bg-transparent border-2 border-[#00D4FF] text-[#00D4FF] hover:bg-gradient-to-r hover:from-[#00D4FF] hover:to-[#0099FF] hover:text-white hover:border-transparent transition-all duration-200 hover:shadow-[0_0_20px_rgba(0,212,255,0.3)]\"\n              >\n                <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                Back to Dashboard\n              </Button>\n            </Link>\n          </div>\n        </div>\n\n        {/* Calendar or Empty State */}\n        {calendarEvents.length === 0 ? (\n          <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n            <CardContent className=\"p-8 text-center\">\n              <div className=\"max-w-md mx-auto\">\n                <CalendarIcon className=\"h-16 w-16 mx-auto text-slate-500 mb-4\" />\n                <h3 className=\"text-xl font-semibold text-white mb-2\">No Calendars Connected</h3>\n                <p className=\"text-slate-400 mb-6\">\n                  Connect your Google Calendar to see your events here. Add your calendar ICS URLs in your profile settings.\n                </p>\n                <Link href=\"/profile\">\n                  <Button className=\"bg-blue-600 hover:bg-blue-700 text-white\">\n                    <CalendarIcon className=\"h-4 w-4 mr-2\" />\n                    Add Calendars\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm overflow-hidden\">\n            <CardContent className=\"p-2 sm:p-6\">\n              <div className=\"calendar-container w-full\" style={{ height: window.innerWidth < 768 ? '500px' : '700px' }}>\n                <Calendar\n                  localizer={localizer}\n                  events={calendarEvents}\n                  startAccessor=\"start\"\n                  endAccessor=\"end\"\n                  date={currentDate}\n                  view={view}\n                  onNavigate={handleNavigate}\n                  onView={handleViewChange}\n                  components={{\n                    toolbar: CustomToolbar,\n                    event: EventComponent\n                  }}\n                  views={[Views.MONTH, Views.WEEK, Views.DAY]}\n                  step={60}\n                  onSelectEvent={handleEventClick}\n                  style={{ \n                    height: '100%',\n                    width: '100%',\n                    fontFamily: 'Inter, system-ui, sans-serif'\n                  }}\n                  eventPropGetter={() => ({\n                    style: {\n                      backgroundColor: '#3B82F6',\n                      borderColor: '#1E40AF',\n                      color: 'white',\n                      border: '1px solid #1E40AF',\n                      borderRadius: '4px'\n                    }\n                  })}\n                  dayPropGetter={() => ({\n                    style: {\n                      backgroundColor: 'transparent'\n                    }\n                  })}\n                  slotPropGetter={() => ({\n                    style: {\n                      backgroundColor: 'transparent'\n                    }\n                  })}\n                  className=\"custom-calendar\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Event Detail Dialog */}\n        <Dialog open={showEventDialog} onOpenChange={setShowEventDialog}>\n          <DialogContent className=\"bg-slate-800 border-slate-700 text-white\">\n            <DialogHeader>\n              <DialogTitle className=\"text-xl font-semibold text-white\">\n                Event Details\n              </DialogTitle>\n            </DialogHeader>\n            {selectedEvent && (\n              <div className=\"space-y-4\">\n                <div>\n                  <h3 className=\"text-lg font-medium text-white mb-2\">\n                    {selectedEvent.title}\n                  </h3>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <div className=\"flex items-center space-x-2 text-slate-300\">\n                      <Clock className=\"h-4 w-4\" />\n                      <span className=\"text-sm\">Time</span>\n                    </div>\n                    <div className=\"text-white mt-1\">\n                      {selectedEvent.resource?.startTime} - {selectedEvent.resource?.endTime}\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <div className=\"flex items-center space-x-2 text-slate-300\">\n                      <CalendarIcon className=\"h-4 w-4\" />\n                      <span className=\"text-sm\">Date</span>\n                    </div>\n                    <div className=\"text-white mt-1\">\n                      {moment(selectedEvent.start).format('MMMM Do, YYYY')}\n                    </div>\n                  </div>\n                </div>\n\n                {selectedEvent.resource?.location && (\n                  <div>\n                    <div className=\"flex items-center space-x-2 text-slate-300\">\n                      <MapPin className=\"h-4 w-4\" />\n                      <span className=\"text-sm\">Location</span>\n                    </div>\n                    <div className=\"text-white mt-1\">\n                      {selectedEvent.resource.location}\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"pt-4 border-t border-slate-600\">\n                  <Button \n                    onClick={() => setShowEventDialog(false)}\n                    className=\"w-full bg-slate-600 hover:bg-slate-500 text-white\"\n                  >\n                    Close\n                  </Button>\n                </div>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}","size_bytes":15044},"client/src/pages/dashboard-broken.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Activity, \n  Heart, \n  Moon, \n  Zap,\n  RefreshCw,\n  ExternalLink,\n  AlertCircle,\n  TrendingUp,\n  Clock\n} from \"lucide-react\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useEffect, useState } from \"react\";\nimport { formatTime } from \"@/lib/utils\";\nimport type { WhoopTodayResponse } from \"@shared/schema\";\n\ninterface WhoopAuthStatus {\n  authenticated: boolean;\n  message: string;\n  auth_url?: string;\n  expires_at?: number;\n}\n\ninterface WhoopSummary {\n  avgRecovery: number | null;\n  avgStrain: number | null;\n  avgSleep: number | null;\n  avgHRV: number | null;\n}\n\ninterface CountUpProps {\n  end: number;\n  duration?: number;\n  suffix?: string;\n  decimals?: number;\n}\n\nfunction CountUp({ end, duration = 1000, suffix = \"\", decimals = 0 }: CountUpProps) {\n  const [count, setCount] = useState(0);\n  \n  useEffect(() => {\n    let startTime: number;\n    let animationFrame: number;\n    \n    const animate = (currentTime: number) => {\n      if (!startTime) startTime = currentTime;\n      const progress = Math.min((currentTime - startTime) / duration, 1);\n      \n      const easeOutQuart = 1 - Math.pow(1 - progress, 4);\n      setCount(end * easeOutQuart);\n      \n      if (progress < 1) {\n        animationFrame = requestAnimationFrame(animate);\n      }\n    };\n    \n    animationFrame = requestAnimationFrame(animate);\n    \n    return () => {\n      if (animationFrame) {\n        cancelAnimationFrame(animationFrame);\n      }\n    };\n  }, [end, duration]);\n  \n  return (\n    <span>\n      {count.toFixed(decimals)}{suffix}\n    </span>\n  );\n}\n\nfunction CircularProgress({ value, max = 100, size = 120, strokeWidth = 8, color = \"#3b82f6\" }: {\n  value: number;\n  max?: number;\n  size?: number;\n  strokeWidth?: number;\n  color?: string;\n}) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = radius * 2 * Math.PI;\n  const progress = (value / max) * circumference;\n  \n  return (\n    <div className=\"relative inline-flex items-center justify-center\">\n      <svg width={size} height={size} className=\"transform -rotate-90\">\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          stroke=\"currentColor\"\n          strokeWidth={strokeWidth}\n          fill=\"transparent\"\n          className=\"text-slate-700\"\n        />\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          stroke={color}\n          strokeWidth={strokeWidth}\n          fill=\"transparent\"\n          strokeDasharray={circumference}\n          strokeDashoffset={circumference - progress}\n          strokeLinecap=\"round\"\n          className=\"transition-all duration-1000 ease-out\"\n          style={{\n            filter: `drop-shadow(0 0 6px ${color}40)`\n          }}\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex items-center justify-center\">\n        <span className=\"text-2xl font-bold text-white\">\n          <CountUp end={value} suffix=\"%\" duration={1500} />\n        </span>\n      </div>\n    </div>\n  );\n}\n\n// FitScore logo using the real brand image\nfunction FitScoreLogo({ className = \"\", size = 64 }: { className?: string; size?: number }) {\n  return (\n    <div className={`flex items-center justify-center ${className}`}>\n      <img \n        src=\"/attached_assets/ChatGPT Image 2025. g. 11. j≈´n. 10_44_10_1750431009671.png\" \n        alt=\"FitScore Logo\" \n        width={size} \n        height={size}\n        className=\"drop-shadow-lg\"\n        style={{ \n          filter: 'drop-shadow(0 0 20px rgba(59, 130, 246, 0.5))',\n          borderRadius: '50%'\n        }}\n      />\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const [lastSync, setLastSync] = useState<Date | null>(null);\n  \n  const { data: whoopData, isLoading: whoopLoading, refetch: refetchWhoop, error: whoopError } = useQuery<WhoopTodayResponse>({\n    queryKey: ['/api/whoop/today'],\n    retry: false,\n    refetchInterval: 5 * 60 * 1000, // Auto-refresh every 5 minutes\n  });\n\n  // Set last sync when data changes\n  useEffect(() => {\n    if (whoopData) {\n      setLastSync(new Date());\n    }\n  }, [whoopData]);\n\n  const { data: whoopAuthStatus, isLoading: authLoading, error: authError } = useQuery<WhoopAuthStatus>({\n    queryKey: ['/api/whoop/status'],\n    refetchInterval: 30000, // Check auth status every 30 seconds\n  });\n\n  const { data: whoopSummary, isLoading: summaryLoading, error: summaryError } = useQuery<WhoopSummary>({\n    queryKey: ['/api/whoop/weekly'],\n    enabled: whoopAuthStatus?.authenticated === true,\n    refetchInterval: 5 * 60 * 1000, // Auto-refresh every 5 minutes\n  });\n\n\n\n\n\n  const isWhoopConnected = whoopAuthStatus?.authenticated;\n\n  const connectWhoopMutation = useMutation({\n    mutationFn: () => {\n      const authUrl = window.location.origin + '/api/whoop/login';\n      const popup = window.open(authUrl, 'whoop-auth', 'width=600,height=700,scrollbars=yes,resizable=yes');\n      \n      return new Promise<void>((resolve) => {\n        const pollInterval = setInterval(() => {\n          if (popup?.closed) {\n            clearInterval(pollInterval);\n            queryClient.invalidateQueries({ queryKey: ['/api/whoop/status'] });\n            queryClient.invalidateQueries({ queryKey: ['/api/whoop/today'] });\n            queryClient.invalidateQueries({ queryKey: ['/api/whoop/weekly'] });\n            resolve();\n          }\n        }, 1000);\n      });\n    }\n  });\n\n  const refreshData = () => {\n    queryClient.invalidateQueries({ queryKey: ['/api/whoop/today'] });\n    queryClient.invalidateQueries({ queryKey: ['/api/whoop/weekly'] });\n    setLastSync(new Date());\n  };\n\n  if (!isWhoopConnected) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center\">\n        <div className=\"text-center space-y-8 p-8 animate-fade-in\">\n          <div className=\"flex justify-center mb-8\">\n            <FitScoreLogo size={128} className=\"animate-pulse\" />\n          </div>\n          \n          <div className=\"space-y-4\">\n            <h1 className=\"text-4xl font-bold text-white\">FitScore Health Dashboard</h1>\n            <p className=\"text-xl text-slate-300\">Connect your WHOOP device to get started</p>\n          </div>\n          \n          <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n            <CardContent className=\"p-8\">\n              <div className=\"text-center space-y-6\">\n                <AlertCircle className=\"h-16 w-16 text-blue-400 mx-auto\" />\n                <div className=\"space-y-2\">\n                  <h3 className=\"text-xl font-semibold text-white\">WHOOP Connection Required</h3>\n                  <p className=\"text-slate-400\">\n                    Authenticate with your WHOOP account to access your health metrics and insights.\n                  </p>\n                </div>\n                <Button \n                  onClick={() => connectWhoopMutation.mutate()}\n                  disabled={connectWhoopMutation.isPending}\n                  className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-3 px-8 rounded-xl transition-all duration-300 transform hover:scale-105\"\n                  style={{\n                    boxShadow: '0 4px 20px rgba(59, 130, 246, 0.3)'\n                  }}\n                >\n                  <ExternalLink className=\"h-5 w-5 mr-2\" />\n                  {connectWhoopMutation.isPending ? 'Connecting...' : 'Connect WHOOP'}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      {/* Header */}\n      <div className=\"bg-slate-800/50 backdrop-blur-sm border-b border-slate-700\">\n        <div className=\"max-w-6xl mx-auto px-6 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-6\">\n              <FitScoreLogo size={48} />\n              <div>\n                <h1 className=\"text-2xl font-bold text-white\">FitScore Health Dashboard</h1>\n                <p className=\"text-slate-300\">Real-time WHOOP health analytics</p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center space-x-4\">\n              <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30\">\n                <div className=\"w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse\"></div>\n                Connected\n              </Badge>\n              \n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={refreshData}\n                disabled={whoopLoading || summaryLoading}\n                className=\"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white\"\n              >\n                <RefreshCw className={`h-4 w-4 mr-2 ${(whoopLoading || summaryLoading) ? 'animate-spin' : ''}`} />\n                Refresh\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-6xl mx-auto px-6 py-8\">\n        {/* Live WHOOP Summary */}\n        <div className=\"mb-12 animate-slide-up\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-4xl font-bold text-white mb-3 tracking-tight\">Hello Gustavs</h1>\n            <p className=\"text-xl text-slate-300 mb-4 font-medium\">Here are your health insights for today</p>\n            <p className=\"text-slate-400\">Live data from your WHOOP device</p>\n            {lastSync && (\n              <div className=\"flex items-center justify-center mt-2 text-sm text-slate-500\">\n                <Clock className=\"h-4 w-4 mr-1\" />\n                Last sync: {formatTime(lastSync)}\n              </div>\n            )}\n          </div>\n          \n          {whoopLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {[1, 2, 3, 4].map((i) => (\n                <Card key={i} className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm animate-pulse\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex flex-col items-center space-y-4\">\n                      <div className=\"w-20 h-20 bg-slate-700 rounded-full\"></div>\n                      <div className=\"h-4 bg-slate-700 rounded w-20\"></div>\n                      <div className=\"h-8 bg-slate-700 rounded w-16\"></div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : whoopError ? (\n            <Card className=\"bg-red-900/20 border-red-800 backdrop-blur-sm\">\n              <CardContent className=\"p-8 text-center\">\n                <AlertCircle className=\"h-12 w-12 text-red-400 mx-auto mb-4\" />\n                <h3 className=\"text-xl font-semibold text-red-400 mb-2\">Failed to load WHOOP data</h3>\n                <p className=\"text-red-300 mb-4\">Unable to fetch your latest health metrics</p>\n                <Button \n                  onClick={() => refetchWhoop()}\n                  className=\"bg-red-600 hover:bg-red-700 text-white\"\n                >\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Try Again\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {/* Recovery Score - Navy Blue Theme */}\n              <Card className=\"bg-gradient-to-br from-slate-800/80 to-slate-900/80 border-slate-700/50 backdrop-blur-md hover:from-slate-700/80 hover:to-slate-800/80 transition-all duration-300 transform hover:scale-105 animate-fade-in shadow-xl\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex flex-col items-center space-y-4\">\n                    <CircularProgress \n                      value={whoopData?.recovery_score || 0} \n                      color=\"#3b82f6\"\n                      size={100}\n                    />\n                    <div className=\"text-center\">\n                      <div className=\"flex items-center justify-center space-x-2 mb-1\">\n                        <Heart className=\"h-4 w-4 text-blue-400\" />\n                        <span className=\"text-sm font-medium text-slate-300\">Recovery</span>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Strain Score - Orange/Red Theme */}\n              <Card className=\"bg-gradient-to-br from-slate-800/80 to-slate-900/80 border-slate-700/50 backdrop-blur-md hover:from-slate-700/80 hover:to-slate-800/80 transition-all duration-300 transform hover:scale-105 animate-fade-in shadow-xl\" style={{ animationDelay: '0.1s' }}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex flex-col items-center space-y-4\">\n                    <div className=\"w-20 h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center shadow-lg\">\n                      <Zap className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"flex items-center justify-center space-x-2 mb-1\">\n                        <Zap className=\"h-4 w-4 text-orange-400\" />\n                        <span className=\"text-sm font-medium text-slate-300\">Strain</span>\n                      </div>\n                      <div className=\"text-2xl font-bold text-orange-400\">\n                        <CountUp end={whoopData?.strain || 0} decimals={1} duration={1200} />\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Sleep Score - Purple Theme */}\n              <Card className=\"bg-gradient-to-br from-slate-800/80 to-slate-900/80 border-slate-700/50 backdrop-blur-md hover:from-slate-700/80 hover:to-slate-800/80 transition-all duration-300 transform hover:scale-105 animate-fade-in shadow-xl\" style={{ animationDelay: '0.2s' }}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex flex-col items-center space-y-4\">\n                    <div className=\"w-20 h-20 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-full flex items-center justify-center shadow-lg\">\n                      <Moon className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"flex items-center justify-center space-x-2 mb-1\">\n                        <Moon className=\"h-4 w-4 text-purple-400\" />\n                        <span className=\"text-sm font-medium text-slate-300\">Sleep</span>\n                      </div>\n                      <div className=\"text-xl font-bold text-purple-400\">\n                        {whoopData?.sleep_score ? (\n                          <CountUp end={whoopData.sleep_score} suffix=\"%\" duration={1200} />\n                        ) : (\n                          <span className=\"text-slate-400\">No sleep data yet</span>\n                        )}\n                      </div>\n                      {!whoopData?.sleep_score && (\n                        <div className=\"text-xs text-slate-500 mt-1 max-w-24 text-center leading-tight\">\n                          WHOOP processes sleep after wake\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* HRV - Green Theme */}\n              <Card className=\"bg-gradient-to-br from-slate-800/80 to-slate-900/80 border-slate-700/50 backdrop-blur-md hover:from-slate-700/80 hover:to-slate-800/80 transition-all duration-300 transform hover:scale-105 animate-fade-in shadow-xl\" style={{ animationDelay: '0.3s' }}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex flex-col items-center space-y-4\">\n                    <div className=\"w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center shadow-lg\">\n                      <Activity className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"flex items-center justify-center space-x-2 mb-1\">\n                        <Activity className=\"h-4 w-4 text-green-400\" />\n                        <span className=\"text-sm font-medium text-slate-300\">HRV</span>\n                      </div>\n                      <div className=\"text-2xl font-bold text-green-400\">\n                        {whoopData?.hrv ? (\n                          <CountUp end={whoopData.hrv} suffix=\" ms\" decimals={1} duration={1200} />\n                        ) : (\n                          <span className=\"text-slate-500\">N/A</span>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </div>\n\n        {/* Weekly Averages */}\n        <div className=\"animate-slide-up\" style={{ animationDelay: '0.3s' }}>\n          <div className=\"text-center mb-8\">\n            <h2 className=\"text-3xl font-bold text-white mb-2 flex items-center justify-center\">\n              <TrendingUp className=\"h-8 w-8 mr-3 text-blue-400\" />\n              Weekly Averages\n            </h2>\n            <p className=\"text-slate-400\">Averages based on real WHOOP data</p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {/* Avg Recovery - Navy */}\n              <Card \n                className=\"gradient-recovery border-0 backdrop-blur-sm transition-all duration-300 transform hover:scale-102 cursor-pointer shadow-lg animate-fade-in rounded-2xl\"\n                style={{ \n                  boxShadow: 'inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 20px rgba(30, 58, 138, 0.3)'\n                }}\n              >\n                <CardContent className=\"p-6 relative\">\n                  <div className=\"flex items-center space-x-3 mb-3\">\n                    <Heart className=\"h-5 w-5 text-white drop-shadow-sm\" />\n                    <span className=\"text-sm font-medium text-white/95 drop-shadow-sm\">Avg Recovery</span>\n                  </div>\n                  <div className=\"text-3xl font-bold text-white drop-shadow-md\">\n                    {whoopSummary?.avgRecovery !== null && whoopSummary?.avgRecovery !== undefined ? (\n                      <CountUp end={whoopSummary.avgRecovery} suffix=\"%\" duration={1500} />\n                    ) : (\n                      <span className=\"text-white/80\">N/A</span>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Avg Strain - Crimson */}\n              <Card \n                className=\"gradient-strain border-0 backdrop-blur-sm transition-all duration-300 transform hover:scale-102 cursor-pointer shadow-lg animate-fade-in rounded-2xl\"\n                style={{ \n                  boxShadow: 'inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 20px rgba(185, 28, 28, 0.3)',\n                  animationDelay: '0.1s'\n                }}\n              >\n                <CardContent className=\"p-6 relative\">\n                  <div className=\"flex items-center space-x-3 mb-3\">\n                    <Zap className=\"h-5 w-5 text-white drop-shadow-sm\" />\n                    <span className=\"text-sm font-medium text-white/95 drop-shadow-sm\">Avg Strain</span>\n                  </div>\n                  <div className=\"text-3xl font-bold text-white drop-shadow-md\">\n                    {whoopSummary?.avgStrain !== null && whoopSummary?.avgStrain !== undefined ? (\n                      <CountUp end={whoopSummary.avgStrain} decimals={1} duration={1500} />\n                    ) : (\n                      <span className=\"text-white/80\">N/A</span>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Avg Sleep - Purple */}\n              <Card \n                className=\"gradient-sleep border-0 backdrop-blur-sm transition-all duration-300 transform hover:scale-102 cursor-pointer shadow-lg animate-fade-in rounded-2xl\"\n                style={{ \n                  boxShadow: 'inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 20px rgba(109, 40, 217, 0.3)',\n                  animationDelay: '0.2s'\n                }}\n              >\n                <CardContent className=\"p-6 relative\">\n                  <div className=\"flex items-center space-x-3 mb-3\">\n                    <Moon className=\"h-5 w-5 text-white drop-shadow-sm\" />\n                    <span className=\"text-sm font-medium text-white/95 drop-shadow-sm\">Avg Sleep</span>\n                  </div>\n                  <div className=\"text-3xl font-bold text-white drop-shadow-md\">\n                    {whoopSummary?.avgSleep !== null && whoopSummary?.avgSleep !== undefined ? (\n                      <CountUp end={whoopSummary.avgSleep} suffix=\"%\" duration={1500} />\n                    ) : (\n                      <span className=\"text-white/80\">N/A</span>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Avg HRV - Emerald */}\n              <Card \n                className=\"gradient-hrv border-0 backdrop-blur-sm transition-all duration-300 transform hover:scale-102 cursor-pointer shadow-lg animate-fade-in rounded-2xl\"\n                style={{ \n                  boxShadow: 'inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 4px 20px rgba(4, 120, 87, 0.3)',\n                  animationDelay: '0.3s'\n                }}\n              >\n                <CardContent className=\"p-6 relative\">\n                  <div className=\"flex items-center space-x-3 mb-3\">\n                    <Activity className=\"h-5 w-5 text-white drop-shadow-sm\" />\n                    <span className=\"text-sm font-medium text-white/95 drop-shadow-sm\">Avg HRV</span>\n                  </div>\n                  <div className=\"text-3xl font-bold text-white drop-shadow-md\">\n                    {whoopSummary?.avgHRV !== null && whoopSummary?.avgHRV !== undefined ? (\n                      <CountUp end={whoopSummary.avgHRV} suffix=\" ms\" decimals={1} duration={1500} />\n                    ) : (\n                      <span className=\"text-white/80\">N/A</span>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          \n          <div className=\"text-center mt-6\">\n            <p className=\"text-sm text-slate-500\">\n              Averages calculated from the past 7 days of real WHOOP data\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":23137},"client/src/pages/dashboard.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Heart, Zap, Moon, Activity, Clock, ExternalLink, TrendingUp, RefreshCw, RotateCcw, Calendar, Wind, User, LogOut, Crown } from 'lucide-react';\nimport { HealthIcon } from '@/components/HealthIcon';\nimport { formatTime } from '@/lib/utils';\nimport { WhoopTodayResponse } from '@shared/schema';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useAuth } from '@/hooks/useAuth';\nimport { Link } from 'wouter';\n\ninterface WhoopAuthStatus {\n  authenticated: boolean;\n  message: string;\n  auth_url?: string;\n  expires_at?: number;\n}\n\ninterface WhoopSummary {\n  avgRecovery: number | null;\n  avgStrain: number | null;\n  avgSleep: number | null;\n  avgHRV: number | null;\n}\n\ninterface CountUpProps {\n  end: number;\n  duration?: number;\n  suffix?: string;\n  decimals?: number;\n}\n\nfunction CountUp({ end, duration = 1000, suffix = \"\", decimals = 0 }: CountUpProps) {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    let startTime: number;\n    let animationFrame: number;\n\n    const animate = (currentTime: number) => {\n      if (!startTime) startTime = currentTime;\n      const progress = Math.min((currentTime - startTime) / duration, 1);\n      \n      const easeOut = 1 - Math.pow(1 - progress, 3);\n      setCount(end * easeOut);\n\n      if (progress < 1) {\n        animationFrame = requestAnimationFrame(animate);\n      }\n    };\n\n    animationFrame = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(animationFrame);\n  }, [end, duration]);\n\n  return (\n    <span>\n      {decimals > 0 ? count.toFixed(decimals) : Math.floor(count)}{suffix}\n    </span>\n  );\n}\n\nfunction CircularProgress({ value, max = 100, size = 120, strokeWidth = 8, color = \"#3b82f6\" }: {\n  value: number;\n  max?: number;\n  size?: number;\n  strokeWidth?: number;\n  color?: string;\n}) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = 2 * Math.PI * radius;\n  const percentage = (value / max) * 100;\n  const strokeDashoffset = circumference - (percentage / 100) * circumference;\n\n  return (\n    <div className=\"relative inline-flex items-center justify-center\">\n      <svg width={size} height={size} className=\"transform -rotate-90\">\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          stroke=\"currentColor\"\n          strokeWidth={strokeWidth}\n          fill=\"none\"\n          className=\"text-slate-700\"\n        />\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          stroke={color}\n          strokeWidth={strokeWidth}\n          fill=\"none\"\n          strokeDasharray={circumference}\n          strokeDashoffset={strokeDashoffset}\n          className=\"transition-all duration-1000 ease-out drop-shadow-sm\"\n          style={{\n            filter: `drop-shadow(0 0 8px ${color}40)`\n          }}\n        />\n      </svg>\n      <div className=\"absolute inset-0 flex items-center justify-center\">\n        <span className=\"text-2xl font-bold text-white\">\n          <CountUp end={value} suffix=\"%\" duration={1200} />\n        </span>\n      </div>\n    </div>\n  );\n}\n\nfunction FitScoreLogo({ className = \"\", size = 64 }: { className?: string; size?: number }) {\n  return (\n    <div className={`relative flex items-center justify-center ${className}`} style={{ width: size, height: size }}>\n      <svg \n        width={size} \n        height={size} \n        viewBox=\"0 0 100 100\" \n        fill=\"none\" \n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"drop-shadow-lg\"\n      >\n        <defs>\n          <linearGradient id=\"logoGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"#06B6D4\" />\n            <stop offset=\"30%\" stopColor=\"#3B82F6\" />\n            <stop offset=\"70%\" stopColor=\"#8B5CF6\" />\n            <stop offset=\"100%\" stopColor=\"#D946EF\" />\n          </linearGradient>\n          <filter id=\"logoGlow\">\n            <feGaussianBlur stdDeviation=\"3\" result=\"coloredBlur\"/>\n            <feMerge> \n              <feMergeNode in=\"coloredBlur\"/>\n              <feMergeNode in=\"SourceGraphic\"/>\n            </feMerge>\n          </filter>\n        </defs>\n        \n        {/* Background circle with gradient fill matching the page background */}\n        <circle \n          cx=\"50\" \n          cy=\"50\" \n          r=\"48\" \n          fill=\"rgba(30, 41, 59, 0.8)\"\n          stroke=\"url(#logoGradient)\"\n          strokeWidth=\"1\"\n          filter=\"url(#logoGlow)\"\n        />\n        \n        {/* Outer ring - dashed circle */}\n        <circle\n          cx=\"50\"\n          cy=\"50\"\n          r=\"40\"\n          fill=\"none\"\n          stroke=\"url(#logoGradient)\"\n          strokeWidth=\"2.5\"\n          strokeLinecap=\"round\"\n          strokeDasharray=\"120 15\"\n          opacity=\"0.9\"\n        />\n        \n        {/* Heartbeat line */}\n        <path\n          d=\"M15 50 L20 50 L25 35 L30 65 L35 20 L40 80 L45 50 L50 40 L55 60 L60 50 L65 45 L70 55 L75 50 L85 50\"\n          fill=\"none\"\n          stroke=\"url(#logoGradient)\"\n          strokeWidth=\"2.8\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          opacity=\"0.95\"\n        />\n        \n        {/* Center pulse dot */}\n        <circle\n          cx=\"50\"\n          cy=\"50\"\n          r=\"2.5\"\n          fill=\"url(#logoGradient)\"\n          opacity=\"1\"\n        >\n          <animate\n            attributeName=\"r\"\n            values=\"2.5;4;2.5\"\n            dur=\"2s\"\n            repeatCount=\"indefinite\"\n          />\n          <animate\n            attributeName=\"opacity\"\n            values=\"1;0.6;1\"\n            dur=\"2s\"\n            repeatCount=\"indefinite\"\n          />\n        </circle>\n      </svg>\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const { user, logout, isLoggingOut } = useAuth();\n  const [lastSync, setLastSync] = useState<Date | null>(null);\n  \n  // Since we're using JWT authentication, if user is authenticated, they can access WHOOP data\n  const { data: whoopData, isLoading: whoopLoading, refetch: refetchWhoop, error: whoopError } = useQuery<WhoopTodayResponse>({\n    queryKey: ['/api/whoop/today'],\n    enabled: !!user, // Enable if user is JWT authenticated\n    retry: (failureCount, error: any) => {\n      if (error?.response?.status === 401) {\n        console.log('[DASHBOARD] WHOOP authentication expired, user needs to reconnect');\n        // Force refresh auth status when 401 error occurs\n        queryClient.invalidateQueries({ queryKey: ['/api/auth/me'] });\n        return false;\n      }\n      return failureCount < 3;\n    },\n    refetchInterval: user ? 5 * 60 * 1000 : false, // Auto-refresh every 5 minutes if authenticated\n  });\n\n  // Set last sync when data changes\n  useEffect(() => {\n    if (whoopData) {\n      setLastSync(new Date());\n    }\n  }, [whoopData]);\n\n  const { data: whoopSummary, isLoading: summaryLoading } = useQuery<WhoopSummary>({\n    queryKey: ['/api/whoop/weekly'],\n    enabled: !!user, // Enable if user is JWT authenticated\n    retry: 3,\n    refetchInterval: 10 * 60 * 1000, // Refresh every 10 minutes\n  });\n\n  // Connect to WHOOP OAuth mutation\n  const connectWhoopMutation = useMutation({\n    mutationFn: async () => {\n      // Open WHOOP OAuth in new window\n      window.open('/api/whoop/login', '_blank', 'width=600,height=700');\n      return Promise.resolve();\n    },\n    onSuccess: () => {\n      console.log('WHOOP OAuth window opened');\n      // Refresh user data after a delay to check for new token\n      setTimeout(() => {\n        queryClient.invalidateQueries({ queryKey: ['/api/auth/me'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/whoop/today'] });\n      }, 2000);\n    },\n  });\n\n  // For JWT auth, user is connected if they have a valid token (whoopData may be loading)\n  const isWhoopConnected = !!user;\n  const isLoading = whoopLoading;\n  const hasError = whoopError;\n\n  // Debug logging to understand why data isn't showing\n  useEffect(() => {\n    console.log('[DASHBOARD DEBUG] User:', user);\n    console.log('[DASHBOARD DEBUG] WHOOP Data:', whoopData);\n    console.log('[DASHBOARD DEBUG] Loading:', whoopLoading);\n    console.log('[DASHBOARD DEBUG] Error:', whoopError);\n    console.log('[DASHBOARD DEBUG] Token in localStorage:', localStorage.getItem('auth_token'));\n  }, [user, whoopData, whoopLoading, whoopError]);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6 lg:py-8\">\n        {/* Header */}\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 sm:mb-8 lg:mb-12 space-y-4 sm:space-y-0\">\n          <div className=\"flex items-center space-x-3 sm:space-x-4\">\n            <div className=\"flex-shrink-0\">\n              <FitScoreLogo size={40} className=\"sm:w-12 sm:h-12\" />\n            </div>\n            <div className=\"min-w-0\">\n              <h1 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-white\">FitScore Health Dashboard</h1>\n              <p className=\"text-slate-400 text-xs sm:text-sm lg:text-base hidden sm:block\">Real-time WHOOP health analytics</p>\n              <p className=\"text-slate-400 text-xs sm:hidden\">WHOOP Analytics</p>\n            </div>\n          </div>\n          \n          <div className=\"flex flex-row items-center justify-center lg:justify-end space-x-2 sm:space-x-3\">\n            {/* Navigation Buttons */}\n            <Link href=\"/calendar\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"relative overflow-hidden border-transparent bg-gradient-to-r from-emerald-500 to-teal-600 text-white hover:from-emerald-600 hover:to-teal-700\"\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-r from-emerald-400 to-teal-500 opacity-30 animate-pulse\"></div>\n                <div className=\"relative flex items-center space-x-2\">\n                  <Calendar className=\"h-4 w-4\" />\n                  <span className=\"text-xs sm:text-sm font-medium hidden sm:inline\">Calendar</span>\n                </div>\n              </Button>\n            </Link>\n            \n            <Link href=\"/profile\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"relative overflow-hidden border-transparent bg-gradient-to-r from-purple-500 to-indigo-600 text-white hover:from-purple-600 hover:to-indigo-700\"\n              >\n                <div className=\"absolute inset-0 bg-gradient-to-r from-purple-400 to-indigo-500 opacity-30 animate-pulse\"></div>\n                <div className=\"relative flex items-center space-x-2\">\n                  <User className=\"h-4 w-4\" />\n                  <span className=\"text-xs sm:text-sm font-medium hidden sm:inline\">Profile</span>\n                </div>\n              </Button>\n            </Link>\n            \n\n            \n            {/* Admin Panel - Only for admin users */}\n            {user?.role === 'admin' && (\n              <Link href=\"/admin\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"relative overflow-hidden border-transparent bg-gradient-to-r from-orange-500 to-red-600 text-white hover:from-orange-600 hover:to-red-700\"\n                >\n                  <div className=\"absolute inset-0 bg-gradient-to-r from-orange-400 to-red-500 opacity-30 animate-pulse\"></div>\n                  <div className=\"relative flex items-center space-x-2\">\n                    <Crown className=\"h-4 w-4\" />\n                    <span className=\"text-xs sm:text-sm font-medium hidden sm:inline\">Admin</span>\n                  </div>\n                </Button>\n              </Link>\n            )}\n            \n            {/* Logout Button */}\n            <Button\n              onClick={() => logout()}\n              variant=\"outline\"\n              size=\"sm\"\n              disabled={isLoggingOut}\n              className=\"relative overflow-hidden border-transparent bg-gradient-to-r from-red-500 to-pink-600 text-white hover:from-red-600 hover:to-pink-700\"\n            >\n              <div className=\"absolute inset-0 bg-gradient-to-r from-red-400 to-pink-500 opacity-30 animate-pulse\"></div>\n              <div className=\"relative flex items-center space-x-2\">\n                {isLoggingOut ? (\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <LogOut className=\"h-4 w-4\" />\n                )}\n                <span className=\"text-xs sm:text-sm font-medium hidden sm:inline\">\n                  {isLoggingOut ? 'Logging out...' : 'Logout'}\n                </span>\n              </div>\n            </Button>\n          </div>\n        </div>\n\n        {/* Today's Health Metrics */}\n        <div className=\"text-center mb-6 sm:mb-8 lg:mb-12\">\n          <h2 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mb-2\">Today's Health Metrics</h2>\n          <p className=\"text-slate-400 text-sm sm:text-base lg:text-lg\">Live data from your WHOOP device</p>\n          {lastSync && (\n            <div className=\"flex items-center justify-center mt-3 sm:mt-4 text-xs sm:text-sm text-slate-500\">\n              <Clock className=\"h-3 w-3 sm:h-4 sm:w-4 mr-2\" />\n              <span>Last sync: {formatTime(lastSync)}</span>\n            </div>\n          )}\n        </div>\n\n        {/* Authentication Status */}\n        {!isWhoopConnected && !isLoading && (\n          <div className=\"max-w-2xl mx-auto mb-6 sm:mb-8\">\n            <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n              <CardContent className=\"p-4 sm:p-6 text-center\">\n                <div className=\"flex justify-center mb-4\">\n                  <FitScoreLogo size={64} />\n                </div>\n                <h3 className=\"text-xl font-semibold text-white mb-2\">Connect Your WHOOP</h3>\n                <p className=\"text-slate-400 mb-4\">\n                  Connect your WHOOP account to view real-time health metrics and analytics.\n                </p>\n                <Button \n                  onClick={() => connectWhoopMutation.mutate()}\n                  className=\"bg-gradient-to-r from-[#00D4FF] to-[#0099FF] hover:from-[#00C4EF] hover:to-[#0089EF] text-white shadow-[0_0_20px_rgba(0,212,255,0.3)] hover:shadow-[0_0_25px_rgba(0,212,255,0.4)] transition-all duration-200\"\n                  disabled={connectWhoopMutation.isPending}\n                >\n                  {connectWhoopMutation.isPending ? (\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-4 h-4 border-2 border-[#00D4FF]/30 border-t-[#00D4FF] rounded-full animate-spin shadow-[0_0_10px_rgba(0,212,255,0.5)]\"></div>\n                      <span>Connecting...</span>\n                    </div>\n                  ) : (\n                    <>\n                      <ExternalLink className=\"h-4 w-4 mr-2\" />\n                      Connect WHOOP\n                    </>\n                  )}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Connection Controls - Show when connected */}\n        {isWhoopConnected && (\n          <div className=\"max-w-2xl mx-auto mb-6 sm:mb-8\">\n            <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n              <CardContent className=\"p-3 sm:p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                    <span className=\"text-slate-300 font-medium text-sm\">WHOOP Connected</span>\n                  </div>\n                  <div className=\"flex space-x-2\">\n                    <Button\n                      onClick={() => connectWhoopMutation.mutate()}\n                      disabled={connectWhoopMutation.isPending}\n                      variant=\"outline\"\n                      size=\"sm\"  \n                      className=\"bg-transparent border-0 bg-gradient-to-r from-[#00D4FF] to-[#0099FF] text-white hover:from-[#00C4EF] hover:to-[#0089EF] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-cyan-400/50 shadow-[0_0_20px_rgba(0,212,255,0.3)]\"\n                    >\n                      {connectWhoopMutation.isPending ? (\n                        <>\n                          <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Reconnecting...\n                        </>\n                      ) : (\n                        <>\n                          <RotateCcw className=\"w-4 h-4 mr-2\" />\n                          Reconnect\n                        </>\n                      )}\n                    </Button>\n                    <Button\n                      onClick={() => {\n                        refetchWhoop();\n                        window.location.reload();\n                      }}\n                      disabled={whoopLoading}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"bg-transparent border-2 border-[#00D4FF] text-[#00D4FF] hover:bg-gradient-to-r hover:from-[#00D4FF] hover:to-[#0099FF] hover:text-white hover:border-transparent transition-all duration-200 hover:shadow-[0_0_20px_rgba(0,212,255,0.3)]\"\n                    >\n                      {whoopLoading ? (\n                        <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                      ) : (\n                        <RefreshCw className=\"w-4 h-4\" />\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Main Metrics Cards */}\n        {isWhoopConnected && (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8 sm:mb-12 lg:mb-16\">\n          {/* Sleep Score Card */}\n          <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n            <CardContent className=\"p-4 sm:p-6 text-center\">\n              <div className=\"mb-3 sm:mb-4\">\n                <div className=\"w-12 h-12 sm:w-16 sm:h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-2 sm:mb-3\">\n                  <Moon className=\"h-6 w-6 sm:h-8 sm:w-8 text-white\" />\n                </div>\n                <div className=\"text-2xl font-bold text-purple-400\">\n                  {whoopLoading ? (\n                    <span className=\"text-slate-400\">Syncing...</span>\n                  ) : whoopData?.sleep_score !== null && whoopData?.sleep_score !== undefined ? (\n                    <><CountUp end={Math.min(whoopData.sleep_score, 100)} duration={1200} />%</>\n                  ) : (\n                    <span className=\"text-slate-500\">N/A</span>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center justify-center space-x-2\">\n                <Moon className=\"h-4 w-4 sm:h-5 sm:w-5 text-purple-400\" />\n                <span className=\"text-slate-300 font-medium text-sm sm:text-base\">Sleep Score</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Recovery Card */}\n          <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n            <CardContent className=\"p-4 sm:p-6 text-center\">\n              <div className=\"mb-3 sm:mb-4\">\n                <div className=\"w-12 h-12 sm:w-16 sm:h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2 sm:mb-3\">\n                  <Heart className=\"h-6 w-6 sm:h-8 sm:w-8 text-white\" />\n                </div>\n                <div className=\"text-2xl font-bold text-blue-400\">\n                  {whoopLoading ? (\n                    <span className=\"text-slate-400\">Syncing...</span>\n                  ) : whoopData?.recovery_score !== null && whoopData?.recovery_score !== undefined ? (\n                    <><CountUp end={whoopData.recovery_score} duration={1200} />%</>\n                  ) : (\n                    <span className=\"text-slate-500\">N/A</span>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center justify-center space-x-2\">\n                <Heart className=\"h-4 w-4 sm:h-5 sm:w-5 text-blue-400\" />\n                <span className=\"text-slate-300 font-medium text-sm sm:text-base\">Recovery</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Strain Card */}\n          <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n            <CardContent className=\"p-6 text-center\">\n              <div className=\"mb-4\">\n                <div className=\"w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-3\">\n                  <Zap className=\"h-8 w-8 text-white\" />\n                </div>\n                <div className=\"text-2xl font-bold text-orange-400\">\n                  {whoopLoading ? (\n                    <span className=\"text-slate-400\">Syncing...</span>\n                  ) : whoopData?.strain !== null && whoopData?.strain !== undefined ? (\n                    <CountUp end={whoopData.strain} decimals={1} duration={1200} />\n                  ) : (\n                    <span className=\"text-slate-500\">N/A</span>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center justify-center space-x-2\">\n                <Zap className=\"h-5 w-5 text-orange-400\" />\n                <span className=\"text-slate-300 font-medium\">Strain</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* HRV Card */}\n          <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n            <CardContent className=\"p-4 sm:p-6 text-center\">\n              <div className=\"mb-3 sm:mb-4\">\n                <div className=\"w-12 h-12 sm:w-16 sm:h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2 sm:mb-3\">\n                  <Activity className=\"h-6 w-6 sm:h-8 sm:w-8 text-white\" />\n                </div>\n                <div className=\"text-2xl font-bold text-red-400\">\n                  {whoopLoading ? (\n                    <span className=\"text-slate-400\">Syncing...</span>\n                  ) : whoopData?.hrv !== null && whoopData?.hrv !== undefined ? (\n                    <><CountUp end={whoopData.hrv} duration={1200} /> ms</>\n                  ) : (\n                    <span className=\"text-slate-500\">N/A</span>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center justify-center space-x-2\">\n                <Activity className=\"h-4 w-4 sm:h-5 sm:w-5 text-red-400\" />\n                <span className=\"text-slate-300 font-medium text-sm sm:text-base\">HRV</span>\n              </div>\n            </CardContent>\n          </Card>\n          </div>\n        )}\n\n        {/* Weekly Averages Section */}\n        {isWhoopConnected && whoopSummary && (\n          <div className=\"mt-16\">\n            <div className=\"text-center mb-8\">\n              <h2 className=\"text-3xl font-bold text-white mb-2 flex items-center justify-center\">\n                <TrendingUp className=\"h-8 w-8 mr-3 text-cyan-400\" />\n                Weekly Averages\n              </h2>\n              <p className=\"text-slate-400\">7-day trends and performance insights</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8\">\n              {/* Weekly Sleep Average */}\n              <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"mb-4\">\n                    <div className=\"w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-3\">\n                      <Moon className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-purple-400\">\n                      {summaryLoading ? (\n                        <span className=\"text-slate-400\">Loading...</span>\n                      ) : whoopSummary?.avgSleep !== null && whoopSummary?.avgSleep !== undefined ? (\n                        <><CountUp end={whoopSummary.avgSleep} decimals={1} duration={1200} />%</>\n                      ) : (\n                        <span className=\"text-slate-500\">N/A</span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <Moon className=\"h-5 w-5 text-purple-400\" />\n                    <span className=\"text-slate-300 font-medium\">Avg Sleep</span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Weekly Recovery Average */}\n              <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"mb-4\">\n                    <div className=\"w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-3\">\n                      <Heart className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-blue-400\">\n                      {summaryLoading ? (\n                        <span className=\"text-slate-400\">Loading...</span>\n                      ) : whoopSummary?.avgRecovery !== null && whoopSummary?.avgRecovery !== undefined ? (\n                        <><CountUp end={whoopSummary.avgRecovery} decimals={1} duration={1200} />%</>\n                      ) : (\n                        <span className=\"text-slate-500\">N/A</span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <Heart className=\"h-5 w-5 text-blue-400\" />\n                    <span className=\"text-slate-300 font-medium\">Avg Recovery</span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Weekly Strain Average */}\n              <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"mb-4\">\n                    <div className=\"w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-3\">\n                      <Zap className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-orange-400\">\n                      {summaryLoading ? (\n                        <span className=\"text-slate-400\">Loading...</span>\n                      ) : whoopSummary?.avgStrain !== null && whoopSummary?.avgStrain !== undefined ? (\n                        <CountUp end={whoopSummary.avgStrain} decimals={1} duration={1200} />\n                      ) : (\n                        <span className=\"text-slate-500\">N/A</span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <Zap className=\"h-5 w-5 text-orange-400\" />\n                    <span className=\"text-slate-300 font-medium\">Avg Strain</span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Weekly HRV Average */}\n              <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"mb-4\">\n                    <div className=\"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-3\">\n                      <Activity className=\"h-8 w-8 text-white\" />\n                    </div>\n                    <div className=\"text-2xl font-bold text-red-400\">\n                      {summaryLoading ? (\n                        <span className=\"text-slate-400\">Loading...</span>\n                      ) : whoopSummary?.avgHRV !== null && whoopSummary?.avgHRV !== undefined ? (\n                        <><CountUp end={whoopSummary.avgHRV} decimals={1} duration={1200} /> ms</>\n                      ) : (\n                        <span className=\"text-slate-500\">N/A</span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <Activity className=\"h-5 w-5 text-red-400\" />\n                    <span className=\"text-slate-300 font-medium\">Avg HRV</span>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        )}\n\n        {/* Additional Health Insights */}\n        {isWhoopConnected && whoopData && (\n          <div className=\"mt-16\">\n            <div className=\"text-center mb-8\">\n              <h2 className=\"text-3xl font-bold text-white mb-2 flex items-center justify-center\">\n                <TrendingUp className=\"h-8 w-8 mr-3 text-cyan-400\" />\n                Other Insights from Today\n              </h2>\n              <p className=\"text-slate-400\">Detailed physiological metrics and sleep analytics</p>\n            </div>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8\">\n              {/* Sleep Hours */}\n              <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center space-x-3 mb-4\">\n                    <div className=\"w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center\">\n                      <Clock className=\"h-6 w-6 text-white\" />\n                    </div>\n                    <div>\n                      <p className=\"text-slate-400 text-sm\">\n                        {whoopData.sleep_hours ? \"Sleep Hours\" : \"Time in Bed\"}\n                      </p>\n                      <p className=\"text-2xl font-bold text-purple-400\">\n                        {whoopData.sleep_hours ? (\n                          <><CountUp end={whoopData.sleep_hours} decimals={1} duration={1000} /> hrs</>\n                        ) : whoopData.time_in_bed_hours ? (\n                          <><CountUp end={whoopData.time_in_bed_hours} decimals={1} duration={1000} /> hrs</>\n                        ) : (\n                          <span className=\"text-slate-500\">N/A</span>\n                        )}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-xs text-slate-500\">\n                    {whoopData.sleep_hours ? \"Time actually asleep\" : whoopData.time_in_bed_hours ? \"Total time spent in bed\" : \"Sleep data not available\"}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Resting Heart Rate */}\n              {whoopData.resting_heart_rate && (\n                <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center space-x-3 mb-4\">\n                      <div className=\"w-12 h-12 bg-red-500 rounded-full flex items-center justify-center\">\n                        <Heart className=\"h-6 w-6 text-white\" />\n                      </div>\n                      <div>\n                        <p className=\"text-slate-400 text-sm\">Resting Heart Rate</p>\n                        <p className=\"text-2xl font-bold text-red-400\">\n                          <CountUp end={whoopData.resting_heart_rate} duration={1000} /> bpm\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-slate-500\">\n                      Your heart rate during rest periods\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n\n\n              {/* Sleep Efficiency */}\n              {whoopData.sleep_efficiency_pct && (\n                <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center space-x-3 mb-4\">\n                      <div className=\"w-12 h-12 bg-teal-500 rounded-full flex items-center justify-center\">\n                        <Activity className=\"h-6 w-6 text-white\" />\n                      </div>\n                      <div>\n                        <p className=\"text-slate-400 text-sm\">Sleep Efficiency</p>\n                        <p className=\"text-2xl font-bold text-teal-400\">\n                          <CountUp end={whoopData.sleep_efficiency_pct} duration={1000} />%\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-slate-500\">\n                      Time asleep vs. time in bed\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Respiratory Rate */}\n              {whoopData.raw?.sleep?.score?.respiratory_rate && (\n                <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center space-x-3 mb-4\">\n                      <div className=\"w-12 h-12 bg-cyan-500 rounded-full flex items-center justify-center\">\n                        <Wind className=\"h-6 w-6 text-white\" />\n                      </div>\n                      <div>\n                        <p className=\"text-slate-400 text-sm\">Respiratory Rate</p>\n                        <p className=\"text-2xl font-bold text-cyan-400\">\n                          <CountUp end={whoopData.raw.sleep.score.respiratory_rate} decimals={1} duration={1000} /> bpm\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-slate-500\">\n                      Breaths per minute during sleep\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Sleep Consistency */}\n              {whoopData.raw?.sleep?.score?.sleep_consistency_percentage && (\n                <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center space-x-3 mb-4\">\n                      <div className=\"w-12 h-12 bg-violet-500 rounded-full flex items-center justify-center\">\n                        <Clock className=\"h-6 w-6 text-white\" />\n                      </div>\n                      <div>\n                        <p className=\"text-slate-400 text-sm\">Sleep Consistency</p>\n                        <p className=\"text-2xl font-bold text-violet-400\">\n                          <CountUp end={whoopData.raw.sleep.score.sleep_consistency_percentage} duration={1000} />%\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-slate-500\">\n                      Consistency of sleep schedule\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Sleep Cycles */}\n              {whoopData.raw?.sleep?.score?.stage_summary?.sleep_cycle_count && (\n                <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all duration-300\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center space-x-3 mb-4\">\n                      <div className=\"w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center\">\n                        <RotateCcw className=\"h-6 w-6 text-white\" />\n                      </div>\n                      <div>\n                        <p className=\"text-slate-400 text-sm\">Sleep Cycles</p>\n                        <p className=\"text-2xl font-bold text-amber-400\">\n                          <CountUp end={whoopData.raw.sleep.score.stage_summary.sleep_cycle_count} duration={1000} />\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-xs text-slate-500\">\n                      Complete sleep cycles completed\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n\n\n\n            </div>\n\n            {/* Sleep Stages Breakdown */}\n            {whoopData.sleep_stages && (\n              <Card className=\"bg-slate-800/50 border-slate-700/50 backdrop-blur-sm\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center space-x-3 mb-6\">\n                    <div className=\"w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center\">\n                      <Moon className=\"h-6 w-6 text-white\" />\n                    </div>\n                    <div>\n                      <h3 className=\"text-xl font-bold text-white\">Sleep Stages Breakdown</h3>\n                      <p className=\"text-slate-400 text-sm\">Time spent in each sleep stage</p>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                    {/* Light Sleep */}\n                    <div className=\"text-center p-4 bg-slate-700/30 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-blue-400 mb-2\">\n                        <CountUp \n                          end={whoopData.sleep_stages.light_sleep_minutes || 0} \n                          duration={1000} \n                        /> min\n                      </div>\n                      <p className=\"text-slate-300 text-sm font-medium\">Light Sleep</p>\n                      <p className=\"text-xs text-slate-500\">Easy to wake from</p>\n                    </div>\n\n                    {/* Deep Sleep */}\n                    <div className=\"text-center p-4 bg-slate-700/30 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-purple-400 mb-2\">\n                        <CountUp \n                          end={whoopData.sleep_stages.deep_sleep_minutes || 0} \n                          duration={1000} \n                        /> min\n                      </div>\n                      <p className=\"text-slate-300 text-sm font-medium\">Deep Sleep</p>\n                      <p className=\"text-xs text-slate-500\">Physical recovery</p>\n                    </div>\n\n                    {/* REM Sleep */}\n                    <div className=\"text-center p-4 bg-slate-700/30 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-green-400 mb-2\">\n                        <CountUp \n                          end={whoopData.sleep_stages.rem_sleep_minutes || 0} \n                          duration={1000} \n                        /> min\n                      </div>\n                      <p className=\"text-slate-300 text-sm font-medium\">REM Sleep</p>\n                      <p className=\"text-xs text-slate-500\">Mental recovery</p>\n                    </div>\n\n                    {/* Awake Time */}\n                    <div className=\"text-center p-4 bg-slate-700/30 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-orange-400 mb-2\">\n                        <CountUp \n                          end={whoopData.sleep_stages.awake_minutes || 0} \n                          duration={1000} \n                        /> min\n                      </div>\n                      <p className=\"text-slate-300 text-sm font-medium\">Awake</p>\n                      <p className=\"text-xs text-slate-500\">Time spent awake</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":40838},"client/src/pages/login.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { HealthIcon } from '@/components/HealthIcon';\nimport { Activity, ChevronLeft } from 'lucide-react';\nimport { Link } from 'wouter';\n\nexport default function LoginPage() {\n  const handleWhoopLogin = () => {\n    window.location.href = '/api/whoop/login';\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4\">\n      {/* Back to Dashboard button */}\n      <div className=\"fixed top-4 left-4\">\n        <Link href=\"/dashboard\">\n          <Button variant=\"outline\" size=\"sm\" className=\"bg-transparent border-white/20 text-white hover:bg-white/10 hover:border-white/40 transition-all duration-200\">\n            <ChevronLeft className=\"h-4 w-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </Link>\n      </div>\n      \n      <Card className=\"w-full max-w-md bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n        <CardHeader className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <HealthIcon className=\"w-16 h-16\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold text-white\">\n            Welcome to FitScore\n          </CardTitle>\n          <CardDescription className=\"text-slate-300\">\n            Connect your WHOOP account to access your health dashboard\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"bg-slate-700/50 rounded-lg p-4 space-y-2\">\n              <Activity className=\"w-8 h-8 mx-auto text-blue-400\" />\n              <h3 className=\"text-white font-medium\">Secure WHOOP Integration</h3>\n              <p className=\"text-slate-400 text-sm\">\n                Your WHOOP data stays secure. We only access the health metrics you share.\n              </p>\n            </div>\n            \n            <Button\n              onClick={handleWhoopLogin}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white border-0 transition-all duration-200 h-12\"\n            >\n              <div className=\"flex items-center gap-3\">\n                <Activity className=\"w-5 h-5\" />\n                <span className=\"font-medium\">Connect with WHOOP</span>\n              </div>\n            </Button>\n            \n            <div className=\"text-slate-400 text-xs space-y-1\">\n              <p>By connecting, you agree to share:</p>\n              <ul className=\"text-slate-500 space-y-1\">\n                <li>‚Ä¢ Recovery & sleep data</li>\n                <li>‚Ä¢ Strain & workout metrics</li>\n                <li>‚Ä¢ Heart rate variability</li>\n              </ul>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":2908},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/profile.tsx":{"content":"import { useQuery, useMutation } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { User, Calendar, Activity, CheckCircle, AlertCircle, ExternalLink, Crown, Copy, Key, ChevronLeft, Shield, Info } from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useState } from 'react';\nimport { useToast } from '@/hooks/use-toast';\nimport SocialAuth from '@/components/social-auth';\nimport { CalendarManagement } from '@/components/calendar-management';\nimport { useAuth } from '@/hooks/useAuth';\nimport { Link } from 'wouter';\n\nfunction FitScoreLogo({ size = 64 }: { size?: number }) {\n  return (\n    <div className=\"relative flex items-center justify-center\" style={{ width: size, height: size }}>\n      <svg \n        width={size} \n        height={size} \n        viewBox=\"0 0 100 100\" \n        fill=\"none\" \n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"drop-shadow-lg\"\n      >\n        <defs>\n          <linearGradient id=\"logoGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"#06B6D4\" />\n            <stop offset=\"30%\" stopColor=\"#3B82F6\" />\n            <stop offset=\"70%\" stopColor=\"#8B5CF6\" />\n            <stop offset=\"100%\" stopColor=\"#D946EF\" />\n          </linearGradient>\n        </defs>\n        \n        {/* Background circle */}\n        <circle \n          cx=\"50\" \n          cy=\"50\" \n          r=\"48\" \n          fill=\"rgba(30, 41, 59, 0.8)\"\n          stroke=\"url(#logoGradient)\"\n          strokeWidth=\"1\"\n        />\n        \n        {/* Heartbeat line */}\n        <path\n          d=\"M15 50 L20 50 L25 35 L30 65 L35 20 L40 80 L45 50 L50 40 L55 60 L60 50 L65 45 L70 55 L75 50 L85 50\"\n          fill=\"none\"\n          stroke=\"white\"\n          strokeWidth=\"2.8\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          opacity=\"0.95\"\n        />\n        \n        {/* Center pulse dot */}\n        <circle\n          cx=\"50\"\n          cy=\"50\"\n          r=\"2.5\"\n          fill=\"white\"\n          opacity=\"1\"\n        />\n      </svg>\n    </div>\n  );\n}\n\ninterface UserProfile {\n  id: string;\n  email: string;\n  displayName?: string;\n  role?: string;\n  created_at: string;\n  updated_at: string;\n  hasWhoopToken: boolean;\n  tokenExpiry: string | null;\n}\n\ninterface WhoopAuthStatus {\n  authenticated: boolean;\n  message: string;\n  auth_url?: string;\n  expires_at?: number;\n}\n\nexport default function Profile() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  const { data: userProfile } = useQuery({\n    queryKey: ['/api/users/me'],\n    enabled: !!user,\n  });\n\n  const { data: authStatus, isLoading: authLoading } = useQuery<WhoopAuthStatus>({\n    queryKey: ['/api/whoop/status'],\n    refetchInterval: 30000,\n  });\n\n  // Fetch static JWT token for Custom GPT integration\n  const { data: staticJwtData } = useQuery({\n    queryKey: ['/api/auth/static-jwt'],\n    enabled: !!user,\n    retry: 3,\n  });\n\n  const addTokenMutation = useMutation({\n    mutationFn: async ({ userId, accessToken, refreshToken }: { userId: string, accessToken: string, refreshToken: string }) => {\n      const response = await apiRequest('POST', `/api/admin/users/${userId}/whoop-token`, {\n        accessToken,\n        refreshToken,\n        expiresAt: Math.floor(Date.now() / 1000) + 3600 * 24 // 24 hours from now\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchUsers();\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/users'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/whoop/status'] });\n    },\n  });\n\n  const authMutation = useMutation({\n    mutationFn: () => {\n      const authUrl = window.location.origin + '/api/whoop/login';\n      window.open(authUrl, 'whoop-auth', 'width=600,height=700,scrollbars=yes,resizable=yes');\n      return Promise.resolve();\n    },\n  });\n\n\n\n  // Copy JWT token to clipboard\n  const copyJwtToken = () => {\n    if (staticJwtData?.static_jwt) {\n      navigator.clipboard.writeText(staticJwtData.static_jwt);\n      toast({\n        title: \"Token Copied\",\n        description: \"JWT Bearer token copied to clipboard\",\n        variant: \"default\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 gap-4\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4\">\n            <div className=\"p-3 bg-blue-600/20 border border-blue-500/30 rounded-lg\">\n              <User className=\"h-6 w-6 text-blue-400\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">User Profile & Management</h1>\n              <p className=\"text-slate-400 text-sm sm:text-base\">Manage user accounts and WHOOP connections</p>\n            </div>\n          </div>\n          <Link href=\"/dashboard\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"bg-transparent border-2 border-[#00D4FF] text-[#00D4FF] hover:bg-gradient-to-r hover:from-[#00D4FF] hover:to-[#0099FF] hover:text-white hover:border-transparent transition-all duration-200 hover:shadow-[0_0_20px_rgba(0,212,255,0.3)]\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n        </div>\n\n        <div className=\"grid grid-cols-1 gap-8\">\n          {/* Social Authentication */}\n          <SocialAuth\n            onWhoopAuth={() => authMutation.mutate()}\n            connectedServices={{\n              whoop: authStatus?.authenticated || false\n            }}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8\">\n          {/* Current User Profile */}\n          <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-white\">\n                <User className=\"h-5 w-5\" />\n                Current User Profile\n              </CardTitle>\n              <CardDescription>Your account information and WHOOP connection</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {userProfile ? (\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 gap-4\">\n                    <div>\n                      <Label className=\"text-slate-300\">WHOOP ID</Label>\n                      <div className=\"text-white font-medium font-mono\">{userProfile.whoopId || 'Not available'}</div>\n                    </div>\n                    <div>\n                      <Label className=\"text-slate-300\">Role</Label>\n                      <div className=\"flex items-center space-x-2\">\n                        {userProfile.role === 'admin' ? (\n                          <Badge className=\"bg-gradient-to-r from-orange-500 to-red-600 text-white\">\n                            <Crown className=\"h-3 w-3 mr-1\" />\n                            Admin\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"secondary\">User</Badge>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* WHOOP Connection Status */}\n                  <div className=\"border-t border-slate-700 pt-4\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <Label className=\"text-slate-300\">WHOOP Connection</Label>\n                      <Badge variant={authStatus?.authenticated ? \"default\" : \"secondary\"}>\n                        {authStatus?.authenticated ? \"Connected\" : \"Not Connected\"}\n                      </Badge>\n                    </div>\n                    \n                    {authStatus?.authenticated ? (\n                      <Alert className=\"bg-green-600/20 border-green-500/30\">\n                        <CheckCircle className=\"h-4 w-4 text-green-400\" />\n                        <AlertDescription className=\"text-green-200\">\n                          WHOOP account is connected and ready to provide live health data.\n                        </AlertDescription>\n                      </Alert>\n                    ) : (\n                      <Alert className=\"bg-yellow-600/20 border-yellow-500/30\">\n                        <AlertCircle className=\"h-4 w-4 text-yellow-400\" />\n                        <AlertDescription className=\"text-yellow-200\">\n                          Connect your WHOOP account to access live health metrics.\n                        </AlertDescription>\n                      </Alert>\n                    )}\n\n                    {!authStatus?.authenticated && (\n                      <Button \n                        onClick={() => authMutation.mutate()}\n                        disabled={authMutation.isPending}\n                        className=\"w-full mt-4 bg-blue-600 hover:bg-blue-700\"\n                      >\n                        <ExternalLink className=\"h-4 w-4 mr-2\" />\n                        Connect WHOOP Account\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <User className=\"h-16 w-16 text-slate-500 mx-auto mb-4\" />\n                  <p className=\"text-slate-400\">No user profile found</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Custom GPT Bearer Token */}\n          {staticJwtData?.static_jwt && (\n            <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-white\">\n                  <Key className=\"h-5 w-5\" />\n                  Bearer Token for Your FitScore AI Assistant\n                </CardTitle>\n                <CardDescription>This token makes your FitScore AI personalized only to you.</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-3\">\n                  <div className=\"text-sm text-slate-400 space-y-1 mb-3\">\n                    <p>Simply copy it and send it to the Admin. You only need to do this once.</p>\n                  </div>\n                  <Label className=\"text-slate-300\">JWT Bearer Token</Label>\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\n                    <div className=\"flex-1 bg-slate-700/50 border border-slate-600 rounded-md p-3 font-mono text-xs text-slate-300 break-all overflow-hidden\">\n                      {staticJwtData.static_jwt}\n                    </div>\n                    <Button\n                      onClick={copyJwtToken}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"w-full sm:w-auto bg-transparent border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200\"\n                    >\n                      <Copy className=\"h-4 w-4 mr-2\" />\n                      Copy\n                    </Button>\n                  </div>\n                  <div className=\"text-sm text-slate-400 mt-3\">\n                    <p>Only share this token with the Admin ‚Äî it's your secure key to connect your data.</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Calendar Management */}\n          <CalendarManagement />\n\n          {/* Legal Section */}\n          <Card className=\"bg-slate-800/50 border-slate-700 backdrop-blur-sm\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-white\">\n                Legal\n              </CardTitle>\n              <CardDescription>Privacy and legal information</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"space-y-3\">\n                <Link href=\"/privacy\">\n                  <div className=\"group flex items-start gap-3 p-4 rounded-lg bg-slate-700/30 border border-slate-600/50 hover:bg-slate-700/50 hover:border-slate-500 transition-all duration-200 cursor-pointer\">\n                    <Shield className=\"h-5 w-5 text-slate-400 mt-0.5 flex-shrink-0\" />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-semibold text-white group-hover:text-cyan-400 transition-colors duration-200\">\n                        Privacy Policy\n                      </div>\n                      <div className=\"text-sm text-slate-400 mt-1\">\n                        Last updated: Aug 27, 2025\n                      </div>\n                    </div>\n                  </div>\n                </Link>\n                <Link href=\"/disclaimer\">\n                  <div className=\"group flex items-start gap-3 p-4 rounded-lg bg-slate-700/30 border border-slate-600/50 hover:bg-slate-700/50 hover:border-slate-500 transition-all duration-200 cursor-pointer\">\n                    <Info className=\"h-5 w-5 text-slate-400 mt-0.5 flex-shrink-0\" />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-semibold text-white group-hover:text-cyan-400 transition-colors duration-200\">\n                        Disclaimer\n                      </div>\n                      <div className=\"text-sm text-slate-400 mt-1\">\n                        Important usage notice\n                      </div>\n                    </div>\n                  </div>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n\n      </div>\n    </div>\n  );\n}","size_bytes":14143},"client/src/styles/calendar.css":{"content":"/* Mobile-optimized Calendar Styles */\n.custom-calendar {\n  background: transparent !important;\n  color: white !important;\n  width: 100% !important;\n  overflow-x: auto;\n}\n\n/* Calendar header */\n.rbc-header {\n  background: rgba(30, 41, 59, 0.5) !important;\n  color: white !important;\n  border-bottom: 1px solid #475569 !important;\n  font-size: 12px !important;\n  padding: 8px 4px !important;\n}\n\n/* Calendar body */\n.rbc-month-view,\n.rbc-time-view,\n.rbc-agenda-view {\n  background: transparent !important;\n  overflow-x: auto !important;\n}\n\n/* Calendar cells */\n.rbc-day-bg {\n  background: rgba(15, 23, 42, 0.3) !important;\n  border: 1px solid #334155 !important;\n}\n\n.rbc-day-bg.rbc-today {\n  background: rgba(59, 130, 246, 0.1) !important;\n}\n\n.rbc-date-cell {\n  color: white !important;\n  font-size: 14px !important;\n}\n\n.rbc-today {\n  background: rgba(59, 130, 246, 0.2) !important;\n}\n\n/* Calendar events */\n.rbc-event {\n  background: #3B82F6 !important;\n  border: 1px solid #1E40AF !important;\n  color: white !important;\n  border-radius: 4px !important;\n  font-size: 11px !important;\n  padding: 2px 4px !important;\n}\n\n.rbc-event:hover {\n  background: #2563EB !important;\n}\n\n/* Time slots */\n.rbc-time-slot {\n  border-top: 1px solid #334155 !important;\n  color: #94A3B8 !important;\n}\n\n.rbc-time-gutter {\n  background: rgba(30, 41, 59, 0.5) !important;\n  border-right: 1px solid #475569 !important;\n}\n\n.rbc-time-header {\n  background: rgba(30, 41, 59, 0.5) !important;\n  border-bottom: 1px solid #475569 !important;\n}\n\n/* Mobile responsive adjustments */\n@media (max-width: 768px) {\n  .custom-calendar {\n    font-size: 12px !important;\n    min-width: 100% !important;\n  }\n  \n  .rbc-header {\n    font-size: 10px !important;\n    padding: 4px 2px !important;\n  }\n  \n  .rbc-event {\n    font-size: 9px !important;\n    padding: 1px 2px !important;\n  }\n  \n  .rbc-date-cell {\n    font-size: 12px !important;\n  }\n  \n  .rbc-time-view .rbc-time-gutter {\n    width: 50px !important;\n  }\n  \n  .rbc-month-view .rbc-row {\n    min-height: 40px !important;\n  }\n}\n\n/* Fix white backgrounds on mobile */\n.rbc-calendar * {\n  background-color: transparent !important;\n}\n\n.rbc-toolbar,\n.rbc-toolbar button {\n  background: transparent !important;\n  color: white !important;\n  border-color: #475569 !important;\n}\n\n.rbc-toolbar button:hover {\n  background: rgba(59, 130, 246, 0.2) !important;\n}\n\n/* Ensure full width on all screens */\n.calendar-container {\n  width: 100% !important;\n  overflow-x: auto;\n  background: transparent !important;\n}\n\n/* Remove any white backgrounds */\n.rbc-calendar,\n.rbc-calendar *,\n.rbc-month-view,\n.rbc-time-view,\n.rbc-agenda-view,\n.rbc-time-content,\n.rbc-time-header-content {\n  background: transparent !important;\n}","size_bytes":2719},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/pages/Disclaimer.tsx":{"content":"import { ChevronLeft } from 'lucide-react';\nimport { Link } from 'wouter';\nimport { Button } from '@/components/ui/button';\n\nexport default function Disclaimer() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-4 py-6 max-w-4xl\">\n        {/* Back Button */}\n        <div className=\"mb-6\">\n          <Link href=\"/profile\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"bg-transparent border-2 border-[#00D4FF] text-[#00D4FF] hover:bg-gradient-to-r hover:from-[#00D4FF] hover:to-[#0099FF] hover:text-white hover:border-transparent transition-all duration-200 hover:shadow-[0_0_20px_rgba(0,212,255,0.3)]\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-2\" />\n              Back to Profile\n            </Button>\n          </Link>\n        </div>\n\n        {/* Content */}\n        <div className=\"max-w-3xl mx-auto\">\n          <div className=\"bg-slate-800/50 border border-slate-700 rounded-lg backdrop-blur-sm p-8\">\n            <h1 className=\"text-3xl font-bold text-white mb-8\">Disclaimer</h1>\n\n            <div className=\"space-y-6 text-slate-300 leading-relaxed text-lg\">\n              <p>\n                FitScore provides general wellness and performance insights only.\n              </p>\n              \n              <p>\n                It does not provide medical advice, diagnosis, or treatment.\n              </p>\n              \n              <p>\n                You should always consult a qualified healthcare professional before making health-related decisions.\n              </p>\n              \n              <p className=\"font-medium text-white\">\n                By using FitScore, you acknowledge that you are responsible for your own choices and outcomes.\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":1938},"client/src/pages/PrivacyPolicy.tsx":{"content":"import { ChevronLeft } from 'lucide-react';\nimport { Link } from 'wouter';\nimport { Button } from '@/components/ui/button';\n\nexport default function PrivacyPolicy() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-4 py-6 max-w-4xl\">\n        {/* Back Button */}\n        <div className=\"mb-6\">\n          <Link href=\"/profile\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"bg-transparent border-2 border-[#00D4FF] text-[#00D4FF] hover:bg-gradient-to-r hover:from-[#00D4FF] hover:to-[#0099FF] hover:text-white hover:border-transparent transition-all duration-200 hover:shadow-[0_0_20px_rgba(0,212,255,0.3)]\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-2\" />\n              Back to Profile\n            </Button>\n          </Link>\n        </div>\n\n        {/* Content */}\n        <div className=\"max-w-3xl mx-auto\">\n          <div className=\"bg-slate-800/50 border border-slate-700 rounded-lg backdrop-blur-sm p-8\">\n            <h1 className=\"text-3xl font-bold text-white mb-2\">Privacy Policy</h1>\n            <p className=\"text-slate-400 mb-2\">Effective Date: August 27, 2025</p>\n            <p className=\"text-slate-400 mb-8\">FitScore (operated by Gustav Griezitis, Switzerland)</p>\n\n            <div className=\"space-y-8 text-slate-300 leading-relaxed\">\n              {/* Section 1 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">1. Introduction</h2>\n                <p className=\"mb-4\">\n                  FitScore is a personal performance and wellness assistant that integrates WHOOP recovery data, training calendars, meal tracking, and AI-powered insights.\n                </p>\n                <p className=\"mb-4\">\n                  We respect your privacy and are committed to protecting your personal information. This Policy explains what data we collect, how we use it, and your rights.\n                </p>\n                <p>\n                  By using FitScore, you agree to this Privacy Policy.\n                </p>\n              </section>\n\n              {/* Section 2 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">2. Data We Collect</h2>\n                <p className=\"mb-4\">We may collect the following types of data when you use FitScore:</p>\n                <ul className=\"list-disc list-inside space-y-2 ml-4\">\n                  <li><strong>WHOOP Data:</strong> sleep, recovery, strain, HRV, and related health metrics (via WHOOP API).</li>\n                  <li><strong>Calendar Data:</strong> training events and schedules from Google Calendar ICS links you provide.</li>\n                  <li><strong>Meal Data:</strong> meal photos and descriptions you upload.</li>\n                  <li><strong>AI Insights:</strong> text you provide for analysis by OpenAI models (used only to generate insights, not stored by OpenAI).</li>\n                  <li><strong>Account Information:</strong> your login credentials and email address.</li>\n                  <li><strong>App Logs:</strong> basic usage and error logs, for debugging and improving services.</li>\n                </ul>\n                <p className=\"mt-4 font-medium\">We do not sell your data to third parties.</p>\n              </section>\n\n              {/* Section 3 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">3. How We Use Your Data</h2>\n                <p className=\"mb-4\">We use your data to:</p>\n                <ul className=\"list-disc list-inside space-y-2 ml-4\">\n                  <li>Provide and improve FitScore's services.</li>\n                  <li>Generate personalized insights about recovery, training, and nutrition.</li>\n                  <li>Synchronize data from WHOOP, Google Calendar, and your meal entries.</li>\n                  <li>Respond to support requests.</li>\n                  <li>Ensure the security and stability of the service.</li>\n                </ul>\n              </section>\n\n              {/* Section 4 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">4. Data Sharing with Third Parties</h2>\n                <p className=\"mb-4\">To provide services, we share data only with trusted providers:</p>\n                <ul className=\"list-disc list-inside space-y-2 ml-4\">\n                  <li><strong>WHOOP</strong> ‚Äì to fetch your fitness and recovery data.</li>\n                  <li><strong>Google (Calendar ICS)</strong> ‚Äì to sync your training schedule.</li>\n                  <li><strong>OpenAI</strong> ‚Äì to generate AI-based insights (your data is sent for processing but not stored long-term by OpenAI).</li>\n                  <li><strong>Cloud Hosting Providers</strong> ‚Äì FitScore runs on secure cloud infrastructure (currently Replit; may change in the future).</li>\n                </ul>\n                <p className=\"mt-4 font-medium\">We do not sell or rent your personal data.</p>\n              </section>\n\n              {/* Section 5 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">5. Data Retention</h2>\n                <p className=\"mb-4\">\n                  We retain your data until you request deletion or close your account.\n                </p>\n                <p>\n                  You may request deletion at any time by contacting us at <a href=\"mailto:privacy@fitscore.app\" className=\"text-blue-400 hover:text-blue-300 underline\">privacy@fitscore.app</a>.\n                </p>\n              </section>\n\n              {/* Section 6 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">6. Your Rights</h2>\n                <p className=\"mb-4\">Depending on where you live, you may have the following rights:</p>\n                <ul className=\"list-disc list-inside space-y-2 ml-4\">\n                  <li><strong>EU/UK/Swiss users (GDPR, UK GDPR, FADP):</strong> right to access, correct, delete, restrict, or transfer your data, and to object to processing.</li>\n                  <li><strong>US users (California CCPA/CPRA):</strong> right to know what data we collect, request deletion, and opt out of data sale (FitScore does not sell personal data).</li>\n                </ul>\n                <p className=\"mt-4\">\n                  To exercise these rights, email us at <a href=\"mailto:privacy@fitscore.app\" className=\"text-blue-400 hover:text-blue-300 underline\">privacy@fitscore.app</a>.\n                </p>\n              </section>\n\n              {/* Section 7 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">7. Age Restriction</h2>\n                <p className=\"mb-4\">\n                  FitScore is intended for users 16 years or older.\n                </p>\n                <p>\n                  We do not knowingly collect data from children under 16.\n                </p>\n              </section>\n\n              {/* Section 8 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">8. Security</h2>\n                <p>\n                  We use industry-standard measures (encryption, secure storage, limited access) to protect your personal data. However, no method of transmission or storage is 100% secure.\n                </p>\n              </section>\n\n              {/* Section 9 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">9. Changes to This Policy</h2>\n                <p>\n                  We may update this Privacy Policy from time to time. If we make material changes, we will notify you in the app or by email. The updated version will always be available at fitscore.app/privacy.\n                </p>\n              </section>\n\n              {/* Section 10 */}\n              <section>\n                <h2 className=\"text-xl font-semibold text-white mb-3\">10. Contact Us</h2>\n                <p className=\"mb-4\">For privacy-related questions or data requests:</p>\n                <p className=\"mb-4\">\n                  <a href=\"mailto:privacy@fitscore.app\" className=\"text-blue-400 hover:text-blue-300 underline\">privacy@fitscore.app</a>\n                </p>\n                <p>For user support:</p>\n                <p>\n                  <a href=\"mailto:support@fitscore.app\" className=\"text-blue-400 hover:text-blue-300 underline\">support@fitscore.app</a>\n                </p>\n              </section>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8667}},"version":1}